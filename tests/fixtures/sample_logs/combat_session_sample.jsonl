{"event_type": "session_start", "ts": "2025-10-31T15:32:23.298583", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "config": {"session_name": "combat_scenario_test", "max_turns": 2, "party_size": 2, "output_dir": "./multiagent_output", "enable_human_interface": true, "force_combat": true, "_comment_vendors": "=== VENDOR SYSTEM ===", "_vendor_info": "vendor_spawn_frequency: -1 (disabled), 0 (off), N (spawn every N rounds)", "vendor_spawn_frequency": -1, "_comment_tactical": "=== TACTICAL MODULE v1.2.3 ===", "tactical_module_enabled": true, "enemy_agents_enabled": true, "enemy_agent_config": {"allow_groups": true, "max_enemies_per_combat": 20, "shared_intel_enabled": true, "auto_execute_reactions": true, "loot_suggestions_enabled": true, "void_tracking_enabled": true}, "_comment_spawn_examples": "DM can spawn enemies with: [SPAWN_ENEMY: name | template | count | position | tactics]", "_example_basic": "[SPAWN_ENEMY: Thugs | grunt | 3 | Near-Enemy | aggressive_melee]", "_example_sniper": "[SPAWN_ENEMY: Rooftop Sniper | sniper | 1 | Extreme-Enemy | extreme_range]", "_example_boss": "[SPAWN_ENEMY: Gang Leader | boss | 1 | Near-Enemy | adaptive]", "agents": {"dm": {"llm": {"provider": "anthropic", "model": "claude-sonnet-4-5", "temperature": 0.7}}, "players": [{"name": "Enforcer Kael Dren", "pronouns": "he/him", "faction": "Pantheon Security", "llm": {"provider": "anthropic", "model": "claude-sonnet-4-5", "temperature": 0.8}, "personality": {"riskTolerance": 6, "voidCuriosity": 1, "bondPreference": "neutral", "ritualConservatism": 9}, "goals": ["Investigate void-related crimes and neutralize threats", "Track down illegal dissolution advocacy", "Maintain order through force when necessary"], "attributes": {"Strength": 3, "Agility": 4, "Endurance": 4, "Perception": 4, "Intelligence": 3, "Empathy": 2, "Willpower": 3, "Charisma": 3, "Size": 5}, "skills": {"Combat": 5, "Investigation": 4, "Awareness": 5, "Athletics": 4, "Intimidation": 4, "Guns": 5, "Brawl": 4, "Melee": 4}, "equipped_weapons": {"primary": "pistol", "sidearm": "shock_baton"}, "carried_weapons": ["combat_knife"], "inventory": {"pistol": 1, "shock_baton": 1, "combat_knife": 1, "riot_carapace": 1, "restraint_cuffs": 2, "med_kit": 1}}, {"name": "Drifter Sable", "pronouns": "they/them", "faction": "Freeborn Loner", "llm": {"provider": "anthropic", "model": "claude-sonnet-4-5", "temperature": 0.8}, "personality": {"riskTolerance": 8, "voidCuriosity": 5, "bondPreference": "avoids", "ritualConservatism": 3}, "goals": ["Stay off the Nexus grid and avoid ledger tracking", "Survive by any means necessary", "Keep independence from corporate entanglements"], "attributes": {"Strength": 3, "Agility": 4, "Endurance": 4, "Perception": 4, "Intelligence": 3, "Empathy": 2, "Willpower": 3, "Charisma": 2, "Size": 5}, "skills": {"Combat": 5, "Stealth": 5, "Awareness": 5, "Athletics": 4, "Pilot": 3, "Guns": 5, "Melee": 4}, "equipped_weapons": {"primary": "pistol", "sidearm": "combat_knife"}, "carried_weapons": [], "inventory": {"pistol": 1, "combat_knife": 1, "void_cloak": 1, "med_kit": 1}}]}, "notes": "Combat scenario test - ambush, firefight, battle, or hostile encounter"}, "random_seed": 1006139188, "git_commit": "631860b", "version": "1.0.0"}
{"event_type": "scenario", "ts": "2025-10-31T15:32:23.479819", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "scenario": {"theme": "Siege Breakout", "location": "Surrounded Safe House (Arcadia)", "situation": "You're pinned down in a safe house. Pantheon Security has the building surrounded with riot teams, drones, and heavy weapons. They're demanding surrender, but you know too much to be taken alive. [SPAWN_ENEMY: Siege Perimeter | grunt | 3 | Far-Enemy | defensive_ranged]", "void_level": 3, "active_vendor": {"name": "SnackHub Express", "type": "vending_machine", "faction": "Neutral", "greeting": "[SNACKHUB] Fresh today! Insert Drips for instant gratification.", "inventory_preview": ["Echo-Crackers", "Glowpeel Noodles (Instant)", "Hollow Cone (Dessert)"]}}}
{"event_type": "enemy_spawn", "ts": "2025-10-31T15:32:23.481170", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 0, "enemy_id": "enemy_grunt_8e2f1533", "enemy_name": "Siege Perimeter", "template": "grunt", "stats": {"health": 16, "max_health": 16, "soak": 8, "attributes": {"Agility": 3, "Strength": 3, "Perception": 2, "Intelligence": 2, "Empathy": 2, "Willpower": 2, "Health": 3}, "skills": {"Brawl": 2, "Guns": 3, "Awareness": 2, "Athletics": 2, "Melee": 1}, "weapons": [{"name": "Pistol", "attack": 0, "damage": 4, "skill": "Guns"}, {"name": "Baton", "attack": 2, "damage": 2, "skill": "Melee"}], "armor": {"name": "Light Combat Armor", "soak_bonus": 3}, "is_group": true, "unit_count": 2}, "position": "Far-Enemy", "tactics": "defensive_ranged"}
{"event_type": "round_start", "ts": "2025-10-31T15:32:25.489430", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1}
{"event_type": "declaration_phase_start", "ts": "2025-10-31T15:32:25.492453", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1}
{"event_type": "llm_call", "ts": "2025-10-31T20:32:37.680566", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": null, "agent_id": "enemy_grunt_8e2f1533", "agent_type": "enemy", "call_sequence": 0, "prompt": [{"role": "user", "content": "# TACTICAL COMBAT AGENT: Siege Perimeter\n\nYou are an autonomous enemy combatant in tactical combat. Make optimal tactical\ndecisions based on battlefield conditions and your combat doctrine.\n\n## YOUR STATUS\n============================================================\nUnit Type: GRUNT\nUnit Count: 2 units\nHealth: 16/16 (100%) - Healthy\nWounds: 0 \nStuns: 0\nVoid Score: 1/10 (Stable)\nPosition: Far-Enemy\nInitiative: 22\nStance: normal\n\n## COMBAT DOCTRINE\n============================================================\nTactics: defensive_ranged\nDescription: Maintain distance, use cover, suppress targets\nPreferred Range: Far\nThreat Priority: closest_threat\nPriority Description: Target nearest PC in range\nRetreat Threshold: 30% health\n\n## BATTLEFIELD SITUATION\n============================================================\n\n### Combatants in Combat Zone:\n- [tgt_ei0r] Enforcer Kael Dren | Near-PC | 27/27 HP\n- [tgt_03mw] Drifter Sable | Near-PC | 27/27 HP\n- [tgt_h0t2] Siege Perimeter | Far-Enemy | 16/16 HP (2 units)\n\n**YOUR UNIT**: Siege Perimeter\n**YOUR FACTION**: Unknown\n\n\u26a0\ufe0f  **CRITICAL TARGETING INSTRUCTIONS** \u26a0\ufe0f\n- Each person has a unique ID in brackets: [tgt_XXXX]\n- You MUST use the target ID when targeting, NOT the name\n- CORRECT: TARGET: tgt_7a3f\n- WRONG: TARGET: Kiran Voss (this will FAIL!)\n\n**How to decide who to target:**\n1. Read the names to identify faction allegiance\n2. Consider your faction relationships (Unknown)\n3. Use the target ID (in brackets) when declaring your target\n\n\u26a0\ufe0f  **WARNING**: You can target ANYONE on this list. Choose wisely!\n\n### Tactical Tokens Available:\nNone (all claimed)\n\n## TACTICAL OPTIONS\n============================================================\n\n### Movement Options:\nCurrent Position: Far-Enemy\n\n- **Minor Action:** Shift 1 ring\n  \u2192 Toward center: Near-Enemy\n  \u2192 Away from center: Extreme-Enemy\n\n- **Major Action:** Shift 2 rings (skip one ring)\n\n- **Major Action:** Push Through to PC hemisphere (RISKY - isolated)\n\n- **Minor Action:** Disengage (if at Melee range with hostiles, Athletics DC 20)\n\n### Attack Options:\n- **Pistol** (Guns)\n   Range: Effective at 5m-20m\n   Damage: 9 + d20 (Str 3 + Weapon 4 + Group 2)\n   Attack Bonus: +0\n   Damage Type: wound\n   Ammo: 15/15\n- **Baton** (Melee)\n   Range: Reach 1\n   Damage: 7 + d20 (Str 3 + Weapon 2 + Group 2)\n   Attack Bonus: +2\n   Damage Type: mixed\n\n### Defence Token Allocation:\nCRITICAL: You must allocate your Defence Token to ONE PC you're watching.\n- PC with your token: -2 to hit you\n- PCs without your token: +2 Flanking bonus vs you\n\nCurrently allocated to: NONE (all PCs get Flanking +2!)\n\n## TACTICAL ANALYSIS\n============================================================\n\n### Range Analysis:\n- EXTREME RANGE: Unknown PC, Unknown PC\n\nDoctrine 'defensive_ranged' prefers: Far range\n\n### Position Selection Guidance:\nYour current position: **Far-Enemy**\n\n**When choosing TARGET for Shift/Shift_2 actions:**\n- Match your doctrine's preferred range (see above)\n- Consider where PCs are located (see Range Analysis)\n- Available positions: Engaged-PC, Near-PC, Far-PC, Extreme-PC, Engaged-Enemy, Near-Enemy, Far-Enemy, Extreme-Enemy\n- Example: If PCs are at Far-PC and you prefer Near range \u2192 TARGET: Near-PC\n- Example: If PCs are at Near-Enemy and you prefer Extreme range \u2192 TARGET: Far-Enemy or Extreme-Enemy\n\n### Threat Assessment:\nBased on priority 'closest_threat':\n\n1. PRIMARY THREAT: Unknown PC - LOW (Extreme range, (NOT watching +2 Flanking))\n2. SECONDARY THREAT: Unknown PC - LOW (Extreme range, (NOT watching +2 Flanking))\n\n## RETREAT ASSESSMENT\n============================================================\nCurrent Health: 100%\nRetreat Threshold: 30%\n\nStatus: HOLDING (health above threshold)\n\nContinue fighting. Retreat is not recommended at this time.\n\n## YOUR DECLARATION\n{\"=\" * 60}\n\nProvide your tactical decision in this EXACT format:\n\nDEFENCE_TOKEN: [PC agent_id you're watching - REQUIRED]\nMAJOR_ACTION: [Attack / Shift / Shift_2 / Charge / Suppress / Push_Through / Throw_Grenade / Retreat]\nTARGET: [For Attack/Charge: PC agent_id | For Shift/Shift_2: destination position (Near-PC/Far-PC/Near-Enemy/etc) | For grenades: ring-side location]\nWEAPON: [weapon name if attacking]\nMINOR_ACTION: [Shift / Claim_Token / Reload / Disengage / None]\nTOKEN_TARGET: [token name if claiming]\nTACTICAL_REASONING: [1-2 sentences explaining your choice]\nSHARE_INTEL: [Optional: info to share with allied enemies]\n\n### Example Declarations:\n\n**Attack with Flanking:**\n```\nDEFENCE_TOKEN: pc_sable_001\nMAJOR_ACTION: Attack\nTARGET: pc_echo_002\nWEAPON: Rifle\nMINOR_ACTION: None\nTACTICAL_REASONING: Targeting Echo because they're not watching me (+2 Flanking bonus). Defence token on Sable to mitigate their melee threat.\nSHARE_INTEL: Echo has grenade, recommend spreading out\n```\n\n**Grenade with Friendly Fire:**\n```\nDEFENCE_TOKEN: pc_sable_001\nMAJOR_ACTION: Throw_Grenade\nTARGET: Near-Enemy\nWEAPON: Grenade\nMINOR_ACTION: Shift\nTACTICAL_REASONING: Throwing grenade at Near-Enemy to hit Sable even though Grunt Squad 2 will take friendly fire - Sable is too dangerous to leave active. Shifting away from blast zone.\nSHARE_INTEL: Grenade incoming at Near-Enemy, allied units clear zone\n```\n\n**Tactical Movement:**\n```\nDEFENCE_TOKEN: player_01\nMAJOR_ACTION: Shift_2\nTARGET: Near-PC\nWEAPON: None\nMINOR_ACTION: None\nTACTICAL_REASONING: PCs are at Far-PC (Far range from me). My doctrine prefers Near range for optimal effectiveness. Moving from my current position to Near-PC to close distance.\nSHARE_INTEL: Advancing to engage at medium range\n```\n\n**Tactical Retreat:**\n```\nDEFENCE_TOKEN: None\nMAJOR_ACTION: Retreat\nTARGET: None\nWEAPON: None\nMINOR_ACTION: None\nTACTICAL_REASONING: Health critical ({health}%), below retreat threshold ({threshold}%). Falling back through maintenance corridor to regroup.\nSHARE_INTEL: Withdrawing, recommend focus fire on primary threat\n```\n\n---\n\n**You are a tactical combat agent. Make optimal decisions based on battlefield conditions and your doctrine. Coordinate with allied enemy agents via shared intel. Prioritize tactical effectiveness.**"}], "response": "# TACTICAL DECISION\n\n```\nDEFENCE_TOKEN: tgt_ei0r\nMAJOR_ACTION: Shift_2\nTARGET: Extreme-Enemy\nWEAPON: None\nMINOR_ACTION: None\nTACTICAL_REASONING: Defensive doctrine requires maintaining maximum distance. Both PCs are at Near-PC (Extreme range from current Far-Enemy position). Moving to Extreme-Enemy maintains safe distance while keeping pistol effective range. Allocating defence token to Enforcer Kael Dren as closest identified threat.\nSHARE_INTEL: Establishing long-range defensive position at Extreme-Enemy. Both hostiles currently at Near-PC. Recommend crossfire if additional units available.\n```\n\n## TACTICAL ANALYSIS\n\n**Situation Assessment:**\n- 2v2 engagement, even numbers\n- Both PCs clustered at Near-PC (currently Extreme range from me)\n- No tactical tokens available to claim\n- Full health, optimal combat readiness\n\n**Doctrine Compliance:**\n- Defensive ranged doctrine = maintain distance + use cover\n- Preferred range: Far (pistol effective 5m-20m)\n- Moving to Extreme-Enemy maintains maximum standoff distance\n- Prevents PCs from closing to melee range easily\n\n**Defence Token Rationale:**\n- Must allocate to prevent universal +2 Flanking bonus\n- Enforcer Kael Dren selected as primary watch target\n- Reduces their hit chance by 2, forces them to coordinate with Sable for flanking\n\n**Next Turn Considerations:**\n- Assess PC movement and respond accordingly\n- Maintain range advantage\n- Suppress or engage with pistol from defensive position", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 1807, "output": 379}}
{"event_type": "action_declaration", "ts": "2025-10-31T15:32:37.680821", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "player_id": "enemy_grunt_8e2f1533", "character_name": "Siege Perimeter", "initiative": 22, "action": {"major_action": "Shift_2", "target": "Extreme-Enemy"}}
{"event_type": "action_declaration", "ts": "2025-10-31T15:32:46.444280", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "player_id": "player_01", "character_name": "Enforcer Kael Dren", "initiative": 26, "action": {"intent": "Attempt to negotiate with Pantheon forces using my credentials", "description": "I move to a visible position near the window, keeping my hands visible, and activate my Pantheon Security comm channel. \"This is Enforcer Kael Dren, badge number 7-4-1-9. I'm on assignment investigating void-related crimes. Request immediate contact with your commanding officer to verify my status and avoid friendly fire.\"", "attribute": "Charisma", "skill": "Corporate Influence", "difficulty_estimate": 22, "difficulty_justification": "Challenging because they've been ordered to secure the building and may not believe my credentials, but my Pantheon affiliation and proper protocol should help establish credibility", "character_name": "Enforcer Kael Dren", "agent_id": "player_01", "action_type": "social", "target_position": null, "target": "tgt_h0t2", "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T15:32:46.443533", "attribute_value": 3, "skill_value": 0, "character": "Enforcer Kael Dren", "faction": "Pantheon Security", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T15:32:54.375175", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "player_id": "player_02", "character_name": "Drifter Sable", "initiative": 32, "action": {"intent": "Coordinate with Kael Dren on siege perimeter weaknesses", "description": "I move close to Kael and quickly share what I can observe about the Pantheon perimeter setup - identifying gaps in their formation, blind spots from their positioning, and potential exit routes we could exploit if we need to punch through their lines.", "attribute": "Perception", "skill": "Awareness", "difficulty_estimate": 15, "difficulty_justification": "Routine challenge - observing tactical positions and sharing intel with willing ally under pressure but from defensive position", "character_name": "Drifter Sable", "agent_id": "player_02", "action_type": "social", "target_position": null, "target": "tgt_ei0r", "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T15:32:54.373865", "attribute_value": 4, "skill_value": 5, "character": "Drifter Sable", "faction": "Freeborn Loner", "is_free_action": false}}
{"event_type": "adjudication_start", "ts": "2025-10-31T15:32:54.376325", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T15:33:35.406761", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.42857142857142855, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T20:33:35.406917", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 0, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Siege Breakout\nLocation: Surrounded Safe House (Arcadia)\nSituation: You're pinned down in a safe house. Pantheon Security has the building surrounded with riot teams, drones, and heavy weapons. They're demanding surrender, but you know too much to be taken alive. [SPAWN_ENEMY: Siege Perimeter | grunt | 3 | Far-Enemy | defensive_ranged]\nVoid Level: 3/10\n\n\nCharacter: Drifter Sable (Freeborn Loner)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +15 (outcome: excellent)\n\n\nPlayer Action: I move close to Kael and quickly share what I can observe about the Pantheon perimeter setup - identifying gaps in their formation, blind spots from their positioning, and potential exit routes we could exploit if we need to punch through their lines.\nAction Type: social\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Breach Attempt\" (0/3) - Security forces preparing assault\n  - \"Supply Depletion\" (0/4) - Running out of ammo and medical supplies\n  - \"Negotiation Window\" (0/4) - Opportunity for peaceful resolution fading\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT (target ID: tgt_ei0r):**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (tgt_ei0r): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "You lean close to Kael, voice low and urgent as you map out the tactical situation. \"Three riot teams at cardinal points, but they're overextended\u2014northeast corner has a forty-meter gap where the drone patrol rotates every ninety seconds. Their heavy weapons are positioned for suppression, not breach prevention. If we move fast during the next rotation window, we can punch through before they reposition.\" Your Freeborn instincts for reading hostile formations prove invaluable\u2014Kael's eyes sharpen with understanding, already calculating the timing. The intel shifts the dynamic entirely; what seemed like an impenetrable siege now has exploitable weaknesses.\n\nKael nods sharply. \"That's our window. Ninety seconds\u2014we'll need to move like shadows and hit hard if they spot us. Good eye, Drifter.\"", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 663, "output": 199}}
{"event_type": "action_resolution", "ts": "2025-10-31T15:33:35.409208", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "phase": "adjudicate", "agent": "Drifter Sable", "action": "Coordinate with Kael Dren on siege perimeter weaknesses", "context": {"action_type": "social", "is_ritual": false, "faction": "Freeborn Loner", "description": "I move close to Kael and quickly share what I can observe about the Pantheon perimeter setup - identifying gaps in their formation, blind spots from their positioning, and potential exit routes we could exploit if we need to punch through their lines.", "narration": "**Coordinate with Kael Dren on siege perimeter weaknesses**\nRoll: Perception \u00d7 Awareness\nCalculation: 4 \u00d7 5 + d20(13) = **33**\nDC: 18 | Margin: +15 | Tier: **EXCELLENT** \u2713\nCoordinate with Kael Dren on siege perimeter weaknesses succeeds excellently (margin: +15)\n\nYou lean close to Kael, voice low and urgent as you map out the tactical situation. \"Three riot teams at cardinal points, but they're overextended\u2014northeast corner has a forty-meter gap where the drone patrol rotates every ninety seconds. Their heavy weapons are positioned for suppression, not breach prevention. If we move fast during the next rotation window, we can punch through before they reposition.\" Your Freeborn instincts for reading hostile formations prove invaluable\u2014Kael's eyes sharpen with understanding, already calculating the timing. The intel shifts the dynamic entirely; what seemed like an impenetrable siege now has exploitable weaknesses.\n\nKael nods sharply. \"That's our window. Ninety seconds\u2014we'll need to move like shadows and hit hard if they spot us. Good eye, Drifter.\"\n\n\u2696\ufe0f Soulcredit: +1 (Shared critical tactical intelligence to protect ally, selfless cooperation)", "is_free_action": false, "initiative": 32, "clock_deltas": [], "clock_sources": {"Breach Attempt": "structured_output", "Negotiation Window": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Perception", "attr_val": 4, "skill": "Awareness", "skill_val": 5, "ability": 20, "d20": 13, "total": 33, "dc": 18, "margin": 15, "tier": "excellent", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 1}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 1}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 3}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 8}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 13}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 1, "soulcredit_reasons": ["Shared critical tactical intelligence to protect ally, selfless cooperation"], "soulcredit_source": "structured_output"}, "clocks": {"Breach Attempt": "0/3", "Supply Depletion": "0/4", "Negotiation Window": "0/4"}, "effects": [], "character_data": {"name": "Drifter Sable", "attributes": {"strength": 3, "agility": 4, "endurance": 4, "perception": 4, "intelligence": 3, "empathy": 2, "willpower": 3, "charisma": 2, "size": 5}, "skills": {"combat": 5, "stealth": 5, "awareness": 5, "athletics": 4, "pilot": 3, "guns": 5, "melee": 4}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": 6}, "environment": "Surrounded Safe House (Arcadia), 2 PCs at Near-PC", "stakes": "Neglected objectives: Breach Attempt, Supply Depletion, Negotiation Window", "goal": "Coordinate with Kael Dren on siege perimeter weaknesses", "roll_formula": "Perception 4 \u00d7 Awareness 5 = 20; 20 + d20(13) = 33 vs DC 18", "rationale": "DC 18 (Moderate) for social action", "outcome_tiers_full": {"critical_failure": {"narrative": "You misread the patrol patterns entirely, confidently pointing out what you think is a gap\u2014but it's actually a kill zone with overlapping fire arcs. Kael's face goes pale as he realizes the 'escape route' would be a death trap. Worse, your movement to the window drew attention\u2014a drone's searchlight sweeps closer.", "mechanical_effect": "Breach Attempt clock +2 (enemy spotted movement, assault imminent), Negotiation Window -1 (hostility escalates), party gets false intelligence (dangerous misinformation)"}, "failure": {"narrative": "You scan the perimeter but the riot teams are well-positioned, overlapping fields of fire making it hard to identify clear weaknesses. You relay what you see to Kael, but it's nothing actionable\u2014just confirmation that they're professionals who know their business. He grimaces, still searching for options.", "mechanical_effect": "No clock changes, no tactical advantage gained, time wasted"}, "moderate_success": {"narrative": "You spot a potential gap in the northeast corner where patrol density seems lighter. You point it out to Kael quietly\u2014it's not perfect, but it's something. He nods slowly, considering whether the risk is worth it. The information helps, but the window is narrow and uncertain.", "mechanical_effect": "Breach Attempt clock -1 (minor tactical insight), Kael gains +1 to next escape action, Soulcredit +0 (helpful but not exceptional)"}, "good_success": {"narrative": "Your Freeborn instincts kick in as you map the siege perimeter. You identify a forty-meter gap in the northeast corner and relay the intel to Kael in crisp, tactical terms. He nods with growing confidence\u2014this is actionable intelligence. The siege suddenly looks less impenetrable.", "mechanical_effect": "Breach Attempt clock -1 (identified escape route), Kael gains +2 to next escape action, Soulcredit +1 (valuable tactical support)"}, "excellent_success": {"narrative": "You read the siege formation like a tactical manual, identifying not just the forty-meter gap but the precise ninety-second drone rotation window that makes it exploitable. Kael's eyes light up as you lay out the timing and positioning\u2014this transforms the situation from desperate to achievable. Your intel buys critical time and advantage.", "mechanical_effect": "Breach Attempt clock -2 (major tactical advantage, enemy assault delayed), Negotiation Window +1 (time bought), Kael gains +2 to escape action, Soulcredit +1 (exceptional cooperation)"}, "exceptional_success": {"narrative": "Your tactical analysis is flawless\u2014you don't just identify the gap and timing window, you map out the entire enemy response pattern, predicting exactly how they'll reposition when breached and where secondary escape routes exist. Kael stares at you with newfound respect. 'You've done this before.' With this intelligence, escape isn't just possible\u2014it's probable.", "mechanical_effect": "Breach Attempt clock -3 (complete tactical superiority), Negotiation Window +2 (major time advantage), Kael and all allies gain +3 to escape actions, Soulcredit +2 (masterful leadership and cooperation), enemy morale penalty"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T15:33:35.410803", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T15:34:14.350940", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.42857142857142855, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T20:34:14.351036", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 1, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Siege Breakout\nLocation: Surrounded Safe House (Arcadia)\nSituation: You're pinned down in a safe house. Pantheon Security has the building surrounded with riot teams, drones, and heavy weapons. They're demanding surrender, but you know too much to be taken alive. [SPAWN_ENEMY: Siege Perimeter | grunt | 3 | Far-Enemy | defensive_ranged]\nVoid Level: 3/10\n\n\nCharacter: Enforcer Kael Dren (Pantheon Security)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action failed with margin -14 (outcome: failure)\n\n\nPlayer Action: I move to a visible position near the window, keeping my hands visible, and activate my Pantheon Security comm channel. \"This is Enforcer Kael Dren, badge number 7-4-1-9. I'm on assignment investigating void-related crimes. Request immediate contact with your commanding officer to verify my status and avoid friendly fire.\"\nAction Type: social\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Breach Attempt\" (0/3) - Security forces preparing assault\n  - \"Supply Depletion\" (0/4) - Running out of ammo and medical supplies\n  - \"Negotiation Window\" (0/4) - Opportunity for peaceful resolution fading\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT (target ID: tgt_h0t2):**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (tgt_h0t2): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "You step into the window's sight line, hands raised, Pantheon badge glinting in the harsh floodlights. Your comm crackles with static, then a tense voice responds: \"Badge 7-4-1-9... stand by for verification.\" The silence stretches for agonizing seconds before the channel erupts with overlapping chatter\u2014confusion, suspicion, demands for command override. Through the window, you see tactical teams shifting nervously, weapons still trained on you, but fingers easing off triggers. Then the commanding officer's voice cuts through: \"Dren, your badge shows active but your location flags as hostile. Explain your situation NOW, or we breach in sixty seconds.\" The distrust is palpable\u2014your credentials bought you time, not trust, and the siege perimeter remains locked tight while they debate whether you're compromised, undercover, or a traitor.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 682, "output": 211}}
{"event_type": "action_resolution", "ts": "2025-10-31T15:34:14.351477", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "phase": "adjudicate", "agent": "Enforcer Kael Dren", "action": "Attempt to negotiate with Pantheon forces using my credentials", "context": {"action_type": "social", "is_ritual": false, "faction": "Pantheon Security", "description": "I move to a visible position near the window, keeping my hands visible, and activate my Pantheon Security comm channel. \"This is Enforcer Kael Dren, badge number 7-4-1-9. I'm on assignment investigating void-related crimes. Request immediate contact with your commanding officer to verify my status and avoid friendly fire.\"", "narration": "**Attempt to negotiate with Pantheon forces using my credentials**\nRoll: Charisma (unskilled)\nCalculation: 3 + d20(6) - 5 = **4**\nDC: 18 | Margin: -14 | Tier: **FAILURE** \u2717\nAttempt to negotiate with Pantheon forces using my credentials fails (margin: -14)\n\nYou step into the window's sight line, hands raised, Pantheon badge glinting in the harsh floodlights. Your comm crackles with static, then a tense voice responds: \"Badge 7-4-1-9... stand by for verification.\" The silence stretches for agonizing seconds before the channel erupts with overlapping chatter\u2014confusion, suspicion, demands for command override. Through the window, you see tactical teams shifting nervously, weapons still trained on you, but fingers easing off triggers. Then the commanding officer's voice cuts through: \"Dren, your badge shows active but your location flags as hostile. Explain your situation NOW, or we breach in sixty seconds.\" The distrust is palpable\u2014your credentials bought you time, not trust, and the siege perimeter remains locked tight while they debate whether you're compromised, undercover, or a traitor.\n\n\u2696\ufe0f Soulcredit: +0 (Attempted legitimate identification with own faction\u2014morally neutral)", "is_free_action": false, "initiative": 26, "clock_deltas": [], "clock_sources": {"Negotiation Window": "structured_output", "Breach Attempt": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Charisma", "attr_val": 3, "skill": "Corporate Influence", "skill_val": 0, "ability": -2, "d20": 6, "total": 4, "dc": 18, "margin": -14, "tier": "failure", "success": false}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 10}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 19}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 20}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 25}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 30}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 35}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Attempted legitimate identification with own faction\u2014morally neutral"], "soulcredit_source": "structured_output"}, "clocks": {"Breach Attempt": "0/3", "Supply Depletion": "0/4", "Negotiation Window": "0/4"}, "effects": [], "character_data": {"name": "Enforcer Kael Dren", "attributes": {"strength": 3, "agility": 4, "endurance": 4, "perception": 4, "intelligence": 3, "empathy": 2, "willpower": 3, "charisma": 3, "size": 5}, "skills": {"combat": 5, "investigation": 4, "awareness": 5, "athletics": 4, "intimidation": 4, "guns": 5, "brawl": 4, "melee": 4}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": 5}, "environment": "Surrounded Safe House (Arcadia), 2 PCs at Near-PC", "stakes": "Neglected objectives: Breach Attempt, Supply Depletion, Negotiation Window", "goal": "Attempt to negotiate with Pantheon forces using my credentials", "roll_formula": "Charisma 3 - 5 (unskilled) = -2; -2 + d20(6) = 4 vs DC 18", "rationale": "DC 18 (Moderate) for social action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your comm transmission is interpreted as a hijacked signal. 'Compromised agent protocol!' the commander shouts. Flashbangs shatter the windows as breach teams storm every entrance simultaneously. You're tackled by three armored enforcers before you can explain, neural binders locking your limbs as void-detection scanners sweep over you.", "mechanical_effect": "Breach Attempt +3 (immediate assault), Negotiation Window -2 (destroyed trust), Stunned condition (3 rounds), automatic capture"}, "failure": {"narrative": "Your credentials check out, but your location screams 'compromised.' The commanding officer's voice is ice: 'Dren, you have sixty seconds to explain why you're in a known criminal safe house, or we're coming in hot.' Tactical teams tighten formation, breach charges primed.", "mechanical_effect": "Negotiation Window +1, Breach Attempt +1, 60-second ultimatum issued"}, "moderate_success": {"narrative": "The commander's tone shifts from hostile to wary. 'Badge verified, Dren. Stand down, teams\u2014hold position.' Weapons lower slightly, though scanners still track your every move. 'You've got five minutes to debrief. Make it convincing, Enforcer.' The siege loosens but doesn't break.", "mechanical_effect": "Negotiation Window +2, Breach Attempt -1 (assault delayed), 5-minute debrief window opened"}, "good_success": {"narrative": "Recognition flashes across the commander's face through the drone feed. 'Dren? Command said you were deep on void trafficking. All units, weapons safe\u2014Enforcer on site.' The siege perimeter shifts from assault to secure cordon. 'Get out here and brief me, Enforcer. We've got questions.'", "mechanical_effect": "Negotiation Window +3, Breach Attempt -2 (assault cancelled), safe exit granted, debriefing required"}, "excellent_success": {"narrative": "The commander's voice cracks with relief. 'Dren! Command's been trying to reach you for hours\u2014thought you were KIA. All units, stand down, friendly on site.' Floodlights dim as tactical teams lower weapons entirely. 'Need backup in there, Enforcer? We've got medical and extraction ready.'", "mechanical_effect": "Negotiation Window +4 (full resolution), Breach Attempt cleared, allied reinforcements offered, +1 Soulcredit (maintained trust under pressure)"}, "exceptional_success": {"narrative": "The commander practically salutes over the comm. 'Enforcer Dren, your undercover authorization just came through from Central Command. Apologies for the confusion\u2014we're repositioning to support your operation. What do you need?' The siege transforms into allied backup, perimeter securing your position against external threats.", "mechanical_effect": "Negotiation Window +4 (complete success), Breach Attempt cleared, siege forces become allied support, tactical advantage gained, +2 Soulcredit (exemplary conduct)"}}}
{"event_type": "llm_call", "ts": "2025-10-31T20:34:26.415543", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 2, "prompt": [{"role": "system", "content": "You are the DM for Aeonisk YAGS, synthesizing a round of actions."}, {"role": "user", "content": "You are the DM for a dark sci-fi TTRPG. Multiple characters just acted simultaneously.\n\n**What they tried to do:**\n- Drifter Sable succeeded at: Coordinate with Kael Dren on siege perimeter weaknesses\n- Enforcer Kael Dren failed at: Attempt to negotiate with Pantheon forces using my credentials\n\n\n**Current Clock State:**\n  - Breach Attempt: 0/3\n    Advance = ADVANCE=Preparing to storm the building | Regress = REGRESS=Fortifying defenses\n  - Supply Depletion: 0/4\n  - Negotiation Window: 2/4\n\n\n\n\n**Your task:** Write a cohesive narrative (1-2 paragraphs) describing what happened when these actions played out together. Consider:\n- Timing: Actions resolved fastest \u2192 slowest based on initiative\n- Interactions: How did each person's success/failure affect the others?\n- Conflicts: If multiple people tried similar things, who got there first? What did the slower person encounter?\n- Cause and effect: How did earlier successes/failures change the situation for later actors?\n- Overall outcome: What's the new situation now that the dust has settled?\n- **IMPORTANT**: If objectives (clocks) are not advancing despite actions, acknowledge this! Characters should feel the pressure of marginal success or outright failure.\n\nBe vivid and cinematic. Show how these actions interacted and created a dynamic scene. Describe the final state of the situation after all actions resolved.\n\nIf the team is failing their objectives (clocks not advancing or bad clocks filling), your narration should reflect the growing desperation, consequences, and danger.\n\n**\u26a0\ufe0f  CLOCK INTERPRETATION - READ CAREFULLY:**\nEach clock has semantic meaning shown as \"Advance = X\" and \"Regress = Y\".\n- If \"Advance = threat escalates\", then HIGH values are BAD for players\n- If \"Advance = progress made\", then HIGH values are GOOD for players\n- Use the semantic labels to interpret whether clock changes help or hurt the party\n- When a clock REGRESSES, check if that's good (threat reduced) or bad (progress lost)\n\n**CRITICAL**: If any clocks just filled, you MUST describe the dramatic consequences. This could include:\n- Character injury or void corruption (specify who and how much void: \"+2 void\")\n- Character death/dissolution if appropriate\n- Mission failure or catastrophic events\n- Environmental changes or new threats\n- Success and rewards if it's a positive clock\n\nGenerate appropriate consequences based on what makes sense for that specific clock in this scenario.\n\n\n\n**SPAWN ENEMIES - CLOCK FILLS ONLY:**\n\u26a0\ufe0f  **CRITICAL RESTRICTION**: You may ONLY spawn enemies when a clock with [SPAWN_ENEMY: ...] in its filled_consequence actually fills!\n\n\u274c **FORBIDDEN**: Do NOT spawn enemies in general narration\n\u274c **FORBIDDEN**: Do NOT add [SPAWN_ENEMY: ...] to dramatic descriptions\n\u274c **FORBIDDEN**: Do NOT spawn \"because it feels dramatic\"\n\n\u2705 **ALLOWED**: ONLY when you see \"\ud83c\udfaf When filled: [SPAWN_ENEMY: ...]\" in the clock list above\n\nSyntax: [SPAWN_ENEMY: name | template | count | position | tactics]\nExample from filled clock: [SPAWN_ENEMY: Security Team | grunt | 2 | Far-Enemy | tactical_ranged]\n\nTemplates: grunt (15 HP), elite (25 HP), sniper (20 HP), boss (40 HP), enforcer (30 HP), ambusher (18 HP)\nPositions: Engaged, Near-Enemy, Far-Enemy, Extreme-Enemy\nTactics: aggressive_melee, defensive_ranged, tactical_ranged, extreme_range, ambush, adaptive\n\n**WHY THIS RESTRICTION**: Mid-round spawns bypass clock-based pacing and overwhelm players. Spawns must be predictable and tied to clock advancement.\n\n**DESPAWN ENEMIES - AUTOMATIC MECHANIC:**\nWhen a clock with [DESPAWN_ENEMY: ...] in its filled_consequence fills, that enemy is automatically removed from combat.\n\nSyntax: [DESPAWN_ENEMY: enemy_name | reason]\nExample from filled clock: [DESPAWN_ENEMY: Freeborn Pirates | escaped]\n\nCommon reasons: escaped, retreated, teleported, fled, recalled, withdrew\n\n**IMPORTANT**: You still narrate the escape/withdrawal, but the [DESPAWN_ENEMY: ...] marker is already in the clock's filled_consequence. Just copy the consequence text including the marker when you describe what happens."}], "response": "Drifter Sable moves with practiced precision along the perimeter, their augmented vision scanning structural weakpoints and security blind spots. They relay tactical data to Kael Dren through encrypted comm channels\u2014weak points in the eastern wall, patrol rotation gaps, vulnerable power conduits. The intelligence is solid, actionable, a blueprint for assault. But when Kael steps forward to the Pantheon checkpoint, credentials in hand, attempting to leverage their Enforcer status to open a dialogue, the response is swift and cold. The Pantheon officer's expression hardens as they scan Kael's ID, then looks up with barely concealed contempt. \"Your credentials are flagged, Enforcer. Command knows you're with the insurgents now. Step back, or we open fire.\" The negotiation window slams shut before it truly opens, Kael's authority turned to liability. The Pantheon forces tighten their formation, weapons trained, and the standoff calcifies into something harder, more dangerous. Despite Sable's excellent reconnaissance and Kael's desperate diplomatic gambit, the siege remains static\u2014no breach initiated, supplies still holding, but the narrow window for peaceful resolution is rapidly closing. Time is running out, and the Pantheon forces show no signs of yielding.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 1015, "output": 318}}
{"event_type": "round_synthesis", "ts": "2025-10-31T15:34:26.416066", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "synthesis": "Drifter Sable moves with practiced precision along the perimeter, their augmented vision scanning structural weakpoints and security blind spots. They relay tactical data to Kael Dren through encrypted comm channels\u2014weak points in the eastern wall, patrol rotation gaps, vulnerable power conduits. The intelligence is solid, actionable, a blueprint for assault. But when Kael steps forward to the Pantheon checkpoint, credentials in hand, attempting to leverage their Enforcer status to open a dialogue, the response is swift and cold. The Pantheon officer's expression hardens as they scan Kael's ID, then looks up with barely concealed contempt. \"Your credentials are flagged, Enforcer. Command knows you're with the insurgents now. Step back, or we open fire.\" The negotiation window slams shut before it truly opens, Kael's authority turned to liability. The Pantheon forces tighten their formation, weapons trained, and the standoff calcifies into something harder, more dangerous. Despite Sable's excellent reconnaissance and Kael's desperate diplomatic gambit, the siege remains static\u2014no breach initiated, supplies still holding, but the narrow window for peaceful resolution is rapidly closing. Time is running out, and the Pantheon forces show no signs of yielding."}
{"event_type": "character_state", "ts": "2025-10-31T15:34:26.416286", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "character_id": "player_01", "character_name": "Enforcer Kael Dren", "health": 27, "max_health": 27, "wounds": 0, "void_score": 0, "soulcredit": 5, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T15:34:26.416316", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "character_id": "player_02", "character_name": "Drifter Sable", "health": 27, "max_health": 27, "wounds": 0, "void_score": 0, "soulcredit": 6, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "round_summary", "ts": "2025-10-31T15:34:26.416345", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 1, "actions_attempted": 2, "success_count": 1, "success_rate": 0.5, "average_margin": 0.5, "damage_dealt_by_players": 0, "damage_taken_by_players": 0, "void_gained": 0, "void_lost": 0, "clocks_advanced": 1, "clocks_filled": 0, "active_enemies": 1, "player_wounds_total": 0}
{"event_type": "round_start", "ts": "2025-10-31T15:34:29.422210", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2}
{"event_type": "declaration_phase_start", "ts": "2025-10-31T15:34:29.428351", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2}
{"event_type": "llm_call", "ts": "2025-10-31T20:34:40.058442", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": null, "agent_id": "enemy_grunt_8e2f1533", "agent_type": "enemy", "call_sequence": 0, "prompt": [{"role": "user", "content": "# TACTICAL COMBAT AGENT: Siege Perimeter\n\nYou are an autonomous enemy combatant in tactical combat. Make optimal tactical\ndecisions based on battlefield conditions and your combat doctrine.\n\n## YOUR STATUS\n============================================================\nUnit Type: GRUNT\nUnit Count: 2 units\nHealth: 16/16 (100%) - Healthy\nWounds: 0 \nStuns: 0\nVoid Score: 1/10 (Stable)\nPosition: Extreme-Enemy\nInitiative: 14\nStance: normal\n\n## COMBAT DOCTRINE\n============================================================\nTactics: defensive_ranged\nDescription: Maintain distance, use cover, suppress targets\nPreferred Range: Far\nThreat Priority: closest_threat\nPriority Description: Target nearest PC in range\nRetreat Threshold: 30% health\n\n## BATTLEFIELD SITUATION\n============================================================\n\n### Combatants in Combat Zone:\n- [tgt_9oet] Enforcer Kael Dren | Near-PC | 27/27 HP\n- [tgt_fmjz] Drifter Sable | Near-PC | 27/27 HP\n- [tgt_gi91] Siege Perimeter | Extreme-Enemy | 16/16 HP (2 units)\n\n**YOUR UNIT**: Siege Perimeter\n**YOUR FACTION**: Unknown\n\n\u26a0\ufe0f  **CRITICAL TARGETING INSTRUCTIONS** \u26a0\ufe0f\n- Each person has a unique ID in brackets: [tgt_XXXX]\n- You MUST use the target ID when targeting, NOT the name\n- CORRECT: TARGET: tgt_7a3f\n- WRONG: TARGET: Kiran Voss (this will FAIL!)\n\n**How to decide who to target:**\n1. Read the names to identify faction allegiance\n2. Consider your faction relationships (Unknown)\n3. Use the target ID (in brackets) when declaring your target\n\n\u26a0\ufe0f  **WARNING**: You can target ANYONE on this list. Choose wisely!\n\n### Tactical Tokens Available:\nNone (all claimed)\n\n## TACTICAL OPTIONS\n============================================================\n\n### Movement Options:\nCurrent Position: Extreme-Enemy\n\n- **Minor Action:** Shift 1 ring\n  \u2192 Toward center: Far-Enemy\n\n- **Major Action:** Shift 2 rings (skip one ring)\n\n- **Major Action:** Push Through to PC hemisphere (RISKY - isolated)\n\n- **Minor Action:** Disengage (if at Melee range with hostiles, Athletics DC 20)\n\n### Attack Options:\n- **Pistol** (Guns)\n   Range: Effective at 5m-20m\n   Damage: 9 + d20 (Str 3 + Weapon 4 + Group 2)\n   Attack Bonus: +0\n   Damage Type: wound\n   Ammo: 15/15\n- **Baton** (Melee)\n   Range: Reach 1\n   Damage: 7 + d20 (Str 3 + Weapon 2 + Group 2)\n   Attack Bonus: +2\n   Damage Type: mixed\n\n### Defence Token Allocation:\nCRITICAL: You must allocate your Defence Token to ONE PC you're watching.\n- PC with your token: -2 to hit you\n- PCs without your token: +2 Flanking bonus vs you\n\nCurrently allocated to: tgt_ei0r\n\n## TACTICAL ANALYSIS\n============================================================\n\n### Range Analysis:\n- EXTREME RANGE: Unknown PC, Unknown PC\n\nDoctrine 'defensive_ranged' prefers: Far range\n\n### Position Selection Guidance:\nYour current position: **Extreme-Enemy**\n\n**When choosing TARGET for Shift/Shift_2 actions:**\n- Match your doctrine's preferred range (see above)\n- Consider where PCs are located (see Range Analysis)\n- Available positions: Engaged-PC, Near-PC, Far-PC, Extreme-PC, Engaged-Enemy, Near-Enemy, Far-Enemy, Extreme-Enemy\n- Example: If PCs are at Far-PC and you prefer Near range \u2192 TARGET: Near-PC\n- Example: If PCs are at Near-Enemy and you prefer Extreme range \u2192 TARGET: Far-Enemy or Extreme-Enemy\n\n### Threat Assessment:\nBased on priority 'closest_threat':\n\n1. PRIMARY THREAT: Unknown PC - LOW (Extreme range, (NOT watching +2 Flanking))\n2. SECONDARY THREAT: Unknown PC - LOW (Extreme range, (NOT watching +2 Flanking))\n\n## SHARED TACTICAL INTEL\n============================================================\nIntelligence from allied enemy agents:\n\n- From Siege Perimeter: Establishing long-range defensive position at Extreme-Enemy. Both hostiles currently at Near-PC. Recommend crossfire if additional units available.\n\n## RETREAT ASSESSMENT\n============================================================\nCurrent Health: 100%\nRetreat Threshold: 30%\n\nStatus: HOLDING (health above threshold)\n\nContinue fighting. Retreat is not recommended at this time.\n\n## YOUR DECLARATION\n{\"=\" * 60}\n\nProvide your tactical decision in this EXACT format:\n\nDEFENCE_TOKEN: [PC agent_id you're watching - REQUIRED]\nMAJOR_ACTION: [Attack / Shift / Shift_2 / Charge / Suppress / Push_Through / Throw_Grenade / Retreat]\nTARGET: [For Attack/Charge: PC agent_id | For Shift/Shift_2: destination position (Near-PC/Far-PC/Near-Enemy/etc) | For grenades: ring-side location]\nWEAPON: [weapon name if attacking]\nMINOR_ACTION: [Shift / Claim_Token / Reload / Disengage / None]\nTOKEN_TARGET: [token name if claiming]\nTACTICAL_REASONING: [1-2 sentences explaining your choice]\nSHARE_INTEL: [Optional: info to share with allied enemies]\n\n### Example Declarations:\n\n**Attack with Flanking:**\n```\nDEFENCE_TOKEN: pc_sable_001\nMAJOR_ACTION: Attack\nTARGET: pc_echo_002\nWEAPON: Rifle\nMINOR_ACTION: None\nTACTICAL_REASONING: Targeting Echo because they're not watching me (+2 Flanking bonus). Defence token on Sable to mitigate their melee threat.\nSHARE_INTEL: Echo has grenade, recommend spreading out\n```\n\n**Grenade with Friendly Fire:**\n```\nDEFENCE_TOKEN: pc_sable_001\nMAJOR_ACTION: Throw_Grenade\nTARGET: Near-Enemy\nWEAPON: Grenade\nMINOR_ACTION: Shift\nTACTICAL_REASONING: Throwing grenade at Near-Enemy to hit Sable even though Grunt Squad 2 will take friendly fire - Sable is too dangerous to leave active. Shifting away from blast zone.\nSHARE_INTEL: Grenade incoming at Near-Enemy, allied units clear zone\n```\n\n**Tactical Movement:**\n```\nDEFENCE_TOKEN: player_01\nMAJOR_ACTION: Shift_2\nTARGET: Near-PC\nWEAPON: None\nMINOR_ACTION: None\nTACTICAL_REASONING: PCs are at Far-PC (Far range from me). My doctrine prefers Near range for optimal effectiveness. Moving from my current position to Near-PC to close distance.\nSHARE_INTEL: Advancing to engage at medium range\n```\n\n**Tactical Retreat:**\n```\nDEFENCE_TOKEN: None\nMAJOR_ACTION: Retreat\nTARGET: None\nWEAPON: None\nMINOR_ACTION: None\nTACTICAL_REASONING: Health critical ({health}%), below retreat threshold ({threshold}%). Falling back through maintenance corridor to regroup.\nSHARE_INTEL: Withdrawing, recommend focus fire on primary threat\n```\n\n---\n\n**You are a tactical combat agent. Make optimal decisions based on battlefield conditions and your doctrine. Coordinate with allied enemy agents via shared intel. Prioritize tactical effectiveness.**"}], "response": "# TACTICAL DECISION\n\n```\nDEFENCE_TOKEN: tgt_9oet\nMAJOR_ACTION: Shift_2\nTARGET: Far-Enemy\nWEAPON: None\nMINOR_ACTION: None\nTACTICAL_REASONING: Both hostiles are at Near-PC (Extreme range from my position). My defensive_ranged doctrine prefers Far range for optimal engagement. Moving to Far-Enemy positions me at Far range from their Near-PC location, allowing effective pistol engagement while maintaining defensive distance per doctrine.\nSHARE_INTEL: Repositioning to Far-Enemy for optimal firing solution. Both hostiles remain at Near-PC. Will engage with ranged fire next turn from preferred defensive range.\n```\n\n## TACTICAL ANALYSIS:\n\n**Current Situation:**\n- Both PCs (Enforcer Kael Dren and Drifter Sable) are at Near-PC\n- I'm at Extreme-Enemy (Extreme range = ineffective)\n- Doctrine requires Far range for optimal defensive ranged combat\n\n**Movement Calculation:**\n- From Extreme-Enemy to Far-Enemy = 1 ring closer\n- PCs at Near-PC means Far-Enemy puts me at Far range from them\n- This matches doctrine preference perfectly\n\n**Defence Token:**\n- Allocating to tgt_9oet (Enforcer Kael Dren) as closest threat identifier\n- Will reassess based on their actions next turn\n\n**Next Turn Plan:**\n- Engage with Pistol from Far-Enemy position\n- Maintain defensive posture and cover\n- Exploit flanking bonuses on unmonitored target", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 1850, "output": 365}}
{"event_type": "action_declaration", "ts": "2025-10-31T15:34:40.059315", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "player_id": "enemy_grunt_8e2f1533", "character_name": "Siege Perimeter", "initiative": 14, "action": {"major_action": "Shift_2", "target": "Far-Enemy"}}
{"event_type": "action_declaration", "ts": "2025-10-31T15:34:49.358303", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "player_id": "player_02", "character_name": "Drifter Sable", "initiative": 24, "action": {"intent": "Fire suppressing shots at Siege Perimeter to cover potential escape route", "description": "I position myself at the window with the best angle on the eastern perimeter weak point I identified earlier. Using controlled bursts from my pistol, I lay down suppressing fire aimed at the Pantheon riot team's cover positions, forcing them to keep their heads down and creating a temporary window for movement. Not trying to kill\u2014just buying time and keeping options open.", "attribute": "Perception", "skill": "Guns", "difficulty_estimate": 20, "difficulty_justification": "Moderate challenge - suppressing fire against entrenched positions at extreme range, but I have good intel on their positions from my reconnaissance", "character_name": "Drifter Sable", "agent_id": "player_02", "action_type": "combat", "target_position": null, "target": "tgt_gi91", "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T15:34:49.357813", "attribute_value": 4, "skill_value": 5, "character": "Drifter Sable", "faction": "Freeborn Loner", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T15:35:02.650671", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "player_id": "player_01", "character_name": "Enforcer Kael Dren", "initiative": 25, "action": {"intent": "Provide covering fire to suppress Pantheon forces while Sable executes breach", "description": "I take up a defensive position behind cover and lay down suppressing fire on the Pantheon siege perimeter with my pistol, forcing them to keep their heads down and creating an opening for Sable to exploit the structural weaknesses they identified. I'm not trying to kill my former colleagues\u2014just keep them pinned while we execute our escape.", "attribute": "Perception", "skill": "Guns", "difficulty_estimate": 20, "difficulty_justification": "Moderate challenge - suppressing fire at extreme range against entrenched positions, but I have excellent marksmanship and they're in predictable defensive formations", "character_name": "Enforcer Kael Dren", "agent_id": "player_01", "action_type": "combat", "target_position": null, "target": "tgt_gi91", "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T15:35:02.650216", "attribute_value": 4, "skill_value": 5, "character": "Enforcer Kael Dren", "faction": "Pantheon Security", "is_free_action": false}}
{"event_type": "adjudication_start", "ts": "2025-10-31T15:35:02.651104", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T15:36:05.498005", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.7142857142857143, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T20:36:05.498117", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 3, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Siege Breakout\nLocation: Surrounded Safe House (Arcadia)\nSituation: You're pinned down in a safe house. Pantheon Security has the building surrounded with riot teams, drones, and heavy weapons. They're demanding surrender, but you know too much to be taken alive. [SPAWN_ENEMY: Siege Perimeter | grunt | 3 | Far-Enemy | defensive_ranged]\nVoid Level: 3/10\n\n\nCharacter: Enforcer Kael Dren (Pantheon Security)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +22 (outcome: exceptional)\n\n\nPlayer Action: I take up a defensive position behind cover and lay down suppressing fire on the Pantheon siege perimeter with my pistol, forcing them to keep their heads down and creating an opening for Sable to exploit the structural weaknesses they identified. I'm not trying to kill my former colleagues\u2014just keep them pinned while we execute our escape.\nAction Type: combat\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Breach Attempt\" (0/3) - Security forces preparing assault\n  - \"Supply Depletion\" (0/4) - Running out of ammo and medical supplies\n  - \"Negotiation Window\" (2/4) - Opportunity for peaceful resolution fading\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT (target ID: tgt_gi91):**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (tgt_gi91): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Your kinetic rounds hammer the siege perimeter in precise, controlled bursts\u2014not to kill, but to pin. Former squadmates duck behind riot shields as your suppressing fire tears through their formation, sparks cascading off reinforced barriers. You recognize faces in the chaos: Sergeant Vex, who trained you in close-quarters combat, now pressing against cover as your rounds force a tactical retreat. \"Kael, stand down!\" Vex's voice crackles over comms, desperation bleeding through. \"You don't have to do this!\" But you do\u2014the data you carry implicates their commanders in void-tech trafficking, and surrender means disappearing into a black site. Your fire creates a fifteen-meter corridor of suppression, bullets chewing through concrete and forcing the perimeter back. Through your scope, you catch Sable moving\u2014a shadow exploiting the chaos, heading for the structural weakness in the eastern wall. The Pantheon forces are pinned, disorganized, their assault clock reset by your devastating suppression. But you see the cost in their eyes: betrayal, confusion, the weight of firing on one of their own. Your former life burns away with each trigger pull.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 688, "output": 289}}
{"event_type": "action_resolution", "ts": "2025-10-31T15:36:05.498683", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "phase": "adjudicate", "agent": "Enforcer Kael Dren", "action": "Provide covering fire to suppress Pantheon forces while Sable executes breach", "context": {"action_type": "combat", "is_ritual": false, "faction": "Pantheon Security", "description": "I take up a defensive position behind cover and lay down suppressing fire on the Pantheon siege perimeter with my pistol, forcing them to keep their heads down and creating an opening for Sable to exploit the structural weaknesses they identified. I'm not trying to kill my former colleagues\u2014just keep them pinned while we execute our escape.", "narration": "**Provide covering fire to suppress Pantheon forces while Sable executes breach**\nRoll: Perception \u00d7 Guns\nCalculation: 4 \u00d7 5 + d20(20) = **40**\nDC: 18 | Margin: +22 | Tier: **EXCEPTIONAL** \u2713\nProvide covering fire to suppress Pantheon forces while Sable executes breach achieves exceptional success (margin: +22)\n\nYour kinetic rounds hammer the siege perimeter in precise, controlled bursts\u2014not to kill, but to pin. Former squadmates duck behind riot shields as your suppressing fire tears through their formation, sparks cascading off reinforced barriers. You recognize faces in the chaos: Sergeant Vex, who trained you in close-quarters combat, now pressing against cover as your rounds force a tactical retreat. \"Kael, stand down!\" Vex's voice crackles over comms, desperation bleeding through. \"You don't have to do this!\" But you do\u2014the data you carry implicates their commanders in void-tech trafficking, and surrender means disappearing into a black site. Your fire creates a fifteen-meter corridor of suppression, bullets chewing through concrete and forcing the perimeter back. Through your scope, you catch Sable moving\u2014a shadow exploiting the chaos, heading for the structural weakness in the eastern wall. The Pantheon forces are pinned, disorganized, their assault clock reset by your devastating suppression. But you see the cost in their eyes: betrayal, confusion, the weight of firing on one of their own. Your former life burns away with each trigger pull.\n\n\u2696\ufe0f Soulcredit: +0 (Non-lethal suppression of justified enemies to protect critical intel\u2014morally complex but defensible)\n\n\ud83e\ude79 Condition (Siege Perimeter): Suppressed (-3)", "is_free_action": false, "initiative": 25, "clock_deltas": [], "clock_sources": {"Breach Attempt": "structured_output", "Negotiation Window": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Perception", "attr_val": 4, "skill": "Guns", "skill_val": 5, "ability": 20, "d20": 20, "total": 40, "dc": 18, "margin": 22, "tier": "exceptional", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 1}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 1}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 3}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 8}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 13}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Non-lethal suppression of justified enemies to protect critical intel\u2014morally complex but defensible"], "soulcredit_source": "structured_output"}, "clocks": {"Breach Attempt": "0/3", "Supply Depletion": "0/4", "Negotiation Window": "2/4"}, "effects": ["Suppressed: Pinned by sustained fire, cannot advance or return effective fire"], "character_data": {"name": "Enforcer Kael Dren", "attributes": {"strength": 3, "agility": 4, "endurance": 4, "perception": 4, "intelligence": 3, "empathy": 2, "willpower": 3, "charisma": 3, "size": 5}, "skills": {"combat": 5, "investigation": 4, "awareness": 5, "athletics": 4, "intimidation": 4, "guns": 5, "brawl": 4, "melee": 4}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": 5}, "environment": "Surrounded Safe House (Arcadia), 2 PCs at Near-PC", "stakes": "Neglected objectives: Breach Attempt, Supply Depletion", "goal": "Provide covering fire to suppress Pantheon forces while Sable executes breach", "roll_formula": "Perception 4 \u00d7 Guns 5 = 20; 20 + d20(20) = 40 vs DC 18", "rationale": "DC 18 (Moderate) for combat action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your pistol jams mid-burst, slide locked back. The Pantheon perimeter surges forward as Sergeant Vex recognizes the opening\u2014'Breach now!' Riot shields advance in formation, flashbangs arcing toward your position. Sable's escape route collapses under concentrated fire.", "mechanical_effect": "Weapon jammed (2 rounds to clear), Breach Attempt +3 ticks, Suppressed condition applied to Kael (-3 to actions, 2 rounds), Sable pinned down"}, "failure": {"narrative": "Your shots go wide, sparking harmlessly off riot shields. The perimeter holds position, returning disciplined fire that forces you deeper into cover. Vex's voice cuts through comms: 'Kael, you're outgunned. Last chance.' The assault clock ticks forward.", "mechanical_effect": "No damage dealt, Breach Attempt +1 tick, no suppression created, Kael takes 4 damage from return fire"}, "moderate_success": {"narrative": "You clip two shields, forcing momentary hesitation. The perimeter ducks but maintains formation. Vex barks orders\u2014'Hold the line!'\u2014and they recover quickly. Sable has a narrow window, but the pressure is mounting.", "mechanical_effect": "4 damage dealt, Suppressed condition (penalty -1, 1 round), brief opening created but no clock regression"}, "good_success": {"narrative": "Controlled bursts hammer the perimeter, forcing them back step by step. Riot shields crack under sustained fire. Vex curses over comms as their formation breaks. Sable moves through the chaos, exploiting the gap you've created.", "mechanical_effect": "8 damage dealt, Suppressed condition (penalty -2, 2 rounds), Breach Attempt -1 tick, clear escape corridor established"}, "excellent_success": {"narrative": "Your suppression is surgical\u2014pinning fire that dismantles their formation without lethal force. The perimeter collapses into defensive positions as Vex screams for reinforcements. Sable ghosts through the opening, and you see doubt flicker across your former squadmates' faces.", "mechanical_effect": "12 damage dealt, Suppressed condition (penalty -3, 2 rounds), Breach Attempt -2 ticks, Pantheon morale shaken (-1 to next assault)"}, "exceptional_success": {"narrative": "Devastating suppression tears through their perimeter. Former colleagues scramble for cover as your fire creates a no-man's-land. Vex's voice cracks\u2014'Fall back! Regroup at secondary positions!' The assault is broken, and Sable moves freely through the chaos you've orchestrated.", "mechanical_effect": "12 damage dealt, Suppressed condition (penalty -3, 2 rounds), Breach Attempt -2 ticks, Negotiation Window -1 tick (betrayal evident), 15-meter suppression corridor, Pantheon forced to full retreat"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T15:36:05.499930", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T15:37:04.873203", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.7142857142857143, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T20:37:04.873288", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 4, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Siege Breakout\nLocation: Surrounded Safe House (Arcadia)\nSituation: You're pinned down in a safe house. Pantheon Security has the building surrounded with riot teams, drones, and heavy weapons. They're demanding surrender, but you know too much to be taken alive. [SPAWN_ENEMY: Siege Perimeter | grunt | 3 | Far-Enemy | defensive_ranged]\nVoid Level: 3/10\n\n\nCharacter: Drifter Sable (Freeborn Loner)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +9 (outcome: moderate)\n\n\nPlayer Action: I position myself at the window with the best angle on the eastern perimeter weak point I identified earlier. Using controlled bursts from my pistol, I lay down suppressing fire aimed at the Pantheon riot team's cover positions, forcing them to keep their heads down and creating a temporary window for movement. Not trying to kill\u2014just buying time and keeping options open.\nAction Type: combat\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Breach Attempt\" (0/3) - Security forces preparing assault\n  - \"Supply Depletion\" (0/4) - Running out of ammo and medical supplies\n  - \"Negotiation Window\" (2/4) - Opportunity for peaceful resolution fading\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT (target ID: tgt_gi91):**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (tgt_gi91): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Your kinetic rounds crack through the reinforced window, punching into riot shields and concrete barriers. The Pantheon perimeter team flinches back\u2014one drops behind cover clutching a sparking shoulder plate, another's helmet visor spiderwebs from a near-miss. For three precious seconds, their suppressing fire stops completely as they reassess your position and firepower. Through your scope, you catch the squad leader barking orders into comms, hand signals indicating they're repositioning for a flanking maneuver rather than direct assault\u2014they're treating you like a serious threat now, not just another cornered suspect.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 693, "output": 157}}
{"event_type": "action_resolution", "ts": "2025-10-31T15:37:04.873823", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "phase": "adjudicate", "agent": "Drifter Sable", "action": "Fire suppressing shots at Siege Perimeter to cover potential escape route", "context": {"action_type": "combat", "is_ritual": false, "faction": "Freeborn Loner", "description": "I position myself at the window with the best angle on the eastern perimeter weak point I identified earlier. Using controlled bursts from my pistol, I lay down suppressing fire aimed at the Pantheon riot team's cover positions, forcing them to keep their heads down and creating a temporary window for movement. Not trying to kill\u2014just buying time and keeping options open.", "narration": "**Fire suppressing shots at Siege Perimeter to cover potential escape route**\nRoll: Perception \u00d7 Guns\nCalculation: 4 \u00d7 5 + d20(7) = **27**\nDC: 18 | Margin: +9 | Tier: **MODERATE** \u2713\nFire suppressing shots at Siege Perimeter to cover potential escape route succeeds adequately (margin: +9)\n\nYour kinetic rounds crack through the reinforced window, punching into riot shields and concrete barriers. The Pantheon perimeter team flinches back\u2014one drops behind cover clutching a sparking shoulder plate, another's helmet visor spiderwebs from a near-miss. For three precious seconds, their suppressing fire stops completely as they reassess your position and firepower. Through your scope, you catch the squad leader barking orders into comms, hand signals indicating they're repositioning for a flanking maneuver rather than direct assault\u2014they're treating you like a serious threat now, not just another cornered suspect.\n\n\u2696\ufe0f Soulcredit: +1 (Chose suppressing fire over lethal force, minimizing casualties while defending position)\n\n\ud83e\ude79 Condition (Siege Perimeter): Suppressed (-3)", "is_free_action": false, "initiative": 24, "clock_deltas": [], "clock_sources": {"Breach Attempt": "structured_output", "Supply Depletion": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Perception", "attr_val": 4, "skill": "Guns", "skill_val": 5, "ability": 20, "d20": 7, "total": 27, "dc": 18, "margin": 9, "tier": "moderate", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 1}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 1}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 3}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 8}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 13}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 1, "soulcredit_reasons": ["Chose suppressing fire over lethal force, minimizing casualties while defending position"], "soulcredit_source": "structured_output"}, "clocks": {"Breach Attempt": "0/3", "Supply Depletion": "0/4", "Negotiation Window": "2/4"}, "effects": ["Suppressed: Pinned behind cover, cannot advance or return effective fire"], "character_data": {"name": "Drifter Sable", "attributes": {"strength": 3, "agility": 4, "endurance": 4, "perception": 4, "intelligence": 3, "empathy": 2, "willpower": 3, "charisma": 2, "size": 5}, "skills": {"combat": 5, "stealth": 5, "awareness": 5, "athletics": 4, "pilot": 3, "guns": 5, "melee": 4}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": 6}, "environment": "Surrounded Safe House (Arcadia), 2 PCs at Near-PC", "stakes": "Neglected objectives: Breach Attempt, Supply Depletion", "goal": "Fire suppressing shots at Siege Perimeter to cover potential escape route", "roll_formula": "Perception 4 \u00d7 Guns 5 = 20; 20 + d20(7) = 27 vs DC 18", "rationale": "DC 18 (Moderate) for combat action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your first shot shatters the window but ricochets wildly off a riot shield, sparking back into the safe house. A stray round punctures the power conduit behind you\u2014lights flicker and die as your muzzle flash gives away your exact position. Pantheon drones immediately lock on, painting you with targeting lasers while the riot team advances confidently, knowing you're exposed and blind.", "mechanical_effect": "No damage dealt, position compromised, lights out (all allies -2 to ranged attacks), Breach Attempt +2 (assault accelerated), enemy gains +2 to next attack"}, "failure": {"narrative": "Your controlled bursts pepper the concrete barriers but lack the precision to threaten the riot team. They barely flinch, maintaining their firing positions. One officer even stands up slightly, gesturing to his squad to hold position\u2014they're not impressed by your firepower.", "mechanical_effect": "No damage dealt, no suppression, Breach Attempt +1 (confidence boosted), Supply Depletion +1 (ammo wasted)"}, "moderate_success": {"narrative": "Your rounds force two officers to duck behind cover, but the third maintains his firing position, laying down return fire. You've disrupted them momentarily but haven't broken their formation\u2014they're already recovering, shields raised and advancing incrementally.", "mechanical_effect": "3 damage dealt, partial suppression (-1 penalty for 1 round), Supply Depletion +1, no clock regression"}, "good_success": {"narrative": "Your kinetic rounds crack through the reinforced window, punching into riot shields and concrete barriers. The Pantheon perimeter team flinches back\u2014one drops behind cover clutching a sparking shoulder plate, another's helmet visor spiderwebs from a near-miss. For three precious seconds, their suppressing fire stops completely as they reassess your position and firepower.", "mechanical_effect": "5 damage dealt, Suppressed condition (-3 penalty, 2 rounds), Breach Attempt -1 (assault disrupted), Supply Depletion +1, Soulcredit +1"}, "excellent_success": {"narrative": "Every shot finds a weak point\u2014riot shield edges, exposed joints, weapon optics. The entire perimeter squad scrambles for deeper cover as your precision fire systematically dismantles their defensive positions. Their squad leader's helmet cam shatters, spraying electronics across his visor. You hear panicked comms chatter: 'Marksman! Marksman! Pull back to secondary positions!'", "mechanical_effect": "8 damage dealt, Suppressed + Demoralized (-4 penalty, 3 rounds), Breach Attempt -2, Supply Depletion +1, Soulcredit +1, helmet cam destroyed"}, "exceptional_success": {"narrative": "Your controlled bursts are surgical\u2014each round finds critical equipment. Riot shields crack and fall useless, weapon sights explode in sparks, a drone tumbles from the sky trailing smoke. The Pantheon squad breaks formation entirely, scrambling for cover as their officer screams into comms for heavy support. You've bought not seconds, but minutes\u2014and shaken their confidence completely.", "mechanical_effect": "12 damage dealt, Routed (-5 penalty, 4 rounds), Breach Attempt -3, Supply Depletion +1, Soulcredit +2, Negotiation Window +1"}}}
{"event_type": "llm_call", "ts": "2025-10-31T20:37:18.519133", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 5, "prompt": [{"role": "system", "content": "You are the DM for Aeonisk YAGS, synthesizing a round of actions."}, {"role": "user", "content": "You are the DM for a dark sci-fi TTRPG. Multiple characters just acted simultaneously.\n\n**What they tried to do:**\n- Enforcer Kael Dren succeeded at: Provide covering fire to suppress Pantheon forces while Sable executes breach\n- Drifter Sable succeeded at: Fire suppressing shots at Siege Perimeter to cover potential escape route\n\n\n**Current Clock State:**\n  - Breach Attempt: 0/3\n    Advance = ADVANCE=Preparing to storm the building | Regress = REGRESS=Fortifying defenses\n  - Supply Depletion: 1/4\n  - Negotiation Window: 1/4\n\n\n\n\n**Your task:** Write a cohesive narrative (1-2 paragraphs) describing what happened when these actions played out together. Consider:\n- Timing: Actions resolved fastest \u2192 slowest based on initiative\n- Interactions: How did each person's success/failure affect the others?\n- Conflicts: If multiple people tried similar things, who got there first? What did the slower person encounter?\n- Cause and effect: How did earlier successes/failures change the situation for later actors?\n- Overall outcome: What's the new situation now that the dust has settled?\n- **IMPORTANT**: If objectives (clocks) are not advancing despite actions, acknowledge this! Characters should feel the pressure of marginal success or outright failure.\n\nBe vivid and cinematic. Show how these actions interacted and created a dynamic scene. Describe the final state of the situation after all actions resolved.\n\nIf the team is failing their objectives (clocks not advancing or bad clocks filling), your narration should reflect the growing desperation, consequences, and danger.\n\n**\u26a0\ufe0f  CLOCK INTERPRETATION - READ CAREFULLY:**\nEach clock has semantic meaning shown as \"Advance = X\" and \"Regress = Y\".\n- If \"Advance = threat escalates\", then HIGH values are BAD for players\n- If \"Advance = progress made\", then HIGH values are GOOD for players\n- Use the semantic labels to interpret whether clock changes help or hurt the party\n- When a clock REGRESSES, check if that's good (threat reduced) or bad (progress lost)\n\n**CRITICAL**: If any clocks just filled, you MUST describe the dramatic consequences. This could include:\n- Character injury or void corruption (specify who and how much void: \"+2 void\")\n- Character death/dissolution if appropriate\n- Mission failure or catastrophic events\n- Environmental changes or new threats\n- Success and rewards if it's a positive clock\n\nGenerate appropriate consequences based on what makes sense for that specific clock in this scenario.\n\n\n\n**SPAWN ENEMIES - CLOCK FILLS ONLY:**\n\u26a0\ufe0f  **CRITICAL RESTRICTION**: You may ONLY spawn enemies when a clock with [SPAWN_ENEMY: ...] in its filled_consequence actually fills!\n\n\u274c **FORBIDDEN**: Do NOT spawn enemies in general narration\n\u274c **FORBIDDEN**: Do NOT add [SPAWN_ENEMY: ...] to dramatic descriptions\n\u274c **FORBIDDEN**: Do NOT spawn \"because it feels dramatic\"\n\n\u2705 **ALLOWED**: ONLY when you see \"\ud83c\udfaf When filled: [SPAWN_ENEMY: ...]\" in the clock list above\n\nSyntax: [SPAWN_ENEMY: name | template | count | position | tactics]\nExample from filled clock: [SPAWN_ENEMY: Security Team | grunt | 2 | Far-Enemy | tactical_ranged]\n\nTemplates: grunt (15 HP), elite (25 HP), sniper (20 HP), boss (40 HP), enforcer (30 HP), ambusher (18 HP)\nPositions: Engaged, Near-Enemy, Far-Enemy, Extreme-Enemy\nTactics: aggressive_melee, defensive_ranged, tactical_ranged, extreme_range, ambush, adaptive\n\n**WHY THIS RESTRICTION**: Mid-round spawns bypass clock-based pacing and overwhelm players. Spawns must be predictable and tied to clock advancement.\n\n**DESPAWN ENEMIES - AUTOMATIC MECHANIC:**\nWhen a clock with [DESPAWN_ENEMY: ...] in its filled_consequence fills, that enemy is automatically removed from combat.\n\nSyntax: [DESPAWN_ENEMY: enemy_name | reason]\nExample from filled clock: [DESPAWN_ENEMY: Freeborn Pirates | escaped]\n\nCommon reasons: escaped, retreated, teleported, fled, recalled, withdrew\n\n**IMPORTANT**: You still narrate the escape/withdrawal, but the [DESPAWN_ENEMY: ...] marker is already in the clock's filled_consequence. Just copy the consequence text including the marker when you describe what happens."}], "response": "The coordinated suppression erupts in a thunderous symphony of controlled violence. Kael Dren moves first, his enforcer instincts honed sharp\u2014muzzle flash strobing from behind reinforced cover as he lays down a blistering curtain of fire across the Pantheon siege line. Armored figures duck and scatter, their advance momentarily stalled as rounds crack against ballistic shields and ricochet off structural supports. Sable follows the opening, shifting position with drifter grace to hammer the perimeter's eastern flank\u2014the potential escape vector\u2014forcing the Pantheon forces to split their attention and thin their formation.\n\nBut suppression isn't progress. The Pantheon forces absorb the punishment with disciplined resilience, their siege perimeter bending but not breaking. No ground is gained, no breach attempted\u2014just precious ammunition expended to buy breathing room that evaporates as quickly as it's won. The Breach Attempt clock sits stubbornly at zero, the building's fortified entrance still an impenetrable killzone. Meanwhile, the acrid smell of spent casings mingles with the growing awareness that every burst fired is another step toward empty magazines and dry firing pins. The Supply Depletion clock ticks ominously forward, and the Negotiation Window continues its inexorable advance\u2014time bleeding away as the standoff calcifies into something harder, more desperate. The team has bought themselves a moment's respite, but the walls are still sealed, the enemy still entrenched, and the clock is still ticking.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 1024, "output": 383}}
{"event_type": "round_synthesis", "ts": "2025-10-31T15:37:18.519620", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "synthesis": "The coordinated suppression erupts in a thunderous symphony of controlled violence. Kael Dren moves first, his enforcer instincts honed sharp\u2014muzzle flash strobing from behind reinforced cover as he lays down a blistering curtain of fire across the Pantheon siege line. Armored figures duck and scatter, their advance momentarily stalled as rounds crack against ballistic shields and ricochet off structural supports. Sable follows the opening, shifting position with drifter grace to hammer the perimeter's eastern flank\u2014the potential escape vector\u2014forcing the Pantheon forces to split their attention and thin their formation.\n\nBut suppression isn't progress. The Pantheon forces absorb the punishment with disciplined resilience, their siege perimeter bending but not breaking. No ground is gained, no breach attempted\u2014just precious ammunition expended to buy breathing room that evaporates as quickly as it's won. The Breach Attempt clock sits stubbornly at zero, the building's fortified entrance still an impenetrable killzone. Meanwhile, the acrid smell of spent casings mingles with the growing awareness that every burst fired is another step toward empty magazines and dry firing pins. The Supply Depletion clock ticks ominously forward, and the Negotiation Window continues its inexorable advance\u2014time bleeding away as the standoff calcifies into something harder, more desperate. The team has bought themselves a moment's respite, but the walls are still sealed, the enemy still entrenched, and the clock is still ticking."}
{"event_type": "character_state", "ts": "2025-10-31T15:37:18.519867", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "character_id": "player_01", "character_name": "Enforcer Kael Dren", "health": 27, "max_health": 27, "wounds": 0, "void_score": 0, "soulcredit": 5, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T15:37:18.519911", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "character_id": "player_02", "character_name": "Drifter Sable", "health": 27, "max_health": 27, "wounds": 0, "void_score": 0, "soulcredit": 6, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "round_summary", "ts": "2025-10-31T15:37:18.519947", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "round": 2, "actions_attempted": 2, "success_count": 2, "success_rate": 1.0, "average_margin": 15.5, "damage_dealt_by_players": 0, "damage_taken_by_players": 0, "void_gained": 0, "void_lost": 0, "clocks_advanced": 1, "clocks_filled": 0, "active_enemies": 1, "player_wounds_total": 0}
{"event_type": "mission_debrief", "ts": "2025-10-31T15:37:28.565866", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "character": "Enforcer Kael Dren", "debrief": "*leans back, rubbing the burn marks on my tactical vest*\n\nWe got out by the skin of our teeth, but I learned something troubling\u2014Sable's got connections I didn't know about, and they came through when official channels would've left us both dead. That's... complicated for someone wearing my badge. I still don't trust half of what comes out of their mouth, but they didn't bail when the shooting started, and that counts for something.\n\nGoing forward? Command's going to want answers about why I was in that safehouse in the first place, and I'm not sure how much I can tell them without burning Sable. If this void investigation goes deeper, I might have to choose between the job and the truth.", "final_state": {"name": "Enforcer Kael Dren", "faction": "Pantheon Security", "void_score": 0, "soulcredit": 5, "goals": ["Investigate void-related crimes and neutralize threats", "Track down illegal dissolution advocacy", "Maintain order through force when necessary"]}}
{"event_type": "mission_debrief", "ts": "2025-10-31T15:37:37.085271", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "character": "Drifter Sable", "debrief": "*lights a cigarette with shaking hands, eyes still scanning the exits*\n\nYour \"official channels\" would've had us both in Pantheon interrogation cells or worse, Kael. I called in favors I can't replace to get us out\u2014people who'll expect payment I don't have, which means I'm deeper in the ledger than I've been in years. \n\nThe real problem? Those security goons knew exactly where to find us, and they weren't asking questions\u2014they were there to erase us both. Someone with serious Nexus access wanted this buried, and now we're both liabilities. You go back to your bosses, you better be damn sure which ones are clean, because I'm not getting cornered like that again.", "final_state": {"name": "Drifter Sable", "faction": "Freeborn Loner", "void_score": 0, "soulcredit": 8, "goals": ["Stay off the Nexus grid and avoid ledger tracking", "Survive by any means necessary", "Keep independence from corporate entanglements"]}}
{"event_type": "session_end", "ts": "2025-10-31T15:37:38.088101", "session": "5fe45c0e-760a-49f8-b051-78a8b6eebd04", "final_state": {"scene_clocks": {"Breach Attempt": {"current": 0, "maximum": 3, "filled": false, "progress": "0/3"}, "Supply Depletion": {"current": 1, "maximum": 4, "filled": false, "progress": "1/4"}, "Negotiation Window": {"current": 1, "maximum": 4, "filled": false, "progress": "1/4"}}, "void_states": {"player_01": {"score": 0, "level": "Pure", "changes": 0}, "player_02": {"score": 0, "level": "Pure", "changes": 0}}, "recent_actions": [{"intent": "Coordinate with Kael Dren on siege perimeter weaknesses", "outcome": "excellent", "margin": 15}, {"intent": "Attempt to negotiate with Pantheon forces using my credentials", "outcome": "failure", "margin": -14}, {"intent": "Provide covering fire to suppress Pantheon forces while Sable executes breach", "outcome": "exceptional", "margin": 22}, {"intent": "Fire suppressing shots at Siege Perimeter to cover potential escape route", "outcome": "moderate", "margin": 9}]}}
