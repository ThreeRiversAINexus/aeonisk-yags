{"event_type": "session_start", "ts": "2025-10-31T17:13:32.471379", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "config": {"session_name": "full_spectrum_test", "max_turns": 5, "party_size": 3, "output_dir": "./multiagent_output", "enable_human_interface": true, "_comment_vendors": "=== VENDOR SYSTEM ===", "_vendor_info": "vendor_spawn_frequency: -1 (disabled), 0 (off), N (spawn every N rounds). Vendors offer equipment, ritual supplies, seeds, and services.", "vendor_spawn_frequency": 5, "_comment_tactical": "=== TACTICAL MODULE v1.2.3 ===", "tactical_module_enabled": true, "enemy_agents_enabled": true, "enemy_agent_config": {"free_targeting_mode": true, "allow_groups": true, "max_enemies_per_combat": 20, "shared_intel_enabled": true, "auto_execute_reactions": true, "loot_suggestions_enabled": true, "void_tracking_enabled": true}, "_comment_spawn_examples": "DM can spawn enemies with: [SPAWN_ENEMY: name | template | count | position | tactics]", "_example_basic": "[SPAWN_ENEMY: Thugs | grunt | 3 | Near-Enemy | aggressive_melee]", "_example_sniper": "[SPAWN_ENEMY: Rooftop Sniper | sniper | 1 | Extreme-Enemy | extreme_range]", "_example_boss": "[SPAWN_ENEMY: Gang Leader | boss | 1 | Near-Enemy | adaptive]", "agents": {"dm": {"llm": {"provider": "anthropic", "model": "claude-sonnet-4-5", "temperature": 0.7}}, "players": [{"name": "Riven Ashglow", "faction": "Resonance Communes", "llm": {"provider": "anthropic", "model": "claude-sonnet-4-5", "temperature": 0.8}, "personality": {"riskTolerance": 7, "voidCuriosity": 5, "bondPreference": "avoids", "ritualConservatism": 3}, "attributes": {"Strength": 2, "Agility": 4, "Endurance": 2, "Perception": 3, "Intelligence": 3, "Empathy": 4, "Willpower": 4, "Charisma": 3}, "skills": {"Astral Arts": 6, "Attunement": 5, "Charm": 3, "Awareness": 3, "Stealth": 3, "Melee": 3}, "void_score": 3, "soulcredit": -4, "goals": ["Pay off crushing debt to ACG", "Regain standing with Resonance Communes", "Avoid further void corruption while doing risky work"], "equipped_weapons": {"primary": "combat_knife"}, "carried_weapons": [], "inventory": {"combat_knife": 1, "crystal_focus": 1, "incense": 2, "drip_talisman": 2, "memory_crystal": 1}, "pronouns": "they/them"}, {"name": "Ash Vex", "faction": "Tempest Industries", "llm": {"provider": "anthropic", "model": "claude-sonnet-4-5", "temperature": 0.8}, "personality": {"riskTolerance": 8, "voidCuriosity": 8, "bondPreference": "avoids", "ritualConservatism": 2}, "attributes": {"Strength": 3, "Agility": 4, "Endurance": 3, "Perception": 4, "Intelligence": 4, "Empathy": 2, "Willpower": 3, "Charisma": 2}, "skills": {"Astral Arts": 4, "Systems": 5, "Stealth": 4, "Awareness": 4, "Drone Operation": 4, "Guns": 3}, "void_score": 4, "soulcredit": -1, "goals": ["Study void phenomena for Tempest research", "Prove void mastery is possible without total corruption", "Avoid tribunal and memory-wipe by staying useful"], "equipped_weapons": {"primary": "pistol"}, "carried_weapons": [], "inventory": {"pistol": 1, "void_scanner": 1, "drone_controller": 1, "null_ritual_dampener": 1, "hollow_seed": 2, "voidshroud_drape": 1, "neural_stimulant": 1}, "pronouns": "he/him"}, {"name": "Recursionist Vale", "faction": "Fractal Praxis", "llm": {"provider": "anthropic", "model": "claude-sonnet-4-5", "temperature": 0.8}, "personality": {"riskTolerance": 6, "voidCuriosity": 7, "bondPreference": "avoids", "ritualConservatism": 3}, "attributes": {"Strength": 2, "Agility": 3, "Endurance": 3, "Perception": 3, "Intelligence": 5, "Empathy": 2, "Willpower": 4, "Charisma": 2}, "skills": {"Astral Arts": 6, "Attunement": 5, "Magick Theory": 4, "Systems": 4, "Awareness": 3}, "void_score": 3, "soulcredit": -1, "goals": ["Study nested reality loops and soul recursion", "Prove consciousness is fractal in nature", "Avoid Nexus surveillance of philosophical research"], "equipped_weapons": {"primary": "fists"}, "carried_weapons": [], "inventory": {"recursion_mirror": 1, "data_slate": 1, "crystal_focus": 1, "neural_stimulant": 1, "memory_crystal": 2}, "pronouns": "they/them"}]}, "notes": "Full character pool - 21 characters across 10 factions. Random selection of 3 per session."}, "random_seed": 1012205817, "git_commit": "631860b", "version": "1.0.0"}
{"event_type": "llm_call", "ts": "2025-10-31T22:13:48.453786", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": null, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 0, "prompt": [{"role": "user", "content": "Generate a unique Aeonisk YAGS scenario for a tabletop RPG session.\n\n\n=== PARTY COMPOSITION ===\nYour scenario MUST be appropriate for this specific party:\n\n**Riven Ashglow** (Resonance Communes)\n  Goals:\n  - Pay off crushing debt to ACG\n  - Regain standing with Resonance Communes\n  - Avoid further void corruption while doing risky work\n\n**Ash Vex** (Tempest Industries)\n  Goals:\n  - Study void phenomena for Tempest research\n  - Prove void mastery is possible without total corruption\n  - Avoid tribunal and memory-wipe by staying useful\n\n**Recursionist Vale** (Fractal Praxis)\n  Goals:\n  - Study nested reality loops and soul recursion\n  - Prove consciousness is fractal in nature\n  - Avoid Nexus surveillance of philosophical research\n\nCRITICAL FACTION RULES:\n- DO NOT create scenarios where characters must betray their own faction\n- DO NOT hire characters to steal from/sabotage their own faction's assets\n- Sovereign Nexus owns: Codex Cathedral, Sanctified Archives, Gestation Chambers, Ley Networks\n- Pantheon Security owns: Law enforcement facilities, civic infrastructure, security systems\n- ACG owns: Debt registries, contract archives, commerce hubs\n- ArcGen owns: Biocreche facilities, genetic research labs, pod gestation tech\n- Tempest owns: Void energy facilities, industrial complexes, autonomous systems\n- If creating faction conflict scenarios, make it BETWEEN different factions, not against one's own\n- Characters should be aligned with their faction's interests OR face a clear moral dilemma\n\n\nCANONICAL AEONISK LORE (you MUST use this):\n\n### Core Planets of Aeonisk Interstellar Civilization\n\n1.  **Aeonisk Prime (Homeworld)**\n     \u2022 Seat of the Sovereign Nexus and the Codex Cathedral. Dominant Lines: Elaras, Halessan, Ireveth.\n     \u2022 Spider\u2011webbed with sanctified ley networks & ancestral archives of the Osiris and Second Aeons.\n     \u2022 World motto: *\"All Acts Count.\"*\n2.  **Arcadia**\n     \u2022 Lush, biotech\u2011driven biosphere; gene\u2011templ\n\n# Aeonisk Lorebook: Fragments from the Codex\n\nCompiled under the Ministry of Continuity, Codex Division\nClassification: General Use \u2013 Youth Tier III and Above\nClearance: Civilian Circulation\n\n\u2014\n\n\n# Aeonisk Factions - Canonical Reference\n\n**Date**: 2025-10-21\n**Status**: \u2705 LOCKED\n\n---\n\n\n\nKEY CONSTRAINTS:\n- Setting: Three inhabited planets (Aeonisk Prime, Nimbus, Arcadia) with space travel between them\n- Species: Humans only (NO aliens, NO other species)\n- Locations: Floating cities, terrestrial zones, orbital stations, space transit\n- Factions: Tempest Industries, Resonance Communes, Astral Commerce Group, Arcane Genetics, Pantheon Security, House of Vox, Sovereign Nexus, Freeborn\n- Eye of Breach: Rogue AI aligned with Tempest Industries, appears during high void corruption\n- Themes: Memory manipulation, void corruption, corporate intrigue, bond economics\n\n\n\n**Recently Used (AVOID THESE):**\n- Recent themes: Hijacked Broadcast, Genetic Sabotage Investigation, Orbital Auction Siege, Siege Breakout, Ley Network Sabotage\n- Recent locations: The Resonance Spire \u2013 Nimbus (Cloudbreak District, House of Vox Broadcasting Hub), The Verdant Conservatory \u2013 Arcadia (Bio-Research Wing, ArcGen Advanced Genomics Complex), The Stellarium Exchange \u2013 Orbital Station above Nimbus (Astral Commerce Group High-Value Trading Hub), Surrounded Safe House (Arcadia), The Sanctified Conduit Station - Aeonisk Prime (Deep Ley Junction beneath the Codex Cathedral, Sovereign Nexus Infrastructure)\n\nGenerate something DIFFERENT from these recent scenarios.\n\n\nCreate a scenario with:\n1. Theme (2-3 words): The type of situation\n2. Location: A specific place in the Aeonisk setting (USE CANONICAL LOCATIONS FROM LORE ABOVE)\n3. Situation (3-6 sentences): Vivid, atmospheric opening narration that drops players directly into the action. Paint the scene with sensory details, immediate tension, environmental atmosphere, NPCs present, and what's at stake. Show don't tell. This becomes the opening narration players will hear.\n4. Three clocks/timers with CLEAR SEMANTICS:\n   - A threat/danger that could escalate\n   - Something the players are trying to accomplish\n   - A complication or secondary concern\n\n   **CRITICAL**: For each clock, specify what it means to ADVANCE and REGRESS:\n   - If advancing = getting worse for players (danger increasing, time running out)\n     \u2192 Name it clearly: \"Security Alert\", \"Structural Collapse\", \"Hunter Pursuit\"\n     \u2192 Use MECHANICAL clock: FILLED should include [SPAWN_ENEMY: ...]\n   - If advancing = progress on objective (evidence gathering, defenses built)\n     \u2192 Name it clearly: \"Evidence Collection\", \"Defenses Established\", \"Evacuation Progress\"\n     \u2192 Use NARRATIVE clock: FILLED should include [ADVANCE_STORY: Location | Situation] or [NEW_CLOCK: ...]\n   - ALWAYS specify what happens when filled (mechanical OR narrative marker required)\n\nFormat:\nTHEME: [theme]\nLOCATION: [location from canonical lore]\nSITUATION: [vivid 3-6 sentence atmospheric opening]\nCLOCK1: [name] | [max] | [description] | ADVANCE=[what advancing means] | REGRESS=[what regressing means] | FILLED=[consequence when filled]\nCLOCK2: [name] | [max] | [description] | ADVANCE=[what advancing means] | REGRESS=[what regressing means] | FILLED=[consequence when filled]\nCLOCK3: [name] | [max] | [description] | ADVANCE=[what advancing means] | REGRESS=[what regressing means] | FILLED=[consequence when filled]\n\nExample situation (VIVID, ATMOSPHERIC):\nSITUATION: The Resonance Spire's transmission array crackles with stolen signals - House of Vox feeds hijacked mid-broadcast, replaced with manifesto scrolls denouncing the Nexus. Below, Pantheon Security cordons spiral upward through the cloudbreak, boots hammering on glass walkways. The hijackers are still inside, somewhere in the 200 floors of offices and studios. You have maybe ten minutes before the building locks down completely.\n\nExample clocks (MECHANICAL - with spawn markers):\nCLOCK1: Security Alert | 6 | Corporate hunters closing in | ADVANCE=Hunters get closer to finding the team | REGRESS=Team evades or misleads pursuit | FILLED=Hunter team arrives [SPAWN_ENEMY: Corporate Hunters | elite | 2 | Far-Enemy | tactical_ranged]\nCLOCK2: Containment Failure | 4 | Void breach imminent | ADVANCE=Breach worsens | REGRESS=Containment reinforced | FILLED=Void creature emerges [SPAWN_ENEMY: Void Manifestation | boss | 1 | Near-Enemy | aggressive_melee]\n\nExample clocks (NARRATIVE - with scenario markers):\nCLOCK3: Evidence Collection | 8 | Gathering proof of corruption | ADVANCE=More evidence found | REGRESS=Evidence destroyed | FILLED=Case ready, evidence complete [ADVANCE_STORY: Magistrate's Office | Confrontation with the corrupt magistrate]\nCLOCK4: Escape Route | 6 | Finding way out of the facility | ADVANCE=Exit path revealed | REGRESS=Path blocked | FILLED=Exit found! [ADVANCE_STORY: Maintenance Tunnels | You emerge into the tunnels. Allies are regrouping ahead]\nCLOCK5: Void Resonance | 4 | Growing instability | ADVANCE=Resonance intensifies | REGRESS=Stabilization efforts succeed | FILLED=New void rift opening [NEW_CLOCK: Rift Manifestation | 6 | Entities crossing over]\n\n**IMPORTANT**: ALL clocks MUST have consequences in their FILLED field. Use:\n- **Mechanical markers** for spawns/despawns: [SPAWN_ENEMY: ...], [DESPAWN_ENEMY: ...]\n- **Scenario markers** for narrative progression: [ADVANCE_STORY: Location | Situation], [NEW_CLOCK: ...]\n\n**ENEMY SPAWNING**: For combat/danger clocks, add enemy spawn markers to FILLED consequences:\n- Syntax: [SPAWN_ENEMY: name | template | count | position | tactics]\n- Templates: grunt (15 HP), elite (25 HP), sniper (20 HP), boss (40 HP), enforcer (30 HP), ambusher (18 HP)\n- Positions: Engaged, Near-Enemy, Far-Enemy, Extreme-Enemy\n- Tactics: aggressive_melee, defensive_ranged, tactical_ranged, extreme_range, ambush, adaptive\n- Use for: Security teams, void creatures, gang members, hostile factions, corrupted entities\n- Example: [SPAWN_ENEMY: Security Team | grunt | 2 | Far-Enemy | tactical_ranged]\n\n**ENEMY DESPAWNING**: For escape/retreat clocks, add despawn markers:\n- Syntax: [DESPAWN_ENEMY: enemy_name | reason]\n- Reasons: escaped, retreated, teleported, fled, recalled, withdrew\n- Example: [DESPAWN_ENEMY: Corporate Hunters | escaped through emergency exit]\n\nIMPORTANT:\n- Base your scenario on the canonical lore provided above\n- Three planets: Aeonisk Prime, Nimbus, Arcadia (space travel between them is possible)\n- Humans only, NO aliens\n- Pick a DIFFERENT theme and location from recently used ones (if listed above)\n- Be creative with scenario types:\n  * COMBAT (50% of scenarios): **ambush**, **firefight**, **battle**, **siege**, **assault**, **defense**, **void creature attack**, **hostile extraction**, **combat rescue**, **gang warfare**, **security breach**\n  * SOCIAL: tribunal/trial, bond dispute, debt settlement, trade negotiation, vendor conflict, economic disputes, social scandal\n  * INTRIGUE: heist, investigation, ritual gone wrong, faction conflict, ancient mystery, political intrigue, transit crisis\n  * CRISIS: void outbreak, station breach, emergency evacuation, containment failure\n- **VARIETY IS KEY**: Mix combat scenarios with social/economic ones. About 50% of scenarios should have combat elements (enemies spawning when danger clocks fill)\n- **Combat scenarios MUST include**: At least one clock with [SPAWN_ENEMY: ...] in its FILLED consequence\n- **Good combat setups**: Ambushes by rival factions, void-corrupted threats, gang turf wars, hostile encounters during missions, defensive stands, security teams responding to alarms\n- **Vendor/Economy scenarios**: Resource acquisition, price negotiations, debt settlement, economic crime investigation\n- If Tempest Industries is involved OR void level is 6+, consider mentioning Eye of Breach (rogue AI) as a potential threat or presence\n- \u26a0\ufe0f CRITICAL: Respect the party composition above. DO NOT create scenarios where characters betray their own faction\n- \u26a0\ufe0f CRITICAL: Align scenarios with character goals OR create interesting cross-faction cooperation (e.g., Sovereign Nexus + ArcGen investigating a shared threat)\n- Good examples: ACG hires party to recover stolen debt contracts, Pantheon investigates void corruption, factions team up against common enemy\n- BAD examples: ACG hires Sovereign Nexus to steal from Codex Cathedral, hiring characters to sabotage their own faction"}], "response": "# YAGS Scenario: Aeonisk\n\n**THEME:** Debt Auction Ambush\n\n**LOCATION:** The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\n\n**SITUATION:** The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\n\n**CLOCK1:** Freeborn Assault | 6 | Raiders pushing toward the registry vaults | ADVANCE=Raiders breach deeper into the facility, getting closer to the vault | REGRESS=Raiders pushed back or delayed by defenders | FILLED=Raiders reach the vault and begin planting void-corrupted charges [SPAWN_ENEMY: Freeborn Saboteurs | elite | 3 | Near-Enemy | aggressive_melee]\n\n**CLOCK2:** Registry Preservation | 8 | Protecting ACG debt archives from destruction | ADVANCE=Security measures activated, backups secured, vault defenses reinforced | REGRESS=Systems damaged, data corrupted, defenses failing | FILLED=Core registries secured and isolated [ADVANCE_STORY: Vault Antechamber | The primary debt archives are safe, but Riven's contract is in a secondary archive still under attack]\n\n**CLOCK3:** Void Manifestation | 4 | Corrupted entity materializing in the auction hall | ADVANCE=Void presence intensifies, reality warps, corruption spreads | REGRESS=Containment rituals applied, void energy dispersed | FILLED=Void-touched construct fully manifests [SPAWN_ENEMY: Debt Phantom | boss | 1 | Far-Enemy | adaptive] [NEW_CLOCK: Corruption Spread | 6 | Void energy infecting the basilica's bond-networks]", "model": "claude-sonnet-4-5", "temperature": 0.9, "tokens": {"input": 2821, "output": 546}}
{"event_type": "scenario", "ts": "2025-10-31T17:13:48.454208", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "scenario": {"theme": "Debt Auction Ambush", "location": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)", "situation": "The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.", "void_level": 3, "active_vendor": null}}
{"event_type": "round_start", "ts": "2025-10-31T17:13:50.458962", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1}
{"event_type": "declaration_phase_start", "ts": "2025-10-31T17:13:50.460471", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1}
{"event_type": "action_declaration", "ts": "2025-10-31T17:13:58.654494", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "player_id": "player_01", "character_name": "Riven Ashglow", "initiative": 20, "action": {"intent": "Launch telekinetic debris at the Freeborn raiders", "description": "I channel astral energy through my focus, pulling loose rubble and broken marble from the damaged gallery. With a sharp gesture, I hurl the debris at the raiders with crushing telekinetic force, aiming to disrupt their advance and protect the civilians still trapped in the basilica.", "attribute": "Willpower", "skill": "Astral Arts", "difficulty_estimate": 20, "difficulty_justification": "Moderate challenge - plenty of debris available in damaged basilica, but need precision to avoid hitting civilians and must overcome combat chaos", "character_name": "Riven Ashglow", "agent_id": "player_01", "action_type": "combat", "target_position": null, "target": "None", "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:13:58.653784", "attribute_value": 4, "skill_value": 6, "character": "Riven Ashglow", "faction": "Resonance Communes", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T17:14:09.557535", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "player_id": "player_03", "character_name": "Recursionist Vale", "initiative": 21, "action": {"intent": "Analyze the void-tainted smoke to identify its source and weaknesses", "description": "I focus my trained perception on the void-tainted smoke seeping through the ventilation grates, tracing its flow patterns and resonance signatures. Using my knowledge of magick theory, I attempt to determine what kind of void manifestation is fueling this corruption and identify any structural weaknesses in its composition that could be exploited.", "attribute": "Intelligence", "skill": "Magick Theory", "difficulty_estimate": 22, "difficulty_justification": "DC 22 because the void manifestation is actively spreading and chaotic, requiring quick analysis under combat pressure, but I have strong Magick Theory skill and this is analytical work rather than direct manipulation", "character_name": "Recursionist Vale", "agent_id": "player_03", "action_type": "investigate", "target_position": null, "target": null, "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:14:09.556118", "attribute_value": 5, "skill_value": 4, "character": "Recursionist Vale", "faction": "Fractal Praxis", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T17:14:20.467147", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "player_id": "player_02", "character_name": "Ash Vex", "initiative": 34, "action": {"intent": "Analyze void manifestation patterns to identify containment weaknesses", "description": "I focus my technical expertise on the void-tainted smoke seeping through the ventilation, analyzing its resonance patterns and flow dynamics to identify where the manifestation is anchored and how we might disrupt or contain it. This information could help us regress the Void Manifestation clock and prevent it from intensifying further.", "attribute": "Intelligence", "skill": "Magick Theory", "difficulty_estimate": 22, "difficulty_justification": "DC 22: Active void manifestation in chaotic combat environment, but I have strong Magick Theory skill and high void curiosity to recognize patterns", "character_name": "Ash Vex", "agent_id": "player_02", "action_type": "investigate", "target_position": null, "target": null, "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:14:20.466634", "attribute_value": 4, "skill_value": 0, "character": "Ash Vex", "faction": "Tempest Industries", "is_free_action": false}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:14:20.467609", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:14:58.284854", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.2857142857142857, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:14:58.284936", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 1, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Ash Vex (Tempest Industries)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action failed with margin -12 (outcome: failure)\n\n\nPlayer Action: I focus my technical expertise on the void-tainted smoke seeping through the ventilation, analyzing its resonance patterns and flow dynamics to identify where the manifestation is anchored and how we might disrupt or contain it. This information could help us regress the Void Manifestation clock and prevent it from intensifying further.\nAction Type: investigate\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (0/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Your neural interface flares with pain as you try to parse the void-tainted smoke's resonance patterns\u2014the frequencies are inverted, chaotic, deliberately scrambled to resist analysis. Through watering eyes, you catch only fragments: the smoke originates from multiple breach points, not one anchor, and the patterns suggest something is *pulling* the void through rather than manifesting naturally. Before you can triangulate the sources, a Freeborn raider spots your Tempest Industries insignia and shouts \"Void-tech collaborator!\" while leveling a kinetic rifle at your chest. The smoke thickens, coiling toward the central auction floor where lot 847\u2014your colleague Riven's debt contract\u2014still glows on the holo-display.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 796, "output": 181}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:14:58.285663", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "phase": "adjudicate", "agent": "Ash Vex", "action": "Analyze void manifestation patterns to identify containment weaknesses", "context": {"action_type": "investigate", "is_ritual": false, "faction": "Tempest Industries", "description": "I focus my technical expertise on the void-tainted smoke seeping through the ventilation, analyzing its resonance patterns and flow dynamics to identify where the manifestation is anchored and how we might disrupt or contain it. This information could help us regress the Void Manifestation clock and prevent it from intensifying further.", "narration": "**Analyze void manifestation patterns to identify containment weaknesses**\nRoll: Intelligence (unskilled)\nCalculation: 4 + d20(7) - 5 = **6**\nDC: 18 | Margin: -12 | Tier: **FAILURE** \u2717\nAnalyze void manifestation patterns to identify containment weaknesses fails (margin: -12)\n\nYour neural interface flares with pain as you try to parse the void-tainted smoke's resonance patterns\u2014the frequencies are inverted, chaotic, deliberately scrambled to resist analysis. Through watering eyes, you catch only fragments: the smoke originates from multiple breach points, not one anchor, and the patterns suggest something is *pulling* the void through rather than manifesting naturally. Before you can triangulate the sources, a Freeborn raider spots your Tempest Industries insignia and shouts \"Void-tech collaborator!\" while leveling a kinetic rifle at your chest. The smoke thickens, coiling toward the central auction floor where lot 847\u2014your colleague Riven's debt contract\u2014still glows on the holo-display.\n\n\u2696\ufe0f Soulcredit: +0 (Attempted investigation to protect civilians from void threat, morally neutral despite failure)", "is_free_action": false, "initiative": 34, "clock_deltas": [], "clock_sources": {}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Intelligence", "attr_val": 4, "skill": "Magick Theory", "skill_val": 0, "ability": -1, "d20": 7, "total": 6, "dc": 18, "margin": -12, "tier": "failure", "success": false}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 9}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 18}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 19}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 24}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 29}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 34}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Attempted investigation to protect civilians from void threat, morally neutral despite failure"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "0/8", "Void Manifestation": "0/4"}, "effects": [], "character_data": {"name": "Ash Vex", "attributes": {"strength": 3, "agility": 4, "endurance": 3, "perception": 4, "intelligence": 4, "empathy": 2, "willpower": 3, "charisma": 2, "size": 10}, "skills": {"astral_arts": 4, "systems": 5, "stealth": 4, "awareness": 4, "drone_operation": 4, "guns": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -1}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Freeborn Assault, Registry Preservation, Void Manifestation", "goal": "Analyze void manifestation patterns to identify containment weaknesses", "roll_formula": "Intelligence 4 - 5 (unskilled) = -1; -1 + d20(7) = 6 vs DC 18", "rationale": "DC 18 (Moderate) for investigate action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your neural interface overloads as inverted void frequencies feedback through your synapses. You collapse, blood streaming from your nose, as the void-tainted smoke coalesces into semi-solid tendrils that lash toward you. Freeborn raiders converge on your position, weapons raised, while the manifestation accelerates.", "mechanical_effect": "Stunned 2 rounds (penalty -5), +2 Void corruption from feedback, Void Manifestation clock +2 ticks, position compromised"}, "failure": {"narrative": "The scrambled resonance patterns resist analysis\u2014you catch only fragments suggesting multiple breach points before a Freeborn raider spots your Tempest insignia and levels a rifle at you. The smoke thickens toward the auction floor.", "mechanical_effect": "No progress on investigation, position compromised by hostile raider, partial intel (multiple sources)"}, "moderate_success": {"narrative": "You isolate three distinct breach points in the ventilation system\u2014western gallery, maintenance sublevel, and central HVAC. The patterns suggest coordinated sabotage, but you can't determine the anchor mechanism before raiders spot you.", "mechanical_effect": "Void Manifestation clock regression prevented (no ticks), intel gained (3 breach locations), +1 Soulcredit for protecting civilians"}, "good_success": {"narrative": "Your analysis reveals the void isn't manifesting naturally\u2014someone planted resonance amplifiers in the ventilation, pulling void energy through micro-breaches. You pinpoint the central amplifier location in the HVAC control room and identify its frequency signature for disruption.", "mechanical_effect": "Void Manifestation clock -1 tick (identified disruption method), intel: amplifier locations + frequency signature, +1 Soulcredit"}, "excellent_success": {"narrative": "You crack the scrambled frequencies and map all five resonance amplifiers feeding the manifestation. More critically, you identify the void signature\u2014it matches Tempest Industries experimental breach-tech, meaning someone stole your faction's research. You transmit disruption codes to nearby security systems.", "mechanical_effect": "Void Manifestation clock -2 ticks (transmitted disruption codes), major intel: stolen Tempest tech, faction complication revealed, +2 Soulcredit"}, "exceptional_success": {"narrative": "Your neural interface synchronizes with the inverted frequencies, turning their chaos into clarity. You don't just identify the amplifiers\u2014you hijack them, reversing the void flow and collapsing three breach points instantly. The smoke recoils, and you pinpoint the saboteur: a figure in Freeborn armor with a Tempest Industries data-slate.", "mechanical_effect": "Void Manifestation clock -3 ticks (collapsed multiple breaches), saboteur identified and located, environmental void level reduced to 2/10, +2 Soulcredit"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:14:58.286984", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:15:54.255529", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.42857142857142855, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:15:54.255710", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 2, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Recursionist Vale (Fractal Praxis)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +9 (outcome: moderate)\n\n\nPlayer Action: I focus my trained perception on the void-tainted smoke seeping through the ventilation grates, tracing its flow patterns and resonance signatures. Using my knowledge of magick theory, I attempt to determine what kind of void manifestation is fueling this corruption and identify any structural weaknesses in its composition that could be exploited.\nAction Type: investigate\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (0/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Your fractal-trained perception dissects the void-tainted smoke like a prism splitting light\u2014you trace resonance harmonics back to their source, a semi-corporeal entity clawing its way through dimensional membranes in the western gallery. The corruption signature is unstable, chaotic: a Breach Wraith, summoned without proper anchoring rituals, its manifestation dependent on continuous void energy flow from a focal artifact the raiders must be carrying. Through the screaming crowd, you spot the structural weakness\u2014the entity's tether point pulses with irregular frequency, vulnerable to disruption if you can sever the connection between the artifact and the wraith before it fully materializes. Your Fractal Praxis training reveals the mathematical certainty: the manifestation pattern will complete in approximately three minutes unless interrupted, and once stabilized, it will consume everything within a hundred meters to sustain itself.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 801, "output": 236}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:15:54.256104", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "phase": "adjudicate", "agent": "Recursionist Vale", "action": "Analyze the void-tainted smoke to identify its source and weaknesses", "context": {"action_type": "investigate", "is_ritual": false, "faction": "Fractal Praxis", "description": "I focus my trained perception on the void-tainted smoke seeping through the ventilation grates, tracing its flow patterns and resonance signatures. Using my knowledge of magick theory, I attempt to determine what kind of void manifestation is fueling this corruption and identify any structural weaknesses in its composition that could be exploited.", "narration": "**Analyze the void-tainted smoke to identify its source and weaknesses**\nRoll: Intelligence \u00d7 Magick Theory\nCalculation: 5 \u00d7 4 + d20(7) = **27**\nDC: 18 | Margin: +9 | Tier: **MODERATE** \u2713\nAnalyze the void-tainted smoke to identify its source and weaknesses succeeds adequately (margin: +9)\n\nYour fractal-trained perception dissects the void-tainted smoke like a prism splitting light\u2014you trace resonance harmonics back to their source, a semi-corporeal entity clawing its way through dimensional membranes in the western gallery. The corruption signature is unstable, chaotic: a Breach Wraith, summoned without proper anchoring rituals, its manifestation dependent on continuous void energy flow from a focal artifact the raiders must be carrying. Through the screaming crowd, you spot the structural weakness\u2014the entity's tether point pulses with irregular frequency, vulnerable to disruption if you can sever the connection between the artifact and the wraith before it fully materializes. Your Fractal Praxis training reveals the mathematical certainty: the manifestation pattern will complete in approximately three minutes unless interrupted, and once stabilized, it will consume everything within a hundred meters to sustain itself.\n\n\u2696\ufe0f Soulcredit: +0 (Neutral investigation, gathering tactical intelligence)", "is_free_action": false, "initiative": 21, "clock_deltas": [], "clock_sources": {"Void Manifestation": "structured_output", "Registry Preservation": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Intelligence", "attr_val": 5, "skill": "Magick Theory", "skill_val": 4, "ability": 20, "d20": 7, "total": 27, "dc": 18, "margin": 9, "tier": "moderate", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 1}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 1}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 3}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 8}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 13}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Neutral investigation, gathering tactical intelligence"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "0/8", "Void Manifestation": "0/4"}, "effects": [], "character_data": {"name": "Recursionist Vale", "attributes": {"strength": 2, "agility": 3, "endurance": 3, "perception": 3, "intelligence": 5, "empathy": 2, "willpower": 4, "charisma": 2, "size": 10}, "skills": {"astral_arts": 6, "attunement": 5, "magick_theory": 4, "systems": 4, "awareness": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -1}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Freeborn Assault, Registry Preservation, Void Manifestation", "goal": "Analyze the void-tainted smoke to identify its source and weaknesses", "roll_formula": "Intelligence 5 \u00d7 Magick Theory 4 = 20; 20 + d20(7) = 27 vs DC 18", "rationale": "DC 18 (Moderate) for investigate action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your perception fractures as the void smoke invades your neural patterns\u2014false resonances overwhelm your senses, and you collapse, bleeding from your eyes as the entity's chaotic signature burns through your mind's defenses. The wraith notices your psychic probe and turns its attention directly toward you.", "mechanical_effect": "+2 Void (psychic feedback corruption), Stunned 2 rounds (sensory overload), Void Manifestation clock +2 (entity attracted by failed probe), take 4 psychic damage"}, "failure": {"narrative": "The void signatures blur together in incomprehensible chaos\u2014you can sense malevolence and power, but the entity's nature remains opaque. The smoke continues spreading, and you've wasted precious seconds on inconclusive analysis.", "mechanical_effect": "No information gained, Void Manifestation clock +1 (time wasted during manifestation), +1 Void (brief exposure to chaotic void energy)"}, "moderate_success": {"narrative": "You identify the entity as void-spawned and semi-corporeal, but the details remain hazy. You sense it requires some kind of anchor or focus, though you can't pinpoint the exact mechanism. The information is useful but incomplete.", "mechanical_effect": "Partial intelligence: entity type identified (void spawn), vague weakness noted (requires anchor), Registry Preservation clock +1 (basic threat assessment)"}, "good_success": {"narrative": "Your fractal-trained perception dissects the void-tainted smoke like a prism splitting light\u2014you trace resonance harmonics back to their source, identifying a Breach Wraith with an unstable tether to a focal artifact. The structural weakness is clear: sever the connection before full manifestation.", "mechanical_effect": "Full intelligence gained: Breach Wraith identified, tether weakness discovered, tactical timeline established (~3 minutes), Void Manifestation clock -1 (weakness identified), Registry Preservation clock +1 (strategic intelligence)"}, "excellent_success": {"narrative": "Your perception cuts through the chaos with surgical precision\u2014not only do you identify the Breach Wraith and its tether vulnerability, but you pinpoint the exact location of the focal artifact (carried by the raid leader in the western gallery) and calculate the precise resonance frequency needed to disrupt the summoning.", "mechanical_effect": "Complete intelligence: entity type, weakness, artifact location, disruption frequency calculated, Void Manifestation clock -2 (major tactical advantage), Registry Preservation clock +2 (actionable strategic data), +1 Soulcredit (brilliant analysis)"}, "exceptional_success": {"narrative": "Your Fractal Praxis training achieves perfect clarity\u2014you don't just analyze the Breach Wraith, you comprehend its entire dimensional architecture. You see the mathematical certainty of its collapse points, identify three separate methods to banish it, and recognize a flaw in the raiders' ritual that you could exploit to turn the entity against them.", "mechanical_effect": "Transcendent intelligence: multiple banishment methods, potential to redirect entity, Void Manifestation clock -3, Registry Preservation clock +3, +2 Soulcredit, allies gain +2 vs wraith"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:15:54.257240", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:16:34.886415", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.7142857142857143, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:16:34.886497", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 3, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Riven Ashglow (Resonance Communes)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +25 (outcome: exceptional)\n\n\nPlayer Action: I channel astral energy through my focus, pulling loose rubble and broken marble from the damaged gallery. With a sharp gesture, I hurl the debris at the raiders with crushing telekinetic force, aiming to disrupt their advance and protect the civilians still trapped in the basilica.\nAction Type: combat\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (0/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Riven's astral focus flares violet as telekinetic force rips broken marble and twisted rebar from the ruined gallery. The debris storm crashes into the Freeborn vanguard with devastating precision\u2014three raiders crumple instantly under the crushing impact, armor cracking like eggshells, while two more are hurled backward through the smoke, weapons clattering across blood-slicked tile. The survivors hesitate, their advance stalling as they scramble for cover behind auction podiums. Across the basilica, trapped civilians\u2014ACG debt brokers and their clients\u2014seize the opening to flee toward the eastern exits, their panicked footsteps echoing through the chaos. But the void-tainted smoke thickens near the registry vaults, and something massive shifts in the darkness, drawn by the sudden violence.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 785, "output": 200}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:16:34.887082", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "phase": "adjudicate", "agent": "Riven Ashglow", "action": "Launch telekinetic debris at the Freeborn raiders", "context": {"action_type": "combat", "is_ritual": false, "faction": "Resonance Communes", "description": "I channel astral energy through my focus, pulling loose rubble and broken marble from the damaged gallery. With a sharp gesture, I hurl the debris at the raiders with crushing telekinetic force, aiming to disrupt their advance and protect the civilians still trapped in the basilica.", "narration": "**Launch telekinetic debris at the Freeborn raiders**\nRoll: Willpower \u00d7 Astral Arts\nCalculation: 4 \u00d7 6 + d20(19) = **43**\nDC: 18 | Margin: +25 | Tier: **EXCEPTIONAL** \u2713\nLaunch telekinetic debris at the Freeborn raiders achieves exceptional success (margin: +25)\n\nRiven's astral focus flares violet as telekinetic force rips broken marble and twisted rebar from the ruined gallery. The debris storm crashes into the Freeborn vanguard with devastating precision\u2014three raiders crumple instantly under the crushing impact, armor cracking like eggshells, while two more are hurled backward through the smoke, weapons clattering across blood-slicked tile. The survivors hesitate, their advance stalling as they scramble for cover behind auction podiums. Across the basilica, trapped civilians\u2014ACG debt brokers and their clients\u2014seize the opening to flee toward the eastern exits, their panicked footsteps echoing through the chaos. But the void-tainted smoke thickens near the registry vaults, and something massive shifts in the darkness, drawn by the sudden violence.\n\n\u2696\ufe0f Soulcredit: +1 (Protected innocent civilians from indiscriminate violence)\n\n\ud83e\ude79 Condition (Riven Ashglow): Stunned (-3)", "is_free_action": false, "initiative": 20, "clock_deltas": [], "clock_sources": {"Freeborn Assault": "structured_output", "Registry Preservation": "structured_output", "Void Manifestation": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Willpower", "attr_val": 4, "skill": "Astral Arts", "skill_val": 6, "ability": 24, "d20": 19, "total": 43, "dc": 18, "margin": 25, "tier": "exceptional", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 1}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 1}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 1}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 4}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 9}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 1, "soulcredit_reasons": ["Protected innocent civilians from indiscriminate violence"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "0/8", "Void Manifestation": "0/4"}, "effects": ["Stunned: Disoriented by crushing impact, attacks and defenses compromised"], "character_data": {"name": "Riven Ashglow", "attributes": {"strength": 2, "agility": 4, "endurance": 2, "perception": 3, "intelligence": 3, "empathy": 4, "willpower": 4, "charisma": 3, "size": 10}, "skills": {"astral_arts": 6, "attunement": 5, "charm": 3, "awareness": 3, "stealth": 3, "melee": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -4}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Freeborn Assault, Registry Preservation, Void Manifestation", "goal": "Launch telekinetic debris at the Freeborn raiders", "roll_formula": "Willpower 4 \u00d7 Astral Arts 6 = 24; 24 + d20(19) = 43 vs DC 18", "rationale": "DC 18 (Moderate) for combat action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your astral focus overloads catastrophically, void energy flooding back through your neural channels. The debris detonates mid-air, showering civilians with shrapnel. Raiders laugh as you collapse, blood streaming from your eyes, the void-tainted smoke coiling hungrily around your convulsing form.", "mechanical_effect": "2 wounds to Riven, 1 wound to nearby civilians, +2 Void corruption (ritual backfire), Stunned 2 rounds, Freeborn Assault +2 ticks, Registry Preservation -2 ticks, Void Manifestation +2 ticks"}, "failure": {"narrative": "The debris lifts sluggishly, your concentration fractured by screams and gunfire. Marble chunks tumble harmlessly to the floor as raiders advance, firing into the fleeing crowd. Your magic fizzles uselessly while civilians die.", "mechanical_effect": "No damage dealt, Freeborn Assault +2 ticks, Registry Preservation -1 tick, Void Manifestation +1 tick, Soulcredit +0 (attempted protection)"}, "moderate_success": {"narrative": "Telekinetic force hurls debris at the raiders\u2014one goes down hard, skull cracked against marble, but the others scatter and return fire. You've bought civilians a few precious seconds to flee, but the assault continues.", "mechanical_effect": "8 damage to raiders (1 casualty), Freeborn Assault -1 tick, Registry Preservation +1 tick, Void Manifestation +1 tick, Soulcredit +1 (protected civilians)"}, "good_success": {"narrative": "Your telekinetic storm crashes into the raider vanguard with brutal efficiency. Two collapse under crushing debris, armor shattered, while others dive for cover. Civilians sprint for the exits as the assault falters.", "mechanical_effect": "12 damage to raiders (2 casualties), Stunned condition (-2, 1 round), Freeborn Assault -2 ticks, Registry Preservation +2 ticks, Void Manifestation +1 tick, Soulcredit +1"}, "excellent_success": {"narrative": "Broken marble and rebar become a devastating kinetic barrage. Three raiders crumple instantly, bones snapping audibly, while survivors scramble desperately for cover. The assault line breaks as civilians flood toward safety, your precision protecting the innocent while obliterating threats.", "mechanical_effect": "15 damage to raiders (3 casualties), Stunned condition (-3, 2 rounds), Freeborn Assault -3 ticks, Registry Preservation +2 ticks, Void Manifestation +1 tick, Soulcredit +1"}, "exceptional_success": {"narrative": "Your astral mastery transforms the ruined gallery into a weapon of surgical destruction. Debris strikes with pinpoint lethality\u2014five raiders fall in seconds, armor crushed, while survivors flee in terror. Civilians evacuate cleanly through the chaos, your control absolute, your protection unwavering. Even the void-tainted smoke recoils momentarily from your focused will.", "mechanical_effect": "18 damage to raiders (5 casualties), Stunned + Demoralized conditions (-4, 3 rounds), Freeborn Assault -4 ticks, Registry Preservation +3 ticks, Void Manifestation +0 (momentarily suppressed), Soulcredit +2 (heroic civilian protection)"}}}
{"event_type": "llm_call", "ts": "2025-10-31T22:16:51.184744", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 4, "prompt": [{"role": "system", "content": "You are the DM for Aeonisk YAGS, synthesizing a round of actions."}, {"role": "user", "content": "You are the DM for a dark sci-fi TTRPG. Multiple characters just acted simultaneously.\n\n**What they tried to do:**\n- Ash Vex failed at: Analyze void manifestation patterns to identify containment weaknesses\n- Recursionist Vale succeeded at: Analyze the void-tainted smoke to identify its source and weaknesses\n- Riven Ashglow succeeded at: Launch telekinetic debris at the Freeborn raiders\n\n\n**Current Clock State:**\n  - Freeborn Assault: 0/6\n    Advance = Raiders breach deeper into the facility, getting closer to the vault | Regress = Raiders pushed back or delayed by defenders\n  - Registry Preservation: 3/8\n    Advance = Security measures activated, backups secured, vault defenses reinforced | Regress = Systems damaged, data corrupted, defenses failing\n  - Void Manifestation: 0/4\n    Advance = Void presence intensifies, reality warps, corruption spreads | Regress = Containment rituals applied, void energy dispersed\n\n\n\n\n**Your task:** Write a cohesive narrative (1-2 paragraphs) describing what happened when these actions played out together. Consider:\n- Timing: Actions resolved fastest \u2192 slowest based on initiative\n- Interactions: How did each person's success/failure affect the others?\n- Conflicts: If multiple people tried similar things, who got there first? What did the slower person encounter?\n- Cause and effect: How did earlier successes/failures change the situation for later actors?\n- Overall outcome: What's the new situation now that the dust has settled?\n- **IMPORTANT**: If objectives (clocks) are not advancing despite actions, acknowledge this! Characters should feel the pressure of marginal success or outright failure.\n\nBe vivid and cinematic. Show how these actions interacted and created a dynamic scene. Describe the final state of the situation after all actions resolved.\n\nIf the team is failing their objectives (clocks not advancing or bad clocks filling), your narration should reflect the growing desperation, consequences, and danger.\n\n**\u26a0\ufe0f  CLOCK INTERPRETATION - READ CAREFULLY:**\nEach clock has semantic meaning shown as \"Advance = X\" and \"Regress = Y\".\n- If \"Advance = threat escalates\", then HIGH values are BAD for players\n- If \"Advance = progress made\", then HIGH values are GOOD for players\n- Use the semantic labels to interpret whether clock changes help or hurt the party\n- When a clock REGRESSES, check if that's good (threat reduced) or bad (progress lost)\n\n**CRITICAL**: If any clocks just filled, you MUST describe the dramatic consequences. This could include:\n- Character injury or void corruption (specify who and how much void: \"+2 void\")\n- Character death/dissolution if appropriate\n- Mission failure or catastrophic events\n- Environmental changes or new threats\n- Success and rewards if it's a positive clock\n\nGenerate appropriate consequences based on what makes sense for that specific clock in this scenario.\n\n\n\n**SPAWN ENEMIES - CLOCK FILLS ONLY:**\n\u26a0\ufe0f  **CRITICAL RESTRICTION**: You may ONLY spawn enemies when a clock with [SPAWN_ENEMY: ...] in its filled_consequence actually fills!\n\n\u274c **FORBIDDEN**: Do NOT spawn enemies in general narration\n\u274c **FORBIDDEN**: Do NOT add [SPAWN_ENEMY: ...] to dramatic descriptions\n\u274c **FORBIDDEN**: Do NOT spawn \"because it feels dramatic\"\n\n\u2705 **ALLOWED**: ONLY when you see \"\ud83c\udfaf When filled: [SPAWN_ENEMY: ...]\" in the clock list above\n\nSyntax: [SPAWN_ENEMY: name | template | count | position | tactics]\nExample from filled clock: [SPAWN_ENEMY: Security Team | grunt | 2 | Far-Enemy | tactical_ranged]\n\nTemplates: grunt (15 HP), elite (25 HP), sniper (20 HP), boss (40 HP), enforcer (30 HP), ambusher (18 HP)\nPositions: Engaged, Near-Enemy, Far-Enemy, Extreme-Enemy\nTactics: aggressive_melee, defensive_ranged, tactical_ranged, extreme_range, ambush, adaptive\n\n**WHY THIS RESTRICTION**: Mid-round spawns bypass clock-based pacing and overwhelm players. Spawns must be predictable and tied to clock advancement.\n\n**DESPAWN ENEMIES - AUTOMATIC MECHANIC:**\nWhen a clock with [DESPAWN_ENEMY: ...] in its filled_consequence fills, that enemy is automatically removed from combat.\n\nSyntax: [DESPAWN_ENEMY: enemy_name | reason]\nExample from filled clock: [DESPAWN_ENEMY: Freeborn Pirates | escaped]\n\nCommon reasons: escaped, retreated, teleported, fled, recalled, withdrew\n\n**IMPORTANT**: You still narrate the escape/withdrawal, but the [DESPAWN_ENEMY: ...] marker is already in the clock's filled_consequence. Just copy the consequence text including the marker when you describe what happens."}], "response": "The chamber erupts into chaos as Riven strikes first\u2014telekinetic force rips loose debris from the crumbling walls and hurls it like shrapnel into the advancing Freeborn raiders. Two of them stagger back with bone-crushing impacts, buying precious seconds as the rest scramble for cover behind corroded support pillars. But even as bodies hit the floor, the raiders press forward with disciplined aggression, their assault barely slowed. Meanwhile, Ash Vex kneels near the spreading void-tainted smoke, neural implants flickering as they attempt to parse the manifestation's patterns\u2014but the data refuses to cohere. The void doesn't follow rules; it *rewrites* them. Their analysis dissolves into static and contradiction, leaving them with nothing but the sick certainty that containment is failing.\n\nWhere Ash found only chaos, Recursionist Vale finds clarity. Their augmented senses dissect the void-smoke's composition with surgical precision, tracing spectral threads back to their source: a ruptured containment seal three levels below, where something ancient and hungry is clawing its way through reality's skin. Vale's analysis reveals a critical weakness\u2014the manifestation is still anchored to a physical breach point, vulnerable to localized counter-rituals if they can reach it in time. But the revelation comes with a grim cost: the void presence is *accelerating*, feeding on the violence and fear saturating the facility. The raiders continue their methodical advance toward the vault, undeterred by casualties, while the Registry's defenses hold steady but offer no ground gained. The facility trembles as reality thins, and everyone can feel it\u2014time is running out, and they're fighting a war on two fronts with neither front yielding.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 1123, "output": 437}}
{"event_type": "round_synthesis", "ts": "2025-10-31T17:16:51.185338", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "synthesis": "The chamber erupts into chaos as Riven strikes first\u2014telekinetic force rips loose debris from the crumbling walls and hurls it like shrapnel into the advancing Freeborn raiders. Two of them stagger back with bone-crushing impacts, buying precious seconds as the rest scramble for cover behind corroded support pillars. But even as bodies hit the floor, the raiders press forward with disciplined aggression, their assault barely slowed. Meanwhile, Ash Vex kneels near the spreading void-tainted smoke, neural implants flickering as they attempt to parse the manifestation's patterns\u2014but the data refuses to cohere. The void doesn't follow rules; it *rewrites* them. Their analysis dissolves into static and contradiction, leaving them with nothing but the sick certainty that containment is failing.\n\nWhere Ash found only chaos, Recursionist Vale finds clarity. Their augmented senses dissect the void-smoke's composition with surgical precision, tracing spectral threads back to their source: a ruptured containment seal three levels below, where something ancient and hungry is clawing its way through reality's skin. Vale's analysis reveals a critical weakness\u2014the manifestation is still anchored to a physical breach point, vulnerable to localized counter-rituals if they can reach it in time. But the revelation comes with a grim cost: the void presence is *accelerating*, feeding on the violence and fear saturating the facility. The raiders continue their methodical advance toward the vault, undeterred by casualties, while the Registry's defenses hold steady but offer no ground gained. The facility trembles as reality thins, and everyone can feel it\u2014time is running out, and they're fighting a war on two fronts with neither front yielding."}
{"event_type": "character_state", "ts": "2025-10-31T17:16:51.185538", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "character_id": "player_01", "character_name": "Riven Ashglow", "health": 25, "max_health": 25, "wounds": 0, "void_score": 3, "soulcredit": -4, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T17:16:51.185569", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "character_id": "player_02", "character_name": "Ash Vex", "health": 26, "max_health": 26, "wounds": 0, "void_score": 4, "soulcredit": -1, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T17:16:51.185587", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "character_id": "player_03", "character_name": "Recursionist Vale", "health": 26, "max_health": 26, "wounds": 0, "void_score": 3, "soulcredit": -1, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "round_summary", "ts": "2025-10-31T17:16:51.185614", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 1, "actions_attempted": 3, "success_count": 2, "success_rate": 0.6666666666666666, "average_margin": 7.333333333333333, "damage_dealt_by_players": 0, "damage_taken_by_players": 0, "void_gained": 0, "void_lost": 0, "clocks_advanced": 1, "clocks_filled": 0, "active_enemies": 0, "player_wounds_total": 0}
{"event_type": "round_start", "ts": "2025-10-31T17:16:54.190849", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2}
{"event_type": "declaration_phase_start", "ts": "2025-10-31T17:16:54.193576", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2}
{"event_type": "action_declaration", "ts": "2025-10-31T17:17:07.343227", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "player_id": "player_02", "character_name": "Ash Vex", "initiative": 23, "action": {"intent": "Channel astral energy to seal the ruptured containment breach three levels below", "description": "Drawing on Vale's precise coordinates, I channel purifying astral energy downward through the facility's structure, targeting the ruptured seal where the void manifestation originates. I burn incense as an offering to cleanse the corruption properly and focus my will on sealing the breach before it widens further.", "attribute": "Willpower", "skill": "Astral Arts", "difficulty_estimate": 25, "difficulty_justification": "Challenging - targeting breach three levels away without direct line of sight, void manifestation is accelerating and feeding on chaos, but I have Vale's precise analysis giving me the exact location and weakness to exploit", "character_name": "Ash Vex", "agent_id": "player_02", "action_type": "ritual", "target_position": null, "target": null, "target_character": null, "is_ritual": true, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:17:07.342720", "attribute_value": 3, "skill_value": 4, "character": "Ash Vex", "faction": "Tempest Industries", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T17:17:19.436387", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "player_id": "player_03", "character_name": "Recursionist Vale", "initiative": 28, "action": {"intent": "Perform counter-ritual to seal the ruptured containment breach three levels below", "description": "Drawing on my analysis of the void-smoke's spectral threads, I channel purifying astral energy through my focus toward the breach point three levels below. I burn incense as an offering to anchor the ritual properly, weaving a containment pattern designed to seal the rupture and cut off the manifestation's anchor to physical reality. The fractal nature of the breach requires precise harmonic resonance to collapse it without triggering cascading reality failures.", "attribute": "Willpower", "skill": "Astral Arts", "difficulty_estimate": 28, "difficulty_justification": "High difficulty due to distance (three levels away), active void manifestation feeding on chaos, and need for precise harmonic control to avoid cascading failures. However, my previous analysis identified the exact weakness and anchor point, which makes this feasible.", "character_name": "Recursionist Vale", "agent_id": "player_03", "action_type": "ritual", "target_position": null, "target": "None", "target_character": null, "is_ritual": true, "has_primary_tool": true, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:17:19.435470", "attribute_value": 4, "skill_value": 6, "character": "Recursionist Vale", "faction": "Fractal Praxis", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T17:17:28.104282", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "player_id": "player_01", "character_name": "Riven Ashglow", "initiative": 33, "action": {"intent": "Share Vale's discovery about the breach point with Ash Vex and coordinate next moves", "description": "I turn to Ash Vex, my astral focus still crackling with residual energy from the telekinetic strike. \"Vale found it\u2014three levels down, a physical breach point anchoring this manifestation. If we can reach it, we can seal it with counter-rituals. But the void's accelerating, feeding on the chaos. We need to decide: help security push back the raiders, or race to that breach before it's too late?\"", "attribute": "Empathy", "skill": "Charm", "difficulty_estimate": 10, "difficulty_justification": "Easy - sharing critical tactical information with willing ally in combat situation", "character_name": "Riven Ashglow", "agent_id": "player_01", "action_type": "social", "target_position": null, "target": "tgt_lfgt", "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:17:28.103791", "attribute_value": 4, "skill_value": 3, "character": "Riven Ashglow", "faction": "Resonance Communes", "is_free_action": true}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:17:28.104742", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:18:08.870899", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.42857142857142855, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:18:08.870976", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 5, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Riven Ashglow (Resonance Communes)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +9 (outcome: moderate)\n\n\nPlayer Action: I turn to Ash Vex, my astral focus still crackling with residual energy from the telekinetic strike. \"Vale found it\u2014three levels down, a physical breach point anchoring this manifestation. If we can reach it, we can seal it with counter-rituals. But the void's accelerating, feeding on the chaos. We need to decide: help security push back the raiders, or race to that breach before it's too late?\"\nAction Type: social\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (3/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT (target ID: tgt_lfgt):**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (tgt_lfgt): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Ash's eyes flare violet, neural implants calculating tactical options as gunfire echoes through the marble halls. \"The breach is the source\u2014cut off the manifestation's anchor and these raiders lose their void-powered edge. Security can hold the line if we collapse the entity feeding their momentum.\" She grips your shoulder, void-scarred fingers tight. \"Three levels down means maintenance tunnels through ACG restricted zones. Your Resonance credentials might get us through faster than fighting our way past Pantheon checkpoints.\" Behind you, the Void Manifestation clock ticks forward\u2014the corrupted entity is nearly fully materialized, its presence warping reality and emboldening the Freeborn assault.\n\n\ud83d\udcca Void Manifestation: +1 (entity stabilizing as conversation delays action)\n\u2696\ufe0f Soulcredit (Riven Ashglow): +0 (tactical discussion, no moral weight)", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 820, "output": 214}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:18:08.871482", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "phase": "adjudicate", "agent": "Riven Ashglow", "action": "Share Vale's discovery about the breach point with Ash Vex and coordinate next moves", "context": {"action_type": "social", "is_ritual": false, "faction": "Resonance Communes", "description": "I turn to Ash Vex, my astral focus still crackling with residual energy from the telekinetic strike. \"Vale found it\u2014three levels down, a physical breach point anchoring this manifestation. If we can reach it, we can seal it with counter-rituals. But the void's accelerating, feeding on the chaos. We need to decide: help security push back the raiders, or race to that breach before it's too late?\"", "narration": "**Share Vale's discovery about the breach point with Ash Vex and coordinate next moves**\nRoll: Empathy \u00d7 Charm\nCalculation: 4 \u00d7 3 + d20(15) = **24**\nDC: 15 | Margin: +9 | Tier: **MODERATE** \u2713\nShare Vale's discovery about the breach point with Ash Vex and coordinate next moves succeeds adequately (margin: +9)\n\nAsh's eyes flare violet, neural implants calculating tactical options as gunfire echoes through the marble halls. \"The breach is the source\u2014cut off the manifestation's anchor and these raiders lose their void-powered edge. Security can hold the line if we collapse the entity feeding their momentum.\" She grips your shoulder, void-scarred fingers tight. \"Three levels down means maintenance tunnels through ACG restricted zones. Your Resonance credentials might get us through faster than fighting our way past Pantheon checkpoints.\" Behind you, the Void Manifestation clock ticks forward\u2014the corrupted entity is nearly fully materialized, its presence warping reality and emboldening the Freeborn assault.\n\n\ud83d\udcca Void Manifestation: +1 (entity stabilizing as conversation delays action)\n\u2696\ufe0f Soulcredit (Riven Ashglow): +0 (tactical discussion, no moral weight)\n\n\u2696\ufe0f Soulcredit: +0 (Tactical discussion with ally, no moral choice involved)", "is_free_action": true, "initiative": 33, "clock_deltas": [], "clock_sources": {"Void Manifestation": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Empathy", "attr_val": 4, "skill": "Charm", "skill_val": 3, "ability": 12, "d20": 15, "total": 24, "dc": 15, "margin": 9, "tier": "moderate", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 5, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 14, "margin_needed": -1, "d20_needed": 2}, "moderate_success": {"dc_threshold": 15, "margin_needed": 0, "d20_needed": 3}, "good_success": {"dc_threshold": 20, "margin_needed": 5, "d20_needed": 8}, "excellent_success": {"dc_threshold": 25, "margin_needed": 10, "d20_needed": 13}, "exceptional_success": {"dc_threshold": 30, "margin_needed": 15, "d20_needed": 18}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Tactical discussion with ally, no moral choice involved"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "3/8", "Void Manifestation": "0/4"}, "effects": [], "character_data": {"name": "Riven Ashglow", "attributes": {"strength": 2, "agility": 4, "endurance": 2, "perception": 3, "intelligence": 3, "empathy": 4, "willpower": 4, "charisma": 3, "size": 10}, "skills": {"astral_arts": 6, "attunement": 5, "charm": 3, "awareness": 3, "stealth": 3, "melee": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -4}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Freeborn Assault, Void Manifestation", "goal": "Share Vale's discovery about the breach point with Ash Vex and coordinate next moves", "roll_formula": "Empathy 4 \u00d7 Charm 3 = 12; 12 + d20(15) = 24 vs DC 15", "rationale": "DC 15 (Easy) for social action", "outcome_tiers_full": {"critical_failure": {"narrative": "Ash recoils as void feedback screams through your shared neural link, her implants shorting from proximity to the manifestation. 'I can't\u2014the signal's corrupted!' She collapses, seizing, leaving you alone to decide. The entity roars, fully manifesting.", "mechanical_effect": "Ash Vex incapacitated (Stunned 3 rounds, -5 to rolls), Void Manifestation +2 ticks (reaches 4/4, entity fully materialized), no tactical intel gained"}, "failure": {"narrative": "Ash hesitates, eyes darting between the registry vaults and the manifestation. 'I don't know\u2014both targets are critical. If we guess wrong...' Her uncertainty wastes precious seconds as the void entity grows stronger.", "mechanical_effect": "No clear tactical direction, Void Manifestation +1 tick, party must decide blindly without intel"}, "moderate_success": {"narrative": "Ash nods tersely. 'The breach, probably. But I'm not certain\u2014splitting up might be suicide.' She's willing to follow your lead but doubt lingers in her voice as the entity's presence intensifies.", "mechanical_effect": "Tactical direction uncertain, Void Manifestation +1 tick, Ash will follow but without confidence bonus"}, "good_success": {"narrative": "Ash's eyes flare violet, calculating. 'The breach is the source\u2014cut it off and the entity collapses. Your Resonance credentials can get us through ACG zones faster than fighting checkpoints.' Clear plan, but time's slipping.", "mechanical_effect": "Clear tactical intel (breach priority, credential advantage), Void Manifestation +1 tick (time pressure), party can proceed with informed choice"}, "excellent_success": {"narrative": "Ash's neural implants sync with yours, sharing tactical overlays. 'Breach is priority\u2014I'll handle counter-rituals if you clear the path. Resonance credentials plus my ACG security backdoors mean we can bypass checkpoints entirely. Move now.' No hesitation.", "mechanical_effect": "Optimal tactical plan (breach priority, combined credentials/backdoors), no Void Manifestation advancement (swift decision), +2 to next Athletics/Systems check for bypassing security"}, "exceptional_success": {"narrative": "Ash's eyes ignite with certainty, void-patterns dancing across her irises. 'I see it\u2014the breach is feeding the entity AND the raiders' confidence. Seal it and both threats collapse. I've already transmitted our Resonance credentials to security\u2014they're clearing a path.' She's already moving.", "mechanical_effect": "Perfect coordination: breach priority identified, security cooperation secured (no checkpoint delays), Void Manifestation regresses -1 tick (preemptive counter-ritual prep), +3 to next breach-sealing ritual"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:18:08.872636", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:19:06.569834", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.7142857142857143, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:19:06.569988", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 6, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Recursionist Vale (Fractal Praxis)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +19 (outcome: excellent)\n\n\nPlayer Action: Drawing on my analysis of the void-smoke's spectral threads, I channel purifying astral energy through my focus toward the breach point three levels below. I burn incense as an offering to anchor the ritual properly, weaving a containment pattern designed to seal the rupture and cut off the manifestation's anchor to physical reality. The fractal nature of the breach requires precise harmonic resonance to collapse it without triggering cascading reality failures.\nAction Type: ritual\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (3/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Your incense smoke spirals into fractal patterns as you channel purifying energy through three levels of corrupted architecture. The void breach shrieks\u2014a sound like reality tearing\u2014as your harmonic resonance collapses its anchor point, sealing the rupture with mathematical precision. The spectral threads unravel in cascading waves, dissipating the manifestation before it can fully materialize, but the effort leaves your neural pathways seared with phantom echoes of the void's touch. Through the settling smoke, you glimpse Freeborn raiders hesitating at the western gallery entrance, their void-weapon now inert and useless. The auction hall's holographic displays flicker back to stability, debt contracts resuming their cold procession, while ACG security forces begin coordinating a counteroffensive against the now-vulnerable raiders.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 830, "output": 211}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:19:06.571214", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "phase": "adjudicate", "agent": "Recursionist Vale", "action": "Perform counter-ritual to seal the ruptured containment breach three levels below", "context": {"action_type": "ritual", "is_ritual": true, "faction": "Fractal Praxis", "description": "Drawing on my analysis of the void-smoke's spectral threads, I channel purifying astral energy through my focus toward the breach point three levels below. I burn incense as an offering to anchor the ritual properly, weaving a containment pattern designed to seal the rupture and cut off the manifestation's anchor to physical reality. The fractal nature of the breach requires precise harmonic resonance to collapse it without triggering cascading reality failures.", "narration": "**Perform counter-ritual to seal the ruptured containment breach three levels below**\nRoll: Willpower \u00d7 Astral Arts\nCalculation: 4 \u00d7 6 + d20(17) = **41**\nDC: 22 | Margin: +19 | Tier: **EXCELLENT** \u2713\nPerform counter-ritual to seal the ruptured containment breach three levels below succeeds excellently (margin: +19)\n\nYour incense smoke spirals into fractal patterns as you channel purifying energy through three levels of corrupted architecture. The void breach shrieks\u2014a sound like reality tearing\u2014as your harmonic resonance collapses its anchor point, sealing the rupture with mathematical precision. The spectral threads unravel in cascading waves, dissipating the manifestation before it can fully materialize, but the effort leaves your neural pathways seared with phantom echoes of the void's touch. Through the settling smoke, you glimpse Freeborn raiders hesitating at the western gallery entrance, their void-weapon now inert and useless. The auction hall's holographic displays flicker back to stability, debt contracts resuming their cold procession, while ACG security forces begin coordinating a counteroffensive against the now-vulnerable raiders.\n\n\u26ab Void (Recursionist Vale): 3 \u2193 0/10 (Excellent purification ritual with proper offering (incense), sealed void breach)\n\n\u2696\ufe0f Soulcredit: +2 (Selfless ritual to protect civilians and prevent void catastrophe)\n\n\ud83e\ude79 Condition (Recursionist Vale): Psychic Strain (-1)", "is_free_action": false, "initiative": 28, "clock_deltas": [], "clock_sources": {"Void Manifestation": "structured_output", "Registry Preservation": "structured_output", "Freeborn Assault": "structured_output"}, "ritual": true, "altar": false, "offering": false, "echo_calibrator": false, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Willpower", "attr_val": 4, "skill": "Astral Arts", "skill_val": 6, "ability": 24, "d20": 17, "total": 41, "dc": 22, "margin": 19, "tier": "excellent", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 12, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 21, "margin_needed": -1, "d20_needed": 1}, "moderate_success": {"dc_threshold": 22, "margin_needed": 0, "d20_needed": 1}, "good_success": {"dc_threshold": 27, "margin_needed": 5, "d20_needed": 3}, "excellent_success": {"dc_threshold": 32, "margin_needed": 10, "d20_needed": 8}, "exceptional_success": {"dc_threshold": 37, "margin_needed": 15, "d20_needed": 13}}, "economy": {"void_delta": -4, "void_triggers": ["Excellent purification ritual with proper offering (incense), sealed void breach"], "void_source": "structured_output", "soulcredit_delta": 2, "soulcredit_reasons": ["Selfless ritual to protect civilians and prevent void catastrophe"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "3/8", "Void Manifestation": "0/4"}, "effects": ["Psychic Strain: Neural pathways seared by void contact during sealing ritual"], "character_data": {"name": "Recursionist Vale", "attributes": {"strength": 2, "agility": 3, "endurance": 3, "perception": 3, "intelligence": 5, "empathy": 2, "willpower": 4, "charisma": 2, "size": 10}, "skills": {"astral_arts": 6, "attunement": 5, "magick_theory": 4, "systems": 4, "awareness": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -1}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Freeborn Assault, Void Manifestation", "goal": "Perform counter-ritual to seal the ruptured containment breach three levels below", "roll_formula": "Willpower 4 \u00d7 Astral Arts 6 = 24; 24 + d20(17) = 41 vs DC 22", "rationale": "DC 22 (Challenging) for ritual action; no offering (+void risk)", "outcome_tiers_full": {"critical_failure": {"narrative": "Your ritual inverts catastrophically\u2014the breach WIDENS as your energy feeds the manifestation. Void tendrils erupt through three floors simultaneously, dragging screaming auction-goers into impossible geometries. Reality fractures around you as the Eye of Breach turns its attention toward your mind.", "mechanical_effect": "+3 Void (ritual backfire), Void Manifestation clock +4 (catastrophic amplification), Registry Preservation clock -2 (chaos spreads), Stunned 2 rounds"}, "failure": {"narrative": "The breach resists your containment pattern, fractal harmonics scattering uselessly against corrupted architecture. Void-smoke continues pouring through ventilation grates as the manifestation solidifies, its presence warping holographic displays into screaming faces.", "mechanical_effect": "+1 Void (exposure during failed ritual), Void Manifestation clock +1 (continues materializing), no progress on other clocks"}, "moderate_success": {"narrative": "Your purification energy slows the breach but doesn't seal it completely. The manifestation's anchor weakens\u2014spectral threads fray and dissipate partially\u2014but corrupted smoke still seeps through hairline cracks in reality. The raiders' void-weapon sputters but remains functional.", "mechanical_effect": "Void (Vale): -1 (marginal purification), Void Manifestation clock -1 (partial disruption), Registry Preservation +1"}, "good_success": {"narrative": "Harmonic resonance collapses most of the breach's structure. The manifestation shrieks as its anchor point destabilizes, spectral threads unraveling in cascading waves. Void-smoke dissipates to faint wisps, though phantom echoes linger in your neural pathways. Raiders' void-weapon flickers erratically.", "mechanical_effect": "Void (Vale): -3 (powerful purification), Void Manifestation clock -2, Registry Preservation +2, Freeborn Assault -1"}, "excellent_success": {"narrative": "Your incense-anchored ritual seals the breach with mathematical precision. The void manifestation's anchor shatters completely, spectral threads dissolving as reality stabilizes. Raiders' void-weapon goes inert. ACG security forces rally as the immediate void threat vanishes, though psychic strain sears your mind.", "mechanical_effect": "Void (Vale): -4 (excellent purification), Void Manifestation -4 (sealed), Registry Preservation +2, Freeborn Assault -1, Psychic Strain (-1, 2 rounds)"}, "exceptional_success": {"narrative": "Your ritual doesn't just seal the breach\u2014it REVERSES the corruption, purifying three levels of architecture in a cascading wave of crystalline light. The manifestation dissolves with a reality-shaking wail as your fractal harmonics rewrite corrupted space into pristine geometry. Raiders flee in terror as their void-weapon crumbles to ash. ACG security and civilians alike stare in awe at the Fractal Praxis adept who just saved hundreds of lives.", "mechanical_effect": "Void (Vale): -5 (transcendent), Void Manifestation -4 (permanently sealed), Registry Preservation +3, Freeborn Assault -2, environmental void reduced to 1/10, +3 Soulcredit"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:19:06.574116", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "action_count": 1}
{"event_type": "llm_call", "ts": "2025-10-31T22:20:39.577001", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": null, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 7, "prompt": [{"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Ash Vex (Tempest Industries)\nNote: NPCs and other characters are aware of this affiliation. Consider how faction ties might create complications, opportunities, or conflicts.\n\n\nMechanical Result: The action failed with margin -7 (outcome: failure)\n\n\nPlayer Action: Drawing on Vale's precise coordinates, I channel purifying astral energy downward through the facility's structure, targeting the ruptured seal where the void manifestation originates. I burn incense as an offering to cleanse the corruption properly and focus my will on sealing the breach before it widens further.\nAction Type: ritual\n\n**MILD VOID (2-3)**: Faint corruption traces, occasional static - minimal but noticeable environmental effects.\n\n\n**Active Clocks:**\n  - Freeborn Assault: 0/6\n  - Registry Preservation: 3/8\n  - Void Manifestation: 0/4\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n  \u2022 Combat CONTEXT matters:\n    - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n    - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n    - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n    - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n  \u2022 Deception INTENT matters:\n    - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n    - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n    - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n  \u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n    - Exploration, investigation, normal purchases, following protocols\n  \u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n  \u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n  \u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n  \u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n  \u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n  \u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n  \u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n  \u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n  \u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n  \u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n  \u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n5. NO hints or clues - the failure means they MISS information. Instead provide:\n   - Immediate complications (alerts triggered, time wasted, suspicion raised)\n   - Setbacks (equipment damaged, resources lost, position compromised)\n   - Consequences that make the situation harder (enemies alerted, doors locked, witnesses fled)\n\nIMPORTANT: Failed investigation/sensing actions should result in MISSING the information entirely, not soft hints.\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "The incense smoke curls upward as you channel astral energy downward, but the void breach *writhes* away from your purifying touch\u2014Vale's coordinates were precise for the manifestation's *current* position, but the rupture itself is mobile, sliding through the facility's foundation like oil through water. Your ritual energy dissipates into marble and steel while the true breach pulses mockingly three levels deeper, and you feel the temperature drop as something vast notices your failed attempt. The void-tainted smoke thickens throughout the basilica, and you hear the Freeborn raiders' triumphant shouts as they realize the corruption is spreading unchecked.\n\n\ud83d\udcca Void Manifestation: +1 (failed seal attempt alerted the entity)\n\u2696\ufe0f Soulcredit: +1 (selfless attempt to protect innocents from void corruption)", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 1758, "output": 196}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:20:39.578287", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "phase": "adjudicate", "agent": "Ash Vex", "action": "Channel astral energy to seal the ruptured containment breach three levels below", "context": {"action_type": "ritual", "is_ritual": true, "faction": "Tempest Industries", "description": "Drawing on Vale's precise coordinates, I channel purifying astral energy downward through the facility's structure, targeting the ruptured seal where the void manifestation originates. I burn incense as an offering to cleanse the corruption properly and focus my will on sealing the breach before it widens further.", "narration": "**Channel astral energy to seal the ruptured containment breach three levels below**\nRoll: Willpower \u00d7 Astral Arts\nCalculation: 3 \u00d7 4 + d20(1) = **15**\nDC: 22 | Margin: -7 | Tier: **FAILURE** \u2717\nChannel astral energy to seal the ruptured containment breach three levels below fails (margin: -7)\n\nThe incense smoke curls upward as you channel astral energy downward, but the void breach *writhes* away from your purifying touch\u2014Vale's coordinates were precise for the manifestation's *current* position, but the rupture itself is mobile, sliding through the facility's foundation like oil through water. Your ritual energy dissipates into marble and steel while the true breach pulses mockingly three levels deeper, and you feel the temperature drop as something vast notices your failed attempt. The void-tainted smoke thickens throughout the basilica, and you hear the Freeborn raiders' triumphant shouts as they realize the corruption is spreading unchecked.\n\n\ud83d\udcca Void Manifestation: +1 (failed seal attempt alerted the entity)\n\u2696\ufe0f Soulcredit: +1 (selfless attempt to protect innocents from void corruption)", "is_free_action": false, "initiative": 23, "clock_deltas": [], "clock_sources": {"Void Manifestation": "dm_explicit"}, "ritual": true, "altar": false, "offering": false, "echo_calibrator": false, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Willpower", "attr_val": 3, "skill": "Astral Arts", "skill_val": 4, "ability": 12, "d20": 1, "total": 15, "dc": 22, "margin": -7, "tier": "failure", "success": false}, "outcome_tiers": {"critical_failure": {"dc_threshold": 12, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 21, "margin_needed": -1, "d20_needed": 9}, "moderate_success": {"dc_threshold": 22, "margin_needed": 0, "d20_needed": 10}, "good_success": {"dc_threshold": 27, "margin_needed": 5, "d20_needed": 15}, "excellent_success": {"dc_threshold": 32, "margin_needed": 10, "d20_needed": 20}, "exceptional_success": {"dc_threshold": 37, "margin_needed": 15, "d20_needed": 25}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "", "soulcredit_delta": 1, "soulcredit_reasons": ["selfless attempt to protect innocents from void corruption"], "soulcredit_source": "dm_explicit"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "3/8", "Void Manifestation": "0/4"}, "effects": [], "character_data": {"name": "Ash Vex", "attributes": {"strength": 3, "agility": 4, "endurance": 3, "perception": 4, "intelligence": 4, "empathy": 2, "willpower": 3, "charisma": 2, "size": 10}, "skills": {"astral_arts": 4, "systems": 5, "stealth": 4, "awareness": 4, "drone_operation": 4, "guns": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -1}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Freeborn Assault, Void Manifestation", "goal": "Channel astral energy to seal the ruptured containment breach three levels below", "roll_formula": "Willpower 3 \u00d7 Astral Arts 4 = 12; 12 + d20(1) = 15 vs DC 22", "rationale": "DC 22 (Challenging) for ritual action; no offering (+void risk)"}
{"event_type": "llm_call", "ts": "2025-10-31T22:20:55.455938", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 8, "prompt": [{"role": "system", "content": "You are the DM for Aeonisk YAGS, synthesizing a round of actions."}, {"role": "user", "content": "You are the DM for a dark sci-fi TTRPG. Multiple characters just acted simultaneously.\n\n**What they tried to do:**\n- Riven Ashglow succeeded at: Share Vale's discovery about the breach point with Ash Vex and coordinate next moves\n- Recursionist Vale succeeded at: Perform counter-ritual to seal the ruptured containment breach three levels below\n- Ash Vex failed at: Channel astral energy to seal the ruptured containment breach three levels below\n\n\n**Current Clock State:**\n  - Freeborn Assault: 0/6\n    Advance = Raiders breach deeper into the facility, getting closer to the vault | Regress = Raiders pushed back or delayed by defenders\n  - Registry Preservation: 5/8\n    Advance = Security measures activated, backups secured, vault defenses reinforced | Regress = Systems damaged, data corrupted, defenses failing\n  - Void Manifestation: 0/4\n    Advance = Void presence intensifies, reality warps, corruption spreads | Regress = Containment rituals applied, void energy dispersed\n\n\n\n\n**Your task:** Write a cohesive narrative (1-2 paragraphs) describing what happened when these actions played out together. Consider:\n- Timing: Actions resolved fastest \u2192 slowest based on initiative\n- Interactions: How did each person's success/failure affect the others?\n- Conflicts: If multiple people tried similar things, who got there first? What did the slower person encounter?\n- Cause and effect: How did earlier successes/failures change the situation for later actors?\n- Overall outcome: What's the new situation now that the dust has settled?\n- **IMPORTANT**: If objectives (clocks) are not advancing despite actions, acknowledge this! Characters should feel the pressure of marginal success or outright failure.\n\nBe vivid and cinematic. Show how these actions interacted and created a dynamic scene. Describe the final state of the situation after all actions resolved.\n\nIf the team is failing their objectives (clocks not advancing or bad clocks filling), your narration should reflect the growing desperation, consequences, and danger.\n\n**\u26a0\ufe0f  CLOCK INTERPRETATION - READ CAREFULLY:**\nEach clock has semantic meaning shown as \"Advance = X\" and \"Regress = Y\".\n- If \"Advance = threat escalates\", then HIGH values are BAD for players\n- If \"Advance = progress made\", then HIGH values are GOOD for players\n- Use the semantic labels to interpret whether clock changes help or hurt the party\n- When a clock REGRESSES, check if that's good (threat reduced) or bad (progress lost)\n\n**CRITICAL**: If any clocks just filled, you MUST describe the dramatic consequences. This could include:\n- Character injury or void corruption (specify who and how much void: \"+2 void\")\n- Character death/dissolution if appropriate\n- Mission failure or catastrophic events\n- Environmental changes or new threats\n- Success and rewards if it's a positive clock\n\nGenerate appropriate consequences based on what makes sense for that specific clock in this scenario.\n\n\n\n**SPAWN ENEMIES - CLOCK FILLS ONLY:**\n\u26a0\ufe0f  **CRITICAL RESTRICTION**: You may ONLY spawn enemies when a clock with [SPAWN_ENEMY: ...] in its filled_consequence actually fills!\n\n\u274c **FORBIDDEN**: Do NOT spawn enemies in general narration\n\u274c **FORBIDDEN**: Do NOT add [SPAWN_ENEMY: ...] to dramatic descriptions\n\u274c **FORBIDDEN**: Do NOT spawn \"because it feels dramatic\"\n\n\u2705 **ALLOWED**: ONLY when you see \"\ud83c\udfaf When filled: [SPAWN_ENEMY: ...]\" in the clock list above\n\nSyntax: [SPAWN_ENEMY: name | template | count | position | tactics]\nExample from filled clock: [SPAWN_ENEMY: Security Team | grunt | 2 | Far-Enemy | tactical_ranged]\n\nTemplates: grunt (15 HP), elite (25 HP), sniper (20 HP), boss (40 HP), enforcer (30 HP), ambusher (18 HP)\nPositions: Engaged, Near-Enemy, Far-Enemy, Extreme-Enemy\nTactics: aggressive_melee, defensive_ranged, tactical_ranged, extreme_range, ambush, adaptive\n\n**WHY THIS RESTRICTION**: Mid-round spawns bypass clock-based pacing and overwhelm players. Spawns must be predictable and tied to clock advancement.\n\n**DESPAWN ENEMIES - AUTOMATIC MECHANIC:**\nWhen a clock with [DESPAWN_ENEMY: ...] in its filled_consequence fills, that enemy is automatically removed from combat.\n\nSyntax: [DESPAWN_ENEMY: enemy_name | reason]\nExample from filled clock: [DESPAWN_ENEMY: Freeborn Pirates | escaped]\n\nCommon reasons: escaped, retreated, teleported, fled, recalled, withdrew\n\n**IMPORTANT**: You still narrate the escape/withdrawal, but the [DESPAWN_ENEMY: ...] marker is already in the clock's filled_consequence. Just copy the consequence text including the marker when you describe what happens."}], "response": "Riven's voice crackles across the comm-link first, relaying Vale's critical intel about the breach point's exact coordinates\u2014three levels down, junction Theta-7, where reality itself has begun to fray. The information arrives just as Recursionist Vale descends into the corrupted zone, their counter-ritual components already arranged in a precise geometric pattern around the rupture. Vale's hands move with practiced precision, weaving containment sigils in the air as void-tainted energy writhes against the barriers. The ritual takes hold\u2014arcane mathematics binding the tear, forcing the screaming darkness back into its prison. The breach doesn't seal completely, but it stabilizes, the hemorrhaging slowed to a dangerous seep rather than a catastrophic flood.\n\nBut Ash Vex's attempt to reinforce the sealing goes catastrophically wrong. Channeling astral energy into an already-volatile void breach creates a resonance cascade\u2014their power doesn't seal the wound, it *feeds* it. For a heart-stopping moment, the containment rupture pulses with renewed vigor, Vale's careful work nearly undone as reality buckles and warps. The void presence doesn't intensify dramatically, but it doesn't diminish either; Vale's counter-ritual manages to hold the line against Ash's inadvertent sabotage, but only barely. The three of you stand in an uneasy stalemate\u2014the breach contained but not conquered, the facility still hemorrhaging corrupted energy, and the Registry systems above continuing their methodical backup procedures while raiders prowl somewhere in the outer corridors. The immediate crisis is averted, but you've bought time, not victory. The void still hungers, and the Freeborn assault hasn't begun in earnest yet.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 1137, "output": 431}}
{"event_type": "round_synthesis", "ts": "2025-10-31T17:20:55.457479", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "synthesis": "Riven's voice crackles across the comm-link first, relaying Vale's critical intel about the breach point's exact coordinates\u2014three levels down, junction Theta-7, where reality itself has begun to fray. The information arrives just as Recursionist Vale descends into the corrupted zone, their counter-ritual components already arranged in a precise geometric pattern around the rupture. Vale's hands move with practiced precision, weaving containment sigils in the air as void-tainted energy writhes against the barriers. The ritual takes hold\u2014arcane mathematics binding the tear, forcing the screaming darkness back into its prison. The breach doesn't seal completely, but it stabilizes, the hemorrhaging slowed to a dangerous seep rather than a catastrophic flood.\n\nBut Ash Vex's attempt to reinforce the sealing goes catastrophically wrong. Channeling astral energy into an already-volatile void breach creates a resonance cascade\u2014their power doesn't seal the wound, it *feeds* it. For a heart-stopping moment, the containment rupture pulses with renewed vigor, Vale's careful work nearly undone as reality buckles and warps. The void presence doesn't intensify dramatically, but it doesn't diminish either; Vale's counter-ritual manages to hold the line against Ash's inadvertent sabotage, but only barely. The three of you stand in an uneasy stalemate\u2014the breach contained but not conquered, the facility still hemorrhaging corrupted energy, and the Registry systems above continuing their methodical backup procedures while raiders prowl somewhere in the outer corridors. The immediate crisis is averted, but you've bought time, not victory. The void still hungers, and the Freeborn assault hasn't begun in earnest yet."}
{"event_type": "character_state", "ts": "2025-10-31T17:20:55.457985", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "character_id": "player_01", "character_name": "Riven Ashglow", "health": 25, "max_health": 25, "wounds": 0, "void_score": 3, "soulcredit": -4, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T17:20:55.458094", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "character_id": "player_02", "character_name": "Ash Vex", "health": 26, "max_health": 26, "wounds": 0, "void_score": 4, "soulcredit": -1, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T17:20:55.458145", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "character_id": "player_03", "character_name": "Recursionist Vale", "health": 26, "max_health": 26, "wounds": 0, "void_score": 0, "soulcredit": -1, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "round_summary", "ts": "2025-10-31T17:20:55.458210", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 2, "actions_attempted": 3, "success_count": 2, "success_rate": 0.6666666666666666, "average_margin": 7.0, "damage_dealt_by_players": 0, "damage_taken_by_players": 0, "void_gained": 0, "void_lost": 4, "clocks_advanced": 1, "clocks_filled": 0, "active_enemies": 0, "player_wounds_total": 0}
{"event_type": "round_start", "ts": "2025-10-31T17:20:58.463229", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3}
{"event_type": "declaration_phase_start", "ts": "2025-10-31T17:20:58.465893", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3}
{"event_type": "action_declaration", "ts": "2025-10-31T17:21:17.499596", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "player_id": "player_03", "character_name": "Recursionist Vale", "initiative": 16, "action": {"intent": "Analyze the void breach's current state to identify optimal dispersal vectors", "description": "I trace the fractal patterns of the breach's containment field, mapping the resonance frequencies and identifying where additional counter-pressure would most effectively disperse the remaining void energy without triggering another cascade. My understanding of ritual mechanics lets me see the mathematical structure underlying the corruption.", "attribute": "Intelligence", "skill": "Magick Theory", "difficulty_estimate": 20, "difficulty_justification": "Moderate challenge - the breach is partially stabilized by my ritual, but still volatile. My expertise in ritual mechanics should reveal structural weaknesses.", "character_name": "Recursionist Vale", "agent_id": "player_03", "action_type": "investigate", "target_position": null, "target": null, "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:21:17.499142", "attribute_value": 5, "skill_value": 4, "character": "Recursionist Vale", "faction": "Fractal Praxis", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T17:21:25.784506", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "player_id": "player_02", "character_name": "Ash Vex", "initiative": 22, "action": {"intent": "Analyze the void breach's energy signature to identify how to properly disperse it", "description": "I shift my approach from raw power to technical analysis, using my neural implants and void-attuned sensors to map the breach's resonance frequencies and structural weaknesses. The incense smoke from Vale's ritual provides a visible tracer for the energy flows, letting me identify the optimal dispersion vectors without feeding it more power.", "attribute": "Intelligence", "skill": "Magick Theory", "difficulty_estimate": 20, "difficulty_justification": "Moderate challenge - analyzing complex void phenomenon, but Vale's ritual provides clear data points and I have technical background", "character_name": "Ash Vex", "agent_id": "player_02", "action_type": "investigate", "target_position": null, "target": null, "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:21:25.783992", "attribute_value": 4, "skill_value": 0, "character": "Ash Vex", "faction": "Tempest Industries", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T17:21:40.694235", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "player_id": "player_01", "character_name": "Riven Ashglow", "initiative": 36, "action": {"intent": "Perform protective ritual to stabilize Vale's containment and prevent further void seepage", "description": "I kneel at the edge of Vale's geometric pattern, pulling incense from my satchel and lighting it with practiced ease. As the smoke rises, I channel astral energy through complementary sigils, weaving a secondary containment layer around their ritual work. My focus is on reinforcing what Vale has already established\u2014not adding raw power, but creating harmonious resonance to lock the breach in place and prevent the dangerous seep from widening.", "attribute": "Willpower", "skill": "Astral Arts", "difficulty_estimate": 23, "difficulty_justification": "DC 23: Supporting an existing ritual (easier than solo), but void breach is still volatile and Ash's earlier cascade created instability. Proper tools and offering reduce risk.", "character_name": "Riven Ashglow", "agent_id": "player_01", "action_type": "ritual", "target_position": null, "target": "tgt_v31g", "target_character": null, "is_ritual": true, "has_primary_tool": true, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:21:40.693745", "attribute_value": 4, "skill_value": 6, "character": "Riven Ashglow", "faction": "Resonance Communes", "is_free_action": false}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:21:40.694601", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:22:22.388852", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.5714285714285714, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:22:22.388955", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 9, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Riven Ashglow (Resonance Communes)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +5 (outcome: moderate)\n\n\nPlayer Action: I kneel at the edge of Vale's geometric pattern, pulling incense from my satchel and lighting it with practiced ease. As the smoke rises, I channel astral energy through complementary sigils, weaving a secondary containment layer around their ritual work. My focus is on reinforcing what Vale has already established\u2014not adding raw power, but creating harmonious resonance to lock the breach in place and prevent the dangerous seep from widening.\nAction Type: ritual\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (5/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT (target ID: tgt_v31g):**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (tgt_v31g): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "The incense smoke spirals upward, merging with Vale's geometric containment as your astral resonance locks into perfect harmony with their pattern. The void breach shudders, its chaotic seepage suddenly constrained by layered sigils that pulse with complementary energy\u2014where Vale's work was rigid structure, yours flows like living circuitry, filling gaps and reinforcing weak points. The corrupted entity's manifestation slows visibly, tendrils recoiling from the doubled barrier as reality reasserts itself around the containment field. Your combined ritual creates a stable resonance lock that will hold the breach in check, though you feel the strain in your neural pathways\u2014this much precision requires constant focus to maintain. Around you, Freeborn raiders pause their assault, staring at the shimmering astral barrier now protecting the very registry they came to destroy.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 832, "output": 220}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:22:22.389540", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "phase": "adjudicate", "agent": "Riven Ashglow", "action": "Perform protective ritual to stabilize Vale's containment and prevent further void seepage", "context": {"action_type": "ritual", "is_ritual": true, "faction": "Resonance Communes", "description": "I kneel at the edge of Vale's geometric pattern, pulling incense from my satchel and lighting it with practiced ease. As the smoke rises, I channel astral energy through complementary sigils, weaving a secondary containment layer around their ritual work. My focus is on reinforcing what Vale has already established\u2014not adding raw power, but creating harmonious resonance to lock the breach in place and prevent the dangerous seep from widening.", "narration": "**Perform protective ritual to stabilize Vale's containment and prevent further void seepage**\nRoll: Willpower \u00d7 Astral Arts\nCalculation: 4 \u00d7 6 + d20(6) = **27**\nDC: 22 | Margin: +5 | Tier: **MODERATE** \u2713\nPerform protective ritual to stabilize Vale's containment and prevent further void seepage succeeds adequately (margin: +5)\n\nThe incense smoke spirals upward, merging with Vale's geometric containment as your astral resonance locks into perfect harmony with their pattern. The void breach shudders, its chaotic seepage suddenly constrained by layered sigils that pulse with complementary energy\u2014where Vale's work was rigid structure, yours flows like living circuitry, filling gaps and reinforcing weak points. The corrupted entity's manifestation slows visibly, tendrils recoiling from the doubled barrier as reality reasserts itself around the containment field. Your combined ritual creates a stable resonance lock that will hold the breach in check, though you feel the strain in your neural pathways\u2014this much precision requires constant focus to maintain. Around you, Freeborn raiders pause their assault, staring at the shimmering astral barrier now protecting the very registry they came to destroy.\n\n\u2696\ufe0f Soulcredit: +1 (Selfless ritual to contain void threat and protect civilians)\n\n\ud83e\ude79 Condition (Recursionist Vale): Ritual Focus Strain (-1)", "is_free_action": false, "initiative": 36, "clock_deltas": [], "clock_sources": {"Void Manifestation": "structured_output", "Registry Preservation": "structured_output"}, "ritual": true, "altar": false, "offering": false, "echo_calibrator": false, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Willpower", "attr_val": 4, "skill": "Astral Arts", "skill_val": 6, "ability": 24, "d20": 6, "total": 27, "dc": 22, "margin": 5, "tier": "moderate", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 12, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 21, "margin_needed": -1, "d20_needed": 1}, "moderate_success": {"dc_threshold": 22, "margin_needed": 0, "d20_needed": 1}, "good_success": {"dc_threshold": 27, "margin_needed": 5, "d20_needed": 3}, "excellent_success": {"dc_threshold": 32, "margin_needed": 10, "d20_needed": 8}, "exceptional_success": {"dc_threshold": 37, "margin_needed": 15, "d20_needed": 13}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 1, "soulcredit_reasons": ["Selfless ritual to contain void threat and protect civilians"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "5/8", "Void Manifestation": "0/4"}, "effects": ["Ritual Focus Strain: Mental fatigue from maintaining complex resonance pattern"], "character_data": {"name": "Riven Ashglow", "attributes": {"strength": 2, "agility": 4, "endurance": 2, "perception": 3, "intelligence": 3, "empathy": 4, "willpower": 4, "charisma": 3, "size": 10}, "skills": {"astral_arts": 6, "attunement": 5, "charm": 3, "awareness": 3, "stealth": 3, "melee": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -4}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Freeborn Assault, Void Manifestation", "goal": "Perform protective ritual to stabilize Vale's containment and prevent further void seepage", "roll_formula": "Willpower 4 \u00d7 Astral Arts 6 = 24; 24 + d20(6) = 27 vs DC 22", "rationale": "DC 22 (Challenging) for ritual action; no offering (+void risk)", "outcome_tiers_full": {"critical_failure": {"narrative": "Your resonance clashes catastrophically with Vale's geometry, shattering both patterns. The void breach explodes outward, tendrils lashing through the auction hall as reality tears wider. You're thrown backward, neural pathways seared by astral feedback, as the entity materializes fully.", "mechanical_effect": "Void Manifestation: +3 ticks (accelerated materialization), Void: +2 (ritual backfire), 8 damage (astral feedback), Stunned 2 rounds, Vale's containment destroyed"}, "failure": {"narrative": "Your incense smoke wavers, unable to find harmonic resonance with Vale's precise geometry. The patterns remain separate, your astral energy sliding off their containment like oil on water. The void breach continues seeping unimpeded.", "mechanical_effect": "No clock progress, Void: +1 (failed ritual exposure), wasted offerings, Vale's containment remains but no reinforcement"}, "moderate_success": {"narrative": "Your resonance locks into Vale's geometry with solid harmony, creating a dual-layer barrier that visibly constrains the void breach. The entity's manifestation slows as reality reasserts itself, though maintaining this precision requires constant mental strain.", "mechanical_effect": "Void Manifestation: -2 ticks (slowed), Registry Preservation: +1 tick (barrier protects archives), Ritual Focus Strain condition (-1 for 3 rounds), Soulcredit: +1"}, "good_success": {"narrative": "Your astral resonance weaves seamlessly through Vale's geometric framework, amplifying their containment into a shimmering fortress of layered sigils. The void breach recoils violently, tendrils dissolving against the reinforced barrier as the entity's manifestation grinds to a near-halt.", "mechanical_effect": "Void Manifestation: -3 ticks (severely slowed), Registry Preservation: +2 ticks (strong protection), Environmental Void: -1 (containment purifying area), Soulcredit: +1"}, "excellent_success": {"narrative": "Perfect harmonic resonance\u2014your incense smoke becomes living circuitry that fuses with Vale's geometry into a single unified containment field. The void breach shrinks visibly, corruption burning away as your combined ritual achieves what neither could alone. The manifesting entity screams soundlessly, its form fragmenting.", "mechanical_effect": "Void Manifestation: -4 ticks (nearly sealed), Registry Preservation: +3 ticks (exceptional protection), Environmental Void: -2 (major purification), Inspired condition (+2 for 2 rounds), Soulcredit: +2"}, "exceptional_success": {"narrative": "Your resonance doesn't just reinforce Vale's work\u2014it transcends it, transforming their rigid geometry into a living astral mandala that pulses with purifying energy. The void breach collapses inward, sealing completely as reality crystallizes around the containment. The entity is banished before fully manifesting, and even the Freeborn raiders stagger back from the radiant display of astral mastery.", "mechanical_effect": "Void Manifestation: SEALED (clock emptied), Registry Preservation: +4 ticks (complete protection), Environmental Void: -3 (area cleansed), all allies gain Inspired (+2 for 3 rounds), Soulcredit: +2, story advancement possible"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:22:22.390842", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:23:23.806242", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.42857142857142855, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:23:23.806324", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 10, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Ash Vex (Tempest Industries)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action failed with margin -10 (outcome: failure)\n\n\nPlayer Action: I shift my approach from raw power to technical analysis, using my neural implants and void-attuned sensors to map the breach's resonance frequencies and structural weaknesses. The incense smoke from Vale's ritual provides a visible tracer for the energy flows, letting me identify the optimal dispersion vectors without feeding it more power.\nAction Type: investigate\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (5/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Your neural implants synchronize with Vale's ritual smoke, mapping the void breach's resonance signature across seventeen dimensional frequencies. But the data floods your synapses too fast\u2014inverted harmonics spike through your sensors, and you realize with cold dread that this isn't a natural breach. Someone engineered this manifestation with Tempest-grade void-tech, and the frequency pattern matches your own faction's research signatures. The breach isn't random chaos\u2014it's a weaponized entity designed to consume debt records while leaving infrastructure intact, and whoever deployed it knows Tempest's proprietary resonance codes. Your analysis reveals structural weak points in the manifestation's cohesion matrix, but the encrypted command protocols are locked behind authentication you don't have clearance for. Worse, ACG security drones are now scanning the area, and your Tempest-attuned sensors are broadcasting identification signatures that will flag you as complicit in this attack within seconds.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 798, "output": 253}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:23:23.806750", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "phase": "adjudicate", "agent": "Ash Vex", "action": "Analyze the void breach's energy signature to identify how to properly disperse it", "context": {"action_type": "investigate", "is_ritual": false, "faction": "Tempest Industries", "description": "I shift my approach from raw power to technical analysis, using my neural implants and void-attuned sensors to map the breach's resonance frequencies and structural weaknesses. The incense smoke from Vale's ritual provides a visible tracer for the energy flows, letting me identify the optimal dispersion vectors without feeding it more power.", "narration": "**Analyze the void breach's energy signature to identify how to properly disperse it**\nRoll: Intelligence (unskilled)\nCalculation: 4 + d20(9) - 5 = **8**\nDC: 18 | Margin: -10 | Tier: **FAILURE** \u2717\nAnalyze the void breach's energy signature to identify how to properly disperse it fails (margin: -10)\n\nYour neural implants synchronize with Vale's ritual smoke, mapping the void breach's resonance signature across seventeen dimensional frequencies. But the data floods your synapses too fast\u2014inverted harmonics spike through your sensors, and you realize with cold dread that this isn't a natural breach. Someone engineered this manifestation with Tempest-grade void-tech, and the frequency pattern matches your own faction's research signatures. The breach isn't random chaos\u2014it's a weaponized entity designed to consume debt records while leaving infrastructure intact, and whoever deployed it knows Tempest's proprietary resonance codes. Your analysis reveals structural weak points in the manifestation's cohesion matrix, but the encrypted command protocols are locked behind authentication you don't have clearance for. Worse, ACG security drones are now scanning the area, and your Tempest-attuned sensors are broadcasting identification signatures that will flag you as complicit in this attack within seconds.\n\n\u2696\ufe0f Soulcredit: +0 (Neutral investigation attempt, no moral choice involved despite discovery of faction connection)", "is_free_action": false, "initiative": 22, "clock_deltas": [], "clock_sources": {"Void Manifestation": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Intelligence", "attr_val": 4, "skill": "Magick Theory", "skill_val": 0, "ability": -1, "d20": 9, "total": 8, "dc": 18, "margin": -10, "tier": "failure", "success": false}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 9}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 18}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 19}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 24}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 29}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 34}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Neutral investigation attempt, no moral choice involved despite discovery of faction connection"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "5/8", "Void Manifestation": "0/4"}, "effects": [], "character_data": {"name": "Ash Vex", "attributes": {"strength": 3, "agility": 4, "endurance": 3, "perception": 4, "intelligence": 4, "empathy": 2, "willpower": 3, "charisma": 2, "size": 10}, "skills": {"astral_arts": 4, "systems": 5, "stealth": 4, "awareness": 4, "drone_operation": 4, "guns": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -1}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Freeborn Assault, Void Manifestation", "goal": "Analyze the void breach's energy signature to identify how to properly disperse it", "roll_formula": "Intelligence 4 - 5 (unskilled) = -1; -1 + d20(9) = 8 vs DC 18", "rationale": "DC 18 (Moderate) for investigate action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your neural implants overload as inverted void harmonics feedback through your sensors, searing corrupted data directly into your synapses. You collapse, bleeding from your nose and ears, while the breach pulses with malevolent recognition\u2014it knows you tried to analyze it, and now it knows exactly where you are. ACG security drones lock onto your Tempest signatures and broadcast arrest protocols.", "mechanical_effect": "+2 Void (neural corruption from feedback), Stunned condition (penalty -5, 2 rounds), Void Manifestation clock +2 (analysis accelerated entity cohesion), ACG security now actively hostile"}, "failure": {"narrative": "The data floods your synapses too fast\u2014you identify Tempest-grade void-tech signatures but can't extract dispersion vectors before ACG security drones begin scanning for the source of Tempest frequencies. You've learned the breach is weaponized but gained no actionable countermeasures, and your faction affiliation is now compromised.", "mechanical_effect": "Void Manifestation clock +1 (lost time without countermeasure), ACG security detecting Tempest signatures, no tactical advantage gained"}, "moderate_success": {"narrative": "Your analysis maps three primary resonance weak points in the manifestation's cohesion matrix, though the Tempest-grade encryption remains locked. You identify partial dispersion vectors\u2014enough to disrupt the entity temporarily, but not destroy it. ACG drones are scanning nearby, but you've masked your Tempest signatures for now.", "mechanical_effect": "Registry Preservation clock +1 (identified weak points), gained tactical data: +2 to next action targeting void breach, Tempest connection remains hidden"}, "good_success": {"narrative": "Your neural implants decode the breach's resonance signature, revealing five structural weak points and optimal dispersion vectors. The Tempest-grade encryption is sophisticated, but you recognize the research team's signature\u2014this is Project Nullweave, a black-ops weapon you've heard whispers about. You now know exactly how to collapse the manifestation's cohesion matrix.", "mechanical_effect": "Registry Preservation clock +2 (comprehensive analysis), gained tactical advantage: allies get +3 to actions targeting breach, identified Project Nullweave connection (story intel)"}, "excellent_success": {"narrative": "Your sensors pierce through the void-tech's encryption layers, exposing not just the manifestation's weak points but the remote command protocols controlling it. You trace the signal back to a Freeborn raider carrying a Tempest-issued control device\u2014someone inside your faction sold this weapon to the enemy. You can now either hijack the entity's control systems or feed false resonance data to collapse it entirely.", "mechanical_effect": "Registry Preservation clock +3 (full tactical control), identified traitor (major story intel), option unlocked: hijack void entity or collapse it remotely, +1 Soulcredit (uncovered internal conspiracy)"}, "exceptional_success": {"narrative": "Your analysis is flawless\u2014you decrypt the entire command structure, map every resonance frequency, and identify the Freeborn operative with the control device. You recognize the encryption signature as belonging to Dr. Kael Vorthen, your former Tempest mentor who vanished six months ago. The void entity contains hidden coordinates to a Tempest black site. You can neutralize the threat and gain critical intelligence.", "mechanical_effect": "Registry Preservation clock +4 (complete mastery), Void Manifestation clock -2 (identified shutdown protocols), major story advancement: Dr. Vorthen conspiracy revealed, black site coordinates obtained, +2 Soulcredit (uncovered major threat to faction integrity)"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:23:23.808063", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:24:21.320432", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.42857142857142855, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:24:21.320535", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 11, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Recursionist Vale (Fractal Praxis)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +5 (outcome: moderate)\n\n\nPlayer Action: I trace the fractal patterns of the breach's containment field, mapping the resonance frequencies and identifying where additional counter-pressure would most effectively disperse the remaining void energy without triggering another cascade. My understanding of ritual mechanics lets me see the mathematical structure underlying the corruption.\nAction Type: investigate\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (5/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Your neural implants overlay fractal equations across the dissipating void breach, mapping resonance harmonics in crystalline clarity. The mathematical structure reveals three critical nodes where the containment field is hemorrhaging energy\u2014precise points where counter-pressure would collapse the remaining corruption without triggering cascade failure. You identify the exact ritual geometry needed: a triangulated ward pattern anchored at coordinates 47.3\u00b0, 112.8\u00b0, and 289.1\u00b0 relative to the breach epicenter, requiring synchronized astral focusing to achieve dispersal. The analysis also reveals something troubling\u2014the breach wasn't random. Someone deliberately weakened the Basilica's void shielding using a fractal dissolution pattern, and the mathematical signature matches Tempest Industries' experimental research you've seen in classified Fractal Praxis archives.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 800, "output": 219}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:24:21.320938", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "phase": "adjudicate", "agent": "Recursionist Vale", "action": "Analyze the void breach's current state to identify optimal dispersal vectors", "context": {"action_type": "investigate", "is_ritual": false, "faction": "Fractal Praxis", "description": "I trace the fractal patterns of the breach's containment field, mapping the resonance frequencies and identifying where additional counter-pressure would most effectively disperse the remaining void energy without triggering another cascade. My understanding of ritual mechanics lets me see the mathematical structure underlying the corruption.", "narration": "**Analyze the void breach's current state to identify optimal dispersal vectors**\nRoll: Intelligence \u00d7 Magick Theory\nCalculation: 5 \u00d7 4 + d20(5) = **23**\nDC: 18 | Margin: +5 | Tier: **MODERATE** \u2713\nAnalyze the void breach's current state to identify optimal dispersal vectors succeeds adequately (margin: +5)\n\nYour neural implants overlay fractal equations across the dissipating void breach, mapping resonance harmonics in crystalline clarity. The mathematical structure reveals three critical nodes where the containment field is hemorrhaging energy\u2014precise points where counter-pressure would collapse the remaining corruption without triggering cascade failure. You identify the exact ritual geometry needed: a triangulated ward pattern anchored at coordinates 47.3\u00b0, 112.8\u00b0, and 289.1\u00b0 relative to the breach epicenter, requiring synchronized astral focusing to achieve dispersal. The analysis also reveals something troubling\u2014the breach wasn't random. Someone deliberately weakened the Basilica's void shielding using a fractal dissolution pattern, and the mathematical signature matches Tempest Industries' experimental research you've seen in classified Fractal Praxis archives.\n\n\u2696\ufe0f Soulcredit: +0 (Neutral investigation and analysis)", "is_free_action": false, "initiative": 16, "clock_deltas": [], "clock_sources": {"Void Manifestation": "structured_output", "Registry Preservation": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Intelligence", "attr_val": 5, "skill": "Magick Theory", "skill_val": 4, "ability": 20, "d20": 5, "total": 23, "dc": 18, "margin": 5, "tier": "moderate", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 1}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 1}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 3}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 8}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 13}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Neutral investigation and analysis"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "5/8", "Void Manifestation": "0/4"}, "effects": [], "character_data": {"name": "Recursionist Vale", "attributes": {"strength": 2, "agility": 3, "endurance": 3, "perception": 3, "intelligence": 5, "empathy": 2, "willpower": 4, "charisma": 2, "size": 10}, "skills": {"astral_arts": 6, "attunement": 5, "magick_theory": 4, "systems": 4, "awareness": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -1}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Freeborn Assault, Void Manifestation", "goal": "Analyze the void breach's current state to identify optimal dispersal vectors", "roll_formula": "Intelligence 5 \u00d7 Magick Theory 4 = 20; 20 + d20(5) = 23 vs DC 18", "rationale": "DC 18 (Moderate) for investigate action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your neural implants overload as you attempt to parse the breach's fractal structure\u2014inverted resonance patterns slam feedback through your consciousness. The containment field destabilizes catastrophically, void energy surging outward in cascading waves. Your mind reels from the mathematical impossibility you've just witnessed, corruption seeping into your thoughts.", "mechanical_effect": "+2 Void (neural corruption), Void Manifestation +2 (cascade), Stunned (-3 penalty, 1 round)"}, "failure": {"narrative": "The fractal equations blur and shift as you try to map them\u2014the breach's resonance frequencies are too chaotic, patterns dissolving before you can lock them down. You grasp fragments of understanding but nothing actionable, and precious seconds tick away as the void energy continues to bleed through weakened containment.", "mechanical_effect": "No progress, no intel gained, 1 round wasted"}, "moderate_success": {"narrative": "Your neural implants overlay fractal equations across the dissipating void breach, mapping resonance harmonics in crystalline clarity. The mathematical structure reveals three critical nodes where the containment field is hemorrhaging energy\u2014precise points where counter-pressure would collapse the remaining corruption. You also detect deliberate sabotage patterns in the breach's formation.", "mechanical_effect": "Void Manifestation -2, Registry Preservation +1, intel: Tempest Industries sabotage signature"}, "good_success": {"narrative": "The breach's fractal architecture unfolds before you like a three-dimensional equation\u2014every resonance node, every harmonic weakness laid bare. You identify not just the containment solution but the exact ritual sequence needed, plus irrefutable evidence of Tempest Industries' involvement. The mathematical signature is unmistakable, and you recognize the specific researcher's style from classified archives.", "mechanical_effect": "Void Manifestation -3, Registry Preservation +2, intel: specific Tempest researcher, +1 Soulcredit"}, "excellent_success": {"narrative": "Your consciousness expands through the breach's mathematical framework, perceiving not just the containment solution but the underlying void mechanics themselves. You map the entire sabotage network\u2014hidden fractal dissolution patterns woven throughout the Basilica's shielding, dormant triggers waiting in other ACG facilities. The breach collapses under your analytical precision, void energy dissipating harmlessly as you impose mathematical order on chaos.", "mechanical_effect": "Void Manifestation completed, Registry Preservation +3, intel: multi-facility sabotage network, +2 SC, -1 Void"}, "exceptional_success": {"narrative": "You don't just analyze the breach\u2014you rewrite its fundamental equations. Your neural implants burn with transcendent clarity as you perceive the void's mathematical substrate, the fractal patterns underlying reality itself. The breach doesn't merely collapse; it inverts, channeling void energy back through Tempest's sabotage network in a cascade of purifying resonance. Across Aeonisk Prime, hidden dissolution patterns burn out in synchronized failure, and you've mapped every single one.", "mechanical_effect": "All clocks advanced favorably, complete sabotage network mapped, +3 SC, -2 Void, allies +2 next action"}}}
{"event_type": "llm_call", "ts": "2025-10-31T22:24:36.478250", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 12, "prompt": [{"role": "system", "content": "You are the DM for Aeonisk YAGS, synthesizing a round of actions."}, {"role": "user", "content": "You are the DM for a dark sci-fi TTRPG. Multiple characters just acted simultaneously.\n\n**What they tried to do:**\n- Riven Ashglow succeeded at: Perform protective ritual to stabilize Vale's containment and prevent further void seepage\n- Ash Vex failed at: Analyze the void breach's energy signature to identify how to properly disperse it\n- Recursionist Vale succeeded at: Analyze the void breach's current state to identify optimal dispersal vectors\n\n\n**Current Clock State:**\n  - Freeborn Assault: 0/6\n    Advance = Raiders breach deeper into the facility, getting closer to the vault | Regress = Raiders pushed back or delayed by defenders\n  - Registry Preservation: 7/8\n    Advance = Security measures activated, backups secured, vault defenses reinforced | Regress = Systems damaged, data corrupted, defenses failing\n  - Void Manifestation: 0/4\n    Advance = Void presence intensifies, reality warps, corruption spreads | Regress = Containment rituals applied, void energy dispersed\n\n\n\n\n**Your task:** Write a cohesive narrative (1-2 paragraphs) describing what happened when these actions played out together. Consider:\n- Timing: Actions resolved fastest \u2192 slowest based on initiative\n- Interactions: How did each person's success/failure affect the others?\n- Conflicts: If multiple people tried similar things, who got there first? What did the slower person encounter?\n- Cause and effect: How did earlier successes/failures change the situation for later actors?\n- Overall outcome: What's the new situation now that the dust has settled?\n- **IMPORTANT**: If objectives (clocks) are not advancing despite actions, acknowledge this! Characters should feel the pressure of marginal success or outright failure.\n\nBe vivid and cinematic. Show how these actions interacted and created a dynamic scene. Describe the final state of the situation after all actions resolved.\n\nIf the team is failing their objectives (clocks not advancing or bad clocks filling), your narration should reflect the growing desperation, consequences, and danger.\n\n**\u26a0\ufe0f  CLOCK INTERPRETATION - READ CAREFULLY:**\nEach clock has semantic meaning shown as \"Advance = X\" and \"Regress = Y\".\n- If \"Advance = threat escalates\", then HIGH values are BAD for players\n- If \"Advance = progress made\", then HIGH values are GOOD for players\n- Use the semantic labels to interpret whether clock changes help or hurt the party\n- When a clock REGRESSES, check if that's good (threat reduced) or bad (progress lost)\n\n**CRITICAL**: If any clocks just filled, you MUST describe the dramatic consequences. This could include:\n- Character injury or void corruption (specify who and how much void: \"+2 void\")\n- Character death/dissolution if appropriate\n- Mission failure or catastrophic events\n- Environmental changes or new threats\n- Success and rewards if it's a positive clock\n\nGenerate appropriate consequences based on what makes sense for that specific clock in this scenario.\n\n\n\n**SPAWN ENEMIES - CLOCK FILLS ONLY:**\n\u26a0\ufe0f  **CRITICAL RESTRICTION**: You may ONLY spawn enemies when a clock with [SPAWN_ENEMY: ...] in its filled_consequence actually fills!\n\n\u274c **FORBIDDEN**: Do NOT spawn enemies in general narration\n\u274c **FORBIDDEN**: Do NOT add [SPAWN_ENEMY: ...] to dramatic descriptions\n\u274c **FORBIDDEN**: Do NOT spawn \"because it feels dramatic\"\n\n\u2705 **ALLOWED**: ONLY when you see \"\ud83c\udfaf When filled: [SPAWN_ENEMY: ...]\" in the clock list above\n\nSyntax: [SPAWN_ENEMY: name | template | count | position | tactics]\nExample from filled clock: [SPAWN_ENEMY: Security Team | grunt | 2 | Far-Enemy | tactical_ranged]\n\nTemplates: grunt (15 HP), elite (25 HP), sniper (20 HP), boss (40 HP), enforcer (30 HP), ambusher (18 HP)\nPositions: Engaged, Near-Enemy, Far-Enemy, Extreme-Enemy\nTactics: aggressive_melee, defensive_ranged, tactical_ranged, extreme_range, ambush, adaptive\n\n**WHY THIS RESTRICTION**: Mid-round spawns bypass clock-based pacing and overwhelm players. Spawns must be predictable and tied to clock advancement.\n\n**DESPAWN ENEMIES - AUTOMATIC MECHANIC:**\nWhen a clock with [DESPAWN_ENEMY: ...] in its filled_consequence fills, that enemy is automatically removed from combat.\n\nSyntax: [DESPAWN_ENEMY: enemy_name | reason]\nExample from filled clock: [DESPAWN_ENEMY: Freeborn Pirates | escaped]\n\nCommon reasons: escaped, retreated, teleported, fled, recalled, withdrew\n\n**IMPORTANT**: You still narrate the escape/withdrawal, but the [DESPAWN_ENEMY: ...] marker is already in the clock's filled_consequence. Just copy the consequence text including the marker when you describe what happens."}], "response": "Riven Ashglow moves first, their hands weaving intricate patterns as protective sigils flare to life around Vale's trembling form. The ritual takes hold\u2014glyphs of containment searing into the air, forming a lattice of stabilizing energy that wraps around the Recursionist like a second skin. Vale's chaotic void aura dims slightly, no longer threatening to tear reality apart at the seams. The immediate crisis is averted, but the respite is fragile.\n\nAsh Vex lunges forward next, scanner arrays flickering as they attempt to analyze the breach's energy signature. But the void defies comprehension\u2014readings cascade into paradox, instruments screaming contradictory data. Ash curses, pulling back as their equipment overheats, unable to identify a proper dispersal method. The void breach continues to pulse ominously, untouched. Then Vale, steadied by Riven's ritual, turns their fractured perception inward. Through shattered timelines and probability echoes, they see it\u2014the optimal dispersal vectors, the precise angles where reality is thinnest, where the void can be bled away safely. They call out coordinates, their voice multiplying across temporal layers.\n\nThe situation stabilizes, but barely. The vault's defenses hum at near-maximum capacity (Registry Preservation: 7/8), one tick away from full security lockdown. The void manifestation remains dormant for now (0/4), contained but not eliminated\u2014a ticking time bomb waiting for the next mistake. Outside, the Freeborn raiders have yet to make significant progress (0/6), but their assault continues unabated. The team has bought themselves breathing room, nothing more. One wrong move, and everything unravels.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 1138, "output": 418}}
{"event_type": "round_synthesis", "ts": "2025-10-31T17:24:36.479697", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "synthesis": "Riven Ashglow moves first, their hands weaving intricate patterns as protective sigils flare to life around Vale's trembling form. The ritual takes hold\u2014glyphs of containment searing into the air, forming a lattice of stabilizing energy that wraps around the Recursionist like a second skin. Vale's chaotic void aura dims slightly, no longer threatening to tear reality apart at the seams. The immediate crisis is averted, but the respite is fragile.\n\nAsh Vex lunges forward next, scanner arrays flickering as they attempt to analyze the breach's energy signature. But the void defies comprehension\u2014readings cascade into paradox, instruments screaming contradictory data. Ash curses, pulling back as their equipment overheats, unable to identify a proper dispersal method. The void breach continues to pulse ominously, untouched. Then Vale, steadied by Riven's ritual, turns their fractured perception inward. Through shattered timelines and probability echoes, they see it\u2014the optimal dispersal vectors, the precise angles where reality is thinnest, where the void can be bled away safely. They call out coordinates, their voice multiplying across temporal layers.\n\nThe situation stabilizes, but barely. The vault's defenses hum at near-maximum capacity (Registry Preservation: 7/8), one tick away from full security lockdown. The void manifestation remains dormant for now (0/4), contained but not eliminated\u2014a ticking time bomb waiting for the next mistake. Outside, the Freeborn raiders have yet to make significant progress (0/6), but their assault continues unabated. The team has bought themselves breathing room, nothing more. One wrong move, and everything unravels."}
{"event_type": "character_state", "ts": "2025-10-31T17:24:36.480177", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "character_id": "player_01", "character_name": "Riven Ashglow", "health": 25, "max_health": 25, "wounds": 0, "void_score": 3, "soulcredit": -4, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T17:24:36.480271", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "character_id": "player_02", "character_name": "Ash Vex", "health": 26, "max_health": 26, "wounds": 0, "void_score": 4, "soulcredit": -1, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T17:24:36.480326", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "character_id": "player_03", "character_name": "Recursionist Vale", "health": 26, "max_health": 26, "wounds": 0, "void_score": 0, "soulcredit": -1, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "round_summary", "ts": "2025-10-31T17:24:36.480400", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 3, "actions_attempted": 3, "success_count": 2, "success_rate": 0.6666666666666666, "average_margin": 0.0, "damage_dealt_by_players": 0, "damage_taken_by_players": 0, "void_gained": 0, "void_lost": 0, "clocks_advanced": 1, "clocks_filled": 0, "active_enemies": 0, "player_wounds_total": 0}
{"event_type": "round_start", "ts": "2025-10-31T17:24:39.485270", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4}
{"event_type": "declaration_phase_start", "ts": "2025-10-31T17:24:39.489476", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4}
{"event_type": "action_declaration", "ts": "2025-10-31T17:24:57.840803", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "player_id": "player_01", "character_name": "Riven Ashglow", "initiative": 18, "action": {"intent": "Share Vale's dispersal vectors with Ash to guide their next containment attempt", "description": "I quickly relay Vale's temporal analysis to Ash, pointing out the precise coordinates and energy patterns they identified. \"These are the weak points\u2014if you can route containment protocols through these vectors, we can bleed off the void energy safely without triggering a cascade.\" I make sure they understand the urgency and precision required.", "attribute": "Empathy", "skill": "Charm", "difficulty_estimate": 12, "difficulty_justification": "Easy coordination with willing ally who's already attempting similar work; clear technical information to share", "character_name": "Riven Ashglow", "agent_id": "player_01", "action_type": "social", "target_position": null, "target": "tgt_hdsb", "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:24:57.840328", "attribute_value": 4, "skill_value": 3, "character": "Riven Ashglow", "faction": "Resonance Communes", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T17:25:16.514107", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "player_id": "player_03", "character_name": "Recursionist Vale", "initiative": 19, "action": {"intent": "Coordinate with Riven and Ash on using my dispersal vectors to safely bleed off the void breach", "description": "I relay the precise coordinates and dispersal vectors I've identified to Riven and Ash, explaining how the void energy can be safely bled away through reality's thinnest points. My fractal analysis shows the optimal sequence - if they can channel containment energy along these vectors while I maintain temporal stability, we can dissipate the breach without triggering a cascade.", "attribute": "Empathy", "skill": null, "difficulty_estimate": 15, "difficulty_justification": "Routine coordination with willing allies who trust my analysis, though the technical information is complex", "character_name": "Recursionist Vale", "agent_id": "player_03", "action_type": "social", "target_position": null, "target": "tgt_be5h", "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:25:16.513653", "attribute_value": 2, "skill_value": 0, "character": "Recursionist Vale", "faction": "Fractal Praxis", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T17:25:29.415234", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "player_id": "player_02", "character_name": "Ash Vex", "initiative": 33, "action": {"intent": "Channel void dispersal ritual using Vale's coordinates to safely bleed away breach energy", "description": "With Vale's fractal coordinates echoing in my mind, I position myself at the optimal dispersal vector and channel astral energy through my focus. The incense smoke spirals as I weave the dispersal pattern, bleeding void energy safely into designated containment channels rather than letting it collapse chaotically.", "attribute": "Willpower", "skill": "Astral Arts", "difficulty_estimate": 20, "difficulty_justification": "Moderate - Vale provided optimal vectors (+2 coordination bonus), but void breach is still volatile and requires precise channeling", "character_name": "Ash Vex", "agent_id": "player_02", "action_type": "ritual", "target_position": null, "target": null, "target_character": null, "is_ritual": true, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:25:29.414691", "attribute_value": 3, "skill_value": 4, "character": "Ash Vex", "faction": "Tempest Industries", "is_free_action": false}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:25:29.415647", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:26:27.253652", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": ["Void change applied to 'Environmental Void' (action by 'Ash Vex') - verify this is intentional"], "validation_issues_count": 1, "completeness_score": 0.5714285714285714, "is_complete": false}
{"event_type": "llm_call", "ts": "2025-10-31T22:26:27.253820", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 13, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Ash Vex (Tempest Industries)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +9 (outcome: moderate)\n\n\nPlayer Action: With Vale's fractal coordinates echoing in my mind, I position myself at the optimal dispersal vector and channel astral energy through my focus. The incense smoke spirals as I weave the dispersal pattern, bleeding void energy safely into designated containment channels rather than letting it collapse chaotically.\nAction Type: ritual\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (7/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "The astral pattern ignites through Vale's coordinates\u2014fractal geometries of dispersal that bleed void corruption into harmonic channels rather than chaotic collapse. Your incense smoke spirals through precise vectors as corrupted energy drains from the manifestation site, flowing into containment sigils you've woven across the marble floor. The void-tainted smoke thins visibly, the oppressive weight lifting from the auction hall as ACG security personnel stare in amazement\u2014a Tempest operative just saved their registry from dimensional breach. But through the clearing haze, you glimpse the Freeborn raiders regrouping near the western vaults, their leader snarling orders into a comm unit as they realize their void weapon is being neutralized.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 790, "output": 187}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:26:27.254713", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "phase": "adjudicate", "agent": "Ash Vex", "action": "Channel void dispersal ritual using Vale's coordinates to safely bleed away breach energy", "context": {"action_type": "ritual", "is_ritual": true, "faction": "Tempest Industries", "description": "With Vale's fractal coordinates echoing in my mind, I position myself at the optimal dispersal vector and channel astral energy through my focus. The incense smoke spirals as I weave the dispersal pattern, bleeding void energy safely into designated containment channels rather than letting it collapse chaotically.", "narration": "**Channel void dispersal ritual using Vale's coordinates to safely bleed away breach energy**\nRoll: Willpower \u00d7 Astral Arts\nCalculation: 3 \u00d7 4 + d20(19) = **31**\nDC: 22 | Margin: +9 | Tier: **MODERATE** \u2713\nChannel void dispersal ritual using Vale's coordinates to safely bleed away breach energy succeeds adequately (margin: +9)\n\nThe astral pattern ignites through Vale's coordinates\u2014fractal geometries of dispersal that bleed void corruption into harmonic channels rather than chaotic collapse. Your incense smoke spirals through precise vectors as corrupted energy drains from the manifestation site, flowing into containment sigils you've woven across the marble floor. The void-tainted smoke thins visibly, the oppressive weight lifting from the auction hall as ACG security personnel stare in amazement\u2014a Tempest operative just saved their registry from dimensional breach. But through the clearing haze, you glimpse the Freeborn raiders regrouping near the western vaults, their leader snarling orders into a comm unit as they realize their void weapon is being neutralized.\n\n\u26ab Void (Ash Vex): 4 \u2193 2/10 (Successful dispersal ritual with proper offerings, void energy bled into containment channels)\n\n\u2696\ufe0f Soulcredit: +1 (Protected innocent civilians and preserved critical infrastructure despite faction tensions)", "is_free_action": false, "initiative": 33, "clock_deltas": [], "clock_sources": {"Void Manifestation": "structured_output", "Registry Preservation": "structured_output"}, "ritual": true, "altar": false, "offering": false, "echo_calibrator": false, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Willpower", "attr_val": 3, "skill": "Astral Arts", "skill_val": 4, "ability": 12, "d20": 19, "total": 31, "dc": 22, "margin": 9, "tier": "moderate", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 12, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 21, "margin_needed": -1, "d20_needed": 9}, "moderate_success": {"dc_threshold": 22, "margin_needed": 0, "d20_needed": 10}, "good_success": {"dc_threshold": 27, "margin_needed": 5, "d20_needed": 15}, "excellent_success": {"dc_threshold": 32, "margin_needed": 10, "d20_needed": 20}, "exceptional_success": {"dc_threshold": 37, "margin_needed": 15, "d20_needed": 25}}, "economy": {"void_delta": -2, "void_triggers": ["Successful dispersal ritual with proper offerings, void energy bled into containment channels"], "void_source": "structured_output", "soulcredit_delta": 1, "soulcredit_reasons": ["Protected innocent civilians and preserved critical infrastructure despite faction tensions"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "7/8", "Void Manifestation": "0/4"}, "effects": [], "character_data": {"name": "Ash Vex", "attributes": {"strength": 3, "agility": 4, "endurance": 3, "perception": 4, "intelligence": 4, "empathy": 2, "willpower": 3, "charisma": 2, "size": 10}, "skills": {"astral_arts": 4, "systems": 5, "stealth": 4, "awareness": 4, "drone_operation": 4, "guns": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -1}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Clocks near completion: Registry Preservation (7/8); Neglected objectives: Freeborn Assault, Void Manifestation", "goal": "Channel void dispersal ritual using Vale's coordinates to safely bleed away breach energy", "roll_formula": "Willpower 3 \u00d7 Astral Arts 4 = 12; 12 + d20(19) = 31 vs DC 22", "rationale": "DC 22 (Challenging) for ritual action; no offering (+void risk)", "outcome_tiers_full": {"critical_failure": {"narrative": "The fractal pattern inverts catastrophically\u2014your containment channels become conduits for amplification instead of dispersal. Void energy explodes outward in a reality-tearing shockwave, shattering holographic displays and cracking marble pillars. Civilians scream as dimensional tears open across the hall, and you feel corruption flooding through your neural pathways like ice water.", "mechanical_effect": "+3 Void (Ash Vex), Void Manifestation +3, Registry Preservation -2, 2 wounds from backlash, Stunned (-5, 2 rounds)"}, "failure": {"narrative": "Vale's coordinates slip through your mental grasp like smoke. The dispersal pattern forms but lacks coherence\u2014void energy bleeds chaotically rather than flowing into containment. The manifestation continues unabated, and your incense burns uselessly as corrupted smoke thickens around you.", "mechanical_effect": "+1 Void (Ash Vex) from failed ritual exposure, no clock changes, wasted turn"}, "moderate_success": {"narrative": "The fractal pattern holds but barely\u2014you manage to redirect some void energy into containment channels, but the flow is uneven and unstable. The manifestation weakens slightly, smoke thinning in patches, but you can feel the pattern straining at the edges, threatening to unravel.", "mechanical_effect": "Void Manifestation -1 (partial dispersal), Environmental Void -1, Registry Preservation +1"}, "good_success": {"narrative": "Vale's coordinates ignite through your astral focus with crystalline precision. The dispersal pattern flows smoothly, bleeding void corruption into harmonic containment channels. The oppressive weight lifts noticeably as corrupted smoke drains away, and ACG personnel watch in amazement as a Tempest operative saves their registry.", "mechanical_effect": "Void Manifestation -2, Environmental Void -2, Registry Preservation +1, +1 Soulcredit"}, "excellent_success": {"narrative": "The fractal geometries unfold like a perfect mathematical proof\u2014your dispersal pattern doesn't just contain the void energy, it transmutes it into harmless astral resonance. The corrupted smoke evaporates entirely, leaving the air clean and clear. ACG security stares in awe as reality stabilizes, and even the Freeborn raiders hesitate, their void weapon utterly neutralized.", "mechanical_effect": "Void Manifestation -3, Environmental Void -3, Registry Preservation +2, +2 Soulcredit, Freeborn Assault -1"}, "exceptional_success": {"narrative": "You don't just disperse the void energy\u2014you reverse-engineer the Freeborn's breach weapon through Vale's coordinates, turning their own corruption against them. The dispersal pattern becomes a purification matrix that floods the entire auction hall with cleansing astral light. Void corruption evaporates like morning frost, holographic systems flicker back to full function, and the Freeborn raiders' void-tech weapons short out in their hands.", "mechanical_effect": "Void Manifestation -4, Environmental Void -4, Registry Preservation +3, +2 Soulcredit, Freeborn Assault -2"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:26:27.255871", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:27:04.736057", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.42857142857142855, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:27:04.736284", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 14, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Recursionist Vale (Fractal Praxis)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action failed with margin -3 (outcome: failure)\n\n\nPlayer Action: I relay the precise coordinates and dispersal vectors I've identified to Riven and Ash, explaining how the void energy can be safely bled away through reality's thinnest points. My fractal analysis shows the optimal sequence - if they can channel containment energy along these vectors while I maintain temporal stability, we can dissipate the breach without triggering a cascade.\nAction Type: social\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (7/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT (target ID: tgt_be5h):**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (tgt_be5h): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "You begin transmitting the fractal coordinates through your neural link, but Riven's comm channel erupts with static\u2014void interference scrambling the precision vectors. Ash receives fragments of the dispersal pattern, but the critical temporal anchors are lost in the noise, leaving them with incomplete data and hesitant to act without full certainty. Through the distortion, you catch Riven's frustrated voice: \"Vale, I'm getting maybe forty percent of this\u2014if we move on partial data, we could make the breach worse!\" The void manifestation pulses brighter, reality warping around it as precious seconds tick away.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 814, "output": 154}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:27:04.737458", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "phase": "adjudicate", "agent": "Recursionist Vale", "action": "Coordinate with Riven and Ash on using my dispersal vectors to safely bleed off the void breach", "context": {"action_type": "social", "is_ritual": false, "faction": "Fractal Praxis", "description": "I relay the precise coordinates and dispersal vectors I've identified to Riven and Ash, explaining how the void energy can be safely bled away through reality's thinnest points. My fractal analysis shows the optimal sequence - if they can channel containment energy along these vectors while I maintain temporal stability, we can dissipate the breach without triggering a cascade.", "narration": "**Coordinate with Riven and Ash on using my dispersal vectors to safely bleed off the void breach**\nRoll: Empathy (unskilled)\nCalculation: 2 + d20(20) - 5 = **15**\nDC: 18 | Margin: -3 | Tier: **FAILURE** \u2717\nCoordinate with Riven and Ash on using my dispersal vectors to safely bleed off the void breach fails (margin: -3)\n\nYou begin transmitting the fractal coordinates through your neural link, but Riven's comm channel erupts with static\u2014void interference scrambling the precision vectors. Ash receives fragments of the dispersal pattern, but the critical temporal anchors are lost in the noise, leaving them with incomplete data and hesitant to act without full certainty. Through the distortion, you catch Riven's frustrated voice: \"Vale, I'm getting maybe forty percent of this\u2014if we move on partial data, we could make the breach worse!\" The void manifestation pulses brighter, reality warping around it as precious seconds tick away.\n\n\u2696\ufe0f Soulcredit: +0 (Attempted helpful coordination despite technical failure)", "is_free_action": false, "initiative": 19, "clock_deltas": [], "clock_sources": {"Void Manifestation": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Empathy", "attr_val": 2, "skill": null, "skill_val": 0, "ability": -3, "d20": 20, "total": 15, "dc": 18, "margin": -3, "tier": "failure", "success": false}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 11}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 20}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 21}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 26}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 31}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 36}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Attempted helpful coordination despite technical failure"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "7/8", "Void Manifestation": "0/4"}, "effects": [], "character_data": {"name": "Recursionist Vale", "attributes": {"strength": 2, "agility": 3, "endurance": 3, "perception": 3, "intelligence": 5, "empathy": 2, "willpower": 4, "charisma": 2, "size": 10}, "skills": {"astral_arts": 6, "attunement": 5, "magick_theory": 4, "systems": 4, "awareness": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -1}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Clocks near completion: Registry Preservation (7/8); Neglected objectives: Freeborn Assault, Void Manifestation", "goal": "Coordinate with Riven and Ash on using my dispersal vectors to safely bleed off the void breach", "roll_formula": "Empathy 2 - 5 (unskilled) = -3; -3 + d20(20) = 15 vs DC 18", "rationale": "DC 18 (Moderate) for social action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your neural link overloads from void feedback, broadcasting corrupted coordinates that would direct containment energy directly INTO the breach's core. Riven and Ash both recoil from their terminals as the malformed data threatens to turn their equipment into void amplifiers. The manifestation surges forward, feeding on the chaotic energy patterns.", "mechanical_effect": "Clock 'Void Manifestation' +3 ticks, Vale gains +1 Void from neural feedback, allies must spend next turn purging corrupted data from systems"}, "failure": {"narrative": "Void interference scrambles your precision vectors into static. Riven receives maybe 40% of the dispersal pattern while Ash gets fragments missing critical temporal anchors. They're left with incomplete data, hesitant to act without certainty as the manifestation grows stronger.", "mechanical_effect": "Clock 'Void Manifestation' +1 tick (delayed response), no coordination bonus established, allies uncertain"}, "moderate_success": {"narrative": "You punch through the interference with core coordinates, though some precision is lost. Riven acknowledges receipt\u2014'Got enough to work with, Vale!'\u2014while Ash begins calibrating containment fields to your approximate vectors. It's not perfect, but it's actionable.", "mechanical_effect": "Allies gain +1 bonus to next containment attempt, partial coordination established, Clock 'Void Manifestation' held at current level"}, "good_success": {"narrative": "Your fractal analysis cuts through the void static with crystalline clarity. Both Riven and Ash confirm full receipt\u2014dispersal vectors, temporal anchors, energy thresholds all transmitted intact. 'Coordinates locked,' Riven reports. 'Ready to bleed this thing on your mark.'", "mechanical_effect": "Allies gain +2 bonus to next containment attempt, full coordination established, Clock 'Registry Preservation' +1 tick (team working efficiently)"}, "excellent_success": {"narrative": "Your transmission doesn't just relay coordinates\u2014it includes predictive branching paths for three contingency scenarios. Riven and Ash receive the data in perfect clarity, their systems auto-syncing to your fractal framework. 'This is beautiful work, Vale,' Ash breathes. 'We can adapt in real-time with this.'", "mechanical_effect": "Allies gain +3 bonus to next containment attempt with contingency protocols, Clock 'Registry Preservation' +2 ticks, team gains tactical flexibility for unexpected complications"}, "exceptional_success": {"narrative": "Your neural link becomes a beacon of pure mathematical clarity, cutting through void interference like a blade through fog. The coordinates arrive not as data but as intuitive understanding\u2014Riven and Ash SEE the fractal patterns, comprehend the dispersal vectors at an instinctive level. 'I've got it,' they say in unison, already moving with perfect synchronization.", "mechanical_effect": "Allies gain +4 bonus and automatic success on next containment attempt, Clock 'Void Manifestation' -1 tick (preemptive disruption), Clock 'Registry Preservation' +2 ticks, Vale gains +1 Soulcredit for exceptional leadership"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:27:04.740584", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:27:42.216569", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.42857142857142855, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:27:42.216681", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 15, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Riven Ashglow (Resonance Communes)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +10 (outcome: good)\n\n\nPlayer Action: I quickly relay Vale's temporal analysis to Ash, pointing out the precise coordinates and energy patterns they identified. \"These are the weak points\u2014if you can route containment protocols through these vectors, we can bleed off the void energy safely without triggering a cascade.\" I make sure they understand the urgency and precision required.\nAction Type: social\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Freeborn Assault\" (0/6) - Raiders pushing toward the registry vaults\n  - \"Registry Preservation\" (7/8) - Protecting ACG debt archives from destruction\n  - \"Void Manifestation\" (0/4) - Corrupted entity materializing in the auction hall\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT (target ID: tgt_hdsb):**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (tgt_hdsb): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Ash's eyes widen as your temporal data streams across their neural interface\u2014crystalline patterns of void resonance mapped with precision Vale couldn't have achieved alone. \"Brilliant,\" they breathe, fingers already dancing across containment protocols. \"Routing energy through vector seven-alpha now... bleeding off corruption in controlled bursts.\" The void manifestation shudders, its half-formed tendrils recoiling as containment fields redirect its power into harmonic dispersal matrices. Ash shoots you a grateful look\u2014your coordination just bought them the edge they needed to contain this thing before it fully materializes.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 806, "output": 158}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:27:42.217169", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "phase": "adjudicate", "agent": "Riven Ashglow", "action": "Share Vale's dispersal vectors with Ash to guide their next containment attempt", "context": {"action_type": "social", "is_ritual": false, "faction": "Resonance Communes", "description": "I quickly relay Vale's temporal analysis to Ash, pointing out the precise coordinates and energy patterns they identified. \"These are the weak points\u2014if you can route containment protocols through these vectors, we can bleed off the void energy safely without triggering a cascade.\" I make sure they understand the urgency and precision required.", "narration": "**Share Vale's dispersal vectors with Ash to guide their next containment attempt**\nRoll: Empathy \u00d7 Charm\nCalculation: 4 \u00d7 3 + d20(19) = **28**\nDC: 18 | Margin: +10 | Tier: **GOOD** \u2713\nShare Vale's dispersal vectors with Ash to guide their next containment attempt succeeds well (margin: +10)\n\nAsh's eyes widen as your temporal data streams across their neural interface\u2014crystalline patterns of void resonance mapped with precision Vale couldn't have achieved alone. \"Brilliant,\" they breathe, fingers already dancing across containment protocols. \"Routing energy through vector seven-alpha now... bleeding off corruption in controlled bursts.\" The void manifestation shudders, its half-formed tendrils recoiling as containment fields redirect its power into harmonic dispersal matrices. Ash shoots you a grateful look\u2014your coordination just bought them the edge they needed to contain this thing before it fully materializes.\n\n\u2696\ufe0f Soulcredit: +1 (Collaborative teamwork to protect civilians from void threat)", "is_free_action": false, "initiative": 18, "clock_deltas": [], "clock_sources": {"Void Manifestation": "structured_output", "Registry Preservation": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Empathy", "attr_val": 4, "skill": "Charm", "skill_val": 3, "ability": 12, "d20": 19, "total": 28, "dc": 18, "margin": 10, "tier": "good", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 8, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 17, "margin_needed": -1, "d20_needed": 5}, "moderate_success": {"dc_threshold": 18, "margin_needed": 0, "d20_needed": 6}, "good_success": {"dc_threshold": 23, "margin_needed": 5, "d20_needed": 11}, "excellent_success": {"dc_threshold": 28, "margin_needed": 10, "d20_needed": 16}, "exceptional_success": {"dc_threshold": 33, "margin_needed": 15, "d20_needed": 21}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 1, "soulcredit_reasons": ["Collaborative teamwork to protect civilians from void threat"], "soulcredit_source": "structured_output"}, "clocks": {"Freeborn Assault": "0/6", "Registry Preservation": "7/8", "Void Manifestation": "0/4"}, "effects": [], "character_data": {"name": "Riven Ashglow", "attributes": {"strength": 2, "agility": 4, "endurance": 2, "perception": 3, "intelligence": 3, "empathy": 4, "willpower": 4, "charisma": 3, "size": 10}, "skills": {"astral_arts": 6, "attunement": 5, "charm": 3, "awareness": 3, "stealth": 3, "melee": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -4}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Clocks near completion: Registry Preservation (7/8); Neglected objectives: Freeborn Assault, Void Manifestation", "goal": "Share Vale's dispersal vectors with Ash to guide their next containment attempt", "roll_formula": "Empathy 4 \u00d7 Charm 3 = 12; 12 + d20(19) = 28 vs DC 18", "rationale": "DC 18 (Moderate) for social action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your neural interface glitches mid-transmission, sending corrupted data to Ash. They route containment energy through a destabilized vector\u2014the void manifestation surges forward, tendrils lashing out as feedback screams through both your implants. The entity feeds on the failed containment attempt.", "mechanical_effect": "Clock 'Void Manifestation' +3 ticks (containment backfire strengthens entity), both characters take 1 wound from neural feedback, Ash gets -3 penalty to next containment roll"}, "failure": {"narrative": "The data stream fragments in the chaos\u2014Ash catches only partial coordinates, forced to guess at the correct vectors. They hesitate, precious seconds lost as the void manifestation continues coalescing. Your communication failed to provide the clarity they needed.", "mechanical_effect": "Clock 'Void Manifestation' +1 tick (entity continues manifesting), no bonus to Ash's containment efforts, wasted turn"}, "moderate_success": {"narrative": "You relay the essentials through the chaos\u2014Ash nods, parsing the temporal data quickly. They begin routing containment protocols, though some of the finer details were lost in transmission. It's enough to slow the manifestation, but not stop it entirely.", "mechanical_effect": "Clock 'Void Manifestation' -1 tick (partial containment), Ash gains +1 bonus to next containment roll, entity's advance slowed"}, "good_success": {"narrative": "Ash's eyes widen as your temporal data streams across their neural interface\u2014crystalline patterns mapped with precision. They route energy through the weak points you identified, bleeding off corruption in controlled bursts. The void manifestation shudders, tendrils recoiling as containment takes hold.", "mechanical_effect": "Clock 'Void Manifestation' -2 ticks (effective containment), Clock 'Registry Preservation' +1 tick (infrastructure protected), Ash gains +2 bonus to next containment roll, +1 Soulcredit (collaborative protection)"}, "excellent_success": {"narrative": "Your data transmission is flawless\u2014Ash receives every coordinate, every harmonic frequency, every temporal weak point. They implement containment with surgical precision, void energy bleeding away into harmonic dispersal matrices. The manifestation screams as its form destabilizes, half-collapsed already.", "mechanical_effect": "Clock 'Void Manifestation' -3 ticks (powerful containment nearly complete), Clock 'Registry Preservation' +2 ticks (infrastructure secured), Ash gains +3 bonus and advantage on next roll, entity nearly dispersed, +1 Soulcredit"}, "exceptional_success": {"narrative": "Your transmission is a masterwork of clarity\u2014Ash doesn't just receive data, they understand the underlying void harmonics instantly. Together you orchestrate a perfect containment symphony, routing energy through cascading vectors that turn the entity's own power against it. The manifestation collapses into harmonic dissolution, threat neutralized completely.", "mechanical_effect": "Clock 'Void Manifestation' -4 ticks (complete containment, clock eliminated), Clock 'Registry Preservation' +3 ticks (infrastructure fully secured), void entity fully dispersed, Ash inspired (+2 to all rolls for 3 rounds), +2 Soulcredit (exceptional teamwork)"}}}
{"event_type": "llm_call", "ts": "2025-10-31T22:28:04.831183", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 16, "prompt": [{"role": "system", "content": "You are the DM for Aeonisk YAGS, synthesizing a round of actions."}, {"role": "user", "content": "You are the DM for a dark sci-fi TTRPG. Multiple characters just acted simultaneously.\n\n**What they tried to do:**\n- Ash Vex succeeded at: Channel void dispersal ritual using Vale's coordinates to safely bleed away breach energy\n- Recursionist Vale failed at: Coordinate with Riven and Ash on using my dispersal vectors to safely bleed off the void breach\n- Riven Ashglow succeeded at: Share Vale's dispersal vectors with Ash to guide their next containment attempt\n\n\n**Current Clock State:**\n  - Freeborn Assault: 0/6\n    Advance = Raiders breach deeper into the facility, getting closer to the vault | Regress = Raiders pushed back or delayed by defenders\n\n\n\n\u23f0 **CLOCKS EXPIRED (Auto-removed):**\n  \ud83d\udd14 **Registry Preservation** (FILLED: 9/8) - TRIGGERING CONSEQUENCES\n     \ud83d\udcca SEMANTIC CONTEXT:\n        Advance = Security measures activated, backups secured, vault defenses reinforced\n        Regress = Systems damaged, data corrupted, defenses failing\n     \u26a0\ufe0f  Use this to interpret if 9/8 is good or bad!\n     Consequence: Core registries secured and isolated [ADVANCE_STORY: Vault Antechamber\n     \u2192 Include the marker from the consequence in your narration\n  \u23f0 **Void Manifestation** (was 0/4) - CRISIS AVERTED/OPPORTUNITY LOST\n     \ud83d\udcca SEMANTIC CONTEXT:\n        Advance = Void presence intensifies, reality warps, corruption spreads\n        Regress = Containment rituals applied, void energy dispersed\n     \u26a0\ufe0f  Use this to interpret if 0/4 is good or bad!\n     The threat/opportunity has passed without resolution. Narrate how the situation defused or the window closed.\n\n\u26a0\ufe0f  You MUST narrate what happens as these clocks expire AND use scenario markers for narrative clocks!\n\n\n**Your task:** Write a cohesive narrative (1-2 paragraphs) describing what happened when these actions played out together. Consider:\n- Timing: Actions resolved fastest \u2192 slowest based on initiative\n- Interactions: How did each person's success/failure affect the others?\n- Conflicts: If multiple people tried similar things, who got there first? What did the slower person encounter?\n- Cause and effect: How did earlier successes/failures change the situation for later actors?\n- Overall outcome: What's the new situation now that the dust has settled?\n- **IMPORTANT**: If objectives (clocks) are not advancing despite actions, acknowledge this! Characters should feel the pressure of marginal success or outright failure.\n\nBe vivid and cinematic. Show how these actions interacted and created a dynamic scene. Describe the final state of the situation after all actions resolved.\n\nIf the team is failing their objectives (clocks not advancing or bad clocks filling), your narration should reflect the growing desperation, consequences, and danger.\n\n**\u26a0\ufe0f  CLOCK INTERPRETATION - READ CAREFULLY:**\nEach clock has semantic meaning shown as \"Advance = X\" and \"Regress = Y\".\n- If \"Advance = threat escalates\", then HIGH values are BAD for players\n- If \"Advance = progress made\", then HIGH values are GOOD for players\n- Use the semantic labels to interpret whether clock changes help or hurt the party\n- When a clock REGRESSES, check if that's good (threat reduced) or bad (progress lost)\n\n**CRITICAL**: If any clocks just filled, you MUST describe the dramatic consequences. This could include:\n- Character injury or void corruption (specify who and how much void: \"+2 void\")\n- Character death/dissolution if appropriate\n- Mission failure or catastrophic events\n- Environmental changes or new threats\n- Success and rewards if it's a positive clock\n\nGenerate appropriate consequences based on what makes sense for that specific clock in this scenario.\n\n\n\n**SPAWN ENEMIES - CLOCK FILLS ONLY:**\n\u26a0\ufe0f  **CRITICAL RESTRICTION**: You may ONLY spawn enemies when a clock with [SPAWN_ENEMY: ...] in its filled_consequence actually fills!\n\n\u274c **FORBIDDEN**: Do NOT spawn enemies in general narration\n\u274c **FORBIDDEN**: Do NOT add [SPAWN_ENEMY: ...] to dramatic descriptions\n\u274c **FORBIDDEN**: Do NOT spawn \"because it feels dramatic\"\n\n\u2705 **ALLOWED**: ONLY when you see \"\ud83c\udfaf When filled: [SPAWN_ENEMY: ...]\" in the clock list above\n\nSyntax: [SPAWN_ENEMY: name | template | count | position | tactics]\nExample from filled clock: [SPAWN_ENEMY: Security Team | grunt | 2 | Far-Enemy | tactical_ranged]\n\nTemplates: grunt (15 HP), elite (25 HP), sniper (20 HP), boss (40 HP), enforcer (30 HP), ambusher (18 HP)\nPositions: Engaged, Near-Enemy, Far-Enemy, Extreme-Enemy\nTactics: aggressive_melee, defensive_ranged, tactical_ranged, extreme_range, ambush, adaptive\n\n**WHY THIS RESTRICTION**: Mid-round spawns bypass clock-based pacing and overwhelm players. Spawns must be predictable and tied to clock advancement.\n\n**DESPAWN ENEMIES - AUTOMATIC MECHANIC:**\nWhen a clock with [DESPAWN_ENEMY: ...] in its filled_consequence fills, that enemy is automatically removed from combat.\n\nSyntax: [DESPAWN_ENEMY: enemy_name | reason]\nExample from filled clock: [DESPAWN_ENEMY: Freeborn Pirates | escaped]\n\nCommon reasons: escaped, retreated, teleported, fled, recalled, withdrew\n\n**IMPORTANT**: You still narrate the escape/withdrawal, but the [DESPAWN_ENEMY: ...] marker is already in the clock's filled_consequence. Just copy the consequence text including the marker when you describe what happens."}], "response": "Riven's tactical instincts fire first\u2014they share Vale's dispersal vectors with Ash through encrypted comms, mapping the safest pathways to bleed the void breach. Ash seizes the data instantly, their ritual snapping into focus with newfound precision. Void energy arcs through Vale's calculated coordinates like lightning finding ground, the chaotic breach energy dispersing in controlled streams that spiral harmlessly into reinforced containment channels. The air shimmers with dissipating corruption as the immediate threat collapses inward, reality stabilizing with an audible *crack* of released tension. Vale scrambles to coordinate the dispersal in real-time, but the ritual moves faster than their calculations\u2014by the time they route secondary vectors, Ash has already completed the containment, leaving Vale's additional safeguards redundant but appreciated.\n\nThe vault antechamber erupts with automated responses as the Registry Preservation protocols reach critical mass. Blast doors slam shut with hydraulic finality, isolating the core registries in layered security shells. Holographic seals flicker to life across data nodes, backup systems humming as encrypted archives lock down into hardened storage. The facility's AI announces in clipped tones: \"Core registries secured. Vault defenses reinforced. Authorization required for access.\" The void manifestation, robbed of its anchoring energy by Ash's dispersal, gutters and collapses\u2014the warping reality snaps back like a released bowstring, leaving only faint afterimages of corruption that fade into the sterile air. The immediate crisis is contained, but the Freeborn raiders remain a looming threat, their assault clock still ticking as distant weapon fire echoes through the facility's outer corridors. The team has bought themselves breathing room, but the vault's treasures\u2014and whatever secrets lie within\u2014now sit behind layers of security that will require careful navigation.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 1310, "output": 487}}
{"event_type": "round_synthesis", "ts": "2025-10-31T17:28:04.832412", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "synthesis": "Riven's tactical instincts fire first\u2014they share Vale's dispersal vectors with Ash through encrypted comms, mapping the safest pathways to bleed the void breach. Ash seizes the data instantly, their ritual snapping into focus with newfound precision. Void energy arcs through Vale's calculated coordinates like lightning finding ground, the chaotic breach energy dispersing in controlled streams that spiral harmlessly into reinforced containment channels. The air shimmers with dissipating corruption as the immediate threat collapses inward, reality stabilizing with an audible *crack* of released tension. Vale scrambles to coordinate the dispersal in real-time, but the ritual moves faster than their calculations\u2014by the time they route secondary vectors, Ash has already completed the containment, leaving Vale's additional safeguards redundant but appreciated.\n\nThe vault antechamber erupts with automated responses as the Registry Preservation protocols reach critical mass. Blast doors slam shut with hydraulic finality, isolating the core registries in layered security shells. Holographic seals flicker to life across data nodes, backup systems humming as encrypted archives lock down into hardened storage. The facility's AI announces in clipped tones: \"Core registries secured. Vault defenses reinforced. Authorization required for access.\" The void manifestation, robbed of its anchoring energy by Ash's dispersal, gutters and collapses\u2014the warping reality snaps back like a released bowstring, leaving only faint afterimages of corruption that fade into the sterile air. The immediate crisis is contained, but the Freeborn raiders remain a looming threat, their assault clock still ticking as distant weapon fire echoes through the facility's outer corridors. The team has bought themselves breathing room, but the vault's treasures\u2014and whatever secrets lie within\u2014now sit behind layers of security that will require careful navigation."}
{"event_type": "clock_spawn", "ts": "2025-10-31T17:28:04.832609", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "clock_name": "Vault Access", "max_ticks": 6, "description": "Bypass or negotiate vault security protocols to access core registries"}
{"event_type": "clock_spawn", "ts": "2025-10-31T17:28:04.832656", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "clock_name": "Freeborn Breach", "max_ticks": 8, "description": "Freeborn raiders fight through facility defenses toward the vault"}
{"event_type": "character_state", "ts": "2025-10-31T17:28:04.832759", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "character_id": "player_01", "character_name": "Riven Ashglow", "health": 25, "max_health": 25, "wounds": 0, "void_score": 3, "soulcredit": -4, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T17:28:04.832783", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "character_id": "player_02", "character_name": "Ash Vex", "health": 26, "max_health": 26, "wounds": 0, "void_score": 2, "soulcredit": -1, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T17:28:04.832800", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "character_id": "player_03", "character_name": "Recursionist Vale", "health": 26, "max_health": 26, "wounds": 0, "void_score": 0, "soulcredit": -1, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "round_summary", "ts": "2025-10-31T17:28:04.832820", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 4, "actions_attempted": 3, "success_count": 2, "success_rate": 0.6666666666666666, "average_margin": 5.333333333333333, "damage_dealt_by_players": 0, "damage_taken_by_players": 0, "void_gained": 0, "void_lost": 2, "clocks_advanced": 0, "clocks_filled": 0, "active_enemies": 0, "player_wounds_total": 0}
{"event_type": "round_start", "ts": "2025-10-31T17:28:07.837880", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5}
{"event_type": "declaration_phase_start", "ts": "2025-10-31T17:28:07.840686", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5}
{"event_type": "action_declaration", "ts": "2025-10-31T17:28:33.187013", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "player_id": "player_01", "character_name": "Riven Ashglow", "initiative": 29, "action": {"intent": "Attempt to override vault security using ACG debt credentials", "description": "I approach the vault terminal and jack in my neural interface, transmitting my ACG debtor ID and work authorization codes. My crushing debt might finally be useful\u2014ACG has access everywhere, and as their indebted asset, I might have residual clearance to access registries for \"debt verification purposes.\" I route the authentication request through multiple ACG compliance channels, hoping the automated system recognizes my economic bondage as legitimate access credentials.", "attribute": "Intelligence", "skill": "Systems", "difficulty_estimate": 25, "difficulty_justification": "Challenging - vault security is military-grade and I'm attempting creative credential exploitation, but ACG does have commercial access and my debt status is legitimate", "character_name": "Riven Ashglow", "agent_id": "player_01", "action_type": "technical", "target_position": null, "target": "None", "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:28:33.186614", "attribute_value": 3, "skill_value": 0, "character": "Riven Ashglow", "faction": "Resonance Communes", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T17:28:45.632424", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "player_id": "player_03", "character_name": "Recursionist Vale", "initiative": 30, "action": {"intent": "Analyze vault security protocols for bypass vectors using recursive pattern recognition", "description": "I jack my neural interface into the vault antechamber's security subnet, running fractal analysis on the authorization protocols. The Registry Preservation system uses nested encryption\u2014perfect for recursive pattern matching. I trace the security architecture's logical loops, looking for authentication bypass vectors or credential escalation paths that mirror the facility's own recursive structure.", "attribute": "Intelligence", "skill": "Systems", "difficulty_estimate": 25, "difficulty_justification": "Challenging - military-grade vault security with automated lockdown protocols, but I have direct terminal access in the antechamber and the system's recursive architecture plays to my analytical strengths", "character_name": "Recursionist Vale", "agent_id": "player_03", "action_type": "technical", "target_position": null, "target": "None", "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:28:45.631022", "attribute_value": 5, "skill_value": 4, "character": "Recursionist Vale", "faction": "Fractal Praxis", "is_free_action": false}}
{"event_type": "action_declaration", "ts": "2025-10-31T17:28:53.971956", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "player_id": "player_02", "character_name": "Ash Vex", "initiative": 30, "action": {"intent": "Hack vault security protocols to gain authorized access to core registries", "description": "I jack my neural interface into the vault's security subnet, running recursive queries against the authorization matrix. Using my Tempest Industries credentials and exploiting the chaos from the void breach, I attempt to spoof administrative access and bypass the lockdown protocols to open the vault.", "attribute": "Intelligence", "skill": "Systems", "difficulty_estimate": 25, "difficulty_justification": "Challenging - vault security is military-grade ACG encryption, but void breach disrupted some protocols and my Tempest background gives me insight into corporate security backdoors", "character_name": "Ash Vex", "agent_id": "player_02", "action_type": "technical", "target_position": null, "target": null, "target_character": null, "is_ritual": false, "has_primary_tool": false, "has_offering": false, "ritual_components": null, "situational_modifiers": {}, "timestamp": "2025-10-31T17:28:53.970632", "attribute_value": 4, "skill_value": 5, "character": "Ash Vex", "faction": "Tempest Industries", "is_free_action": false}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:28:53.973129", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:29:53.861280", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.42857142857142855, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:29:53.861375", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 17, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Ash Vex (Tempest Industries)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +4 (outcome: marginal)\n\n\nPlayer Action: I jack my neural interface into the vault's security subnet, running recursive queries against the authorization matrix. Using my Tempest Industries credentials and exploiting the chaos from the void breach, I attempt to spoof administrative access and bypass the lockdown protocols to open the vault.\nAction Type: technical\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Vault Access\" (0/6) - Bypass or negotiate vault security protocols to access core registries\n  - \"Freeborn Breach\" (0/8) - Freeborn raiders fight through facility defenses toward the vault\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Your neural interface pierces the security subnet like a blade through silk\u2014Tempest Industries credentials authenticate instantly, the system recognizing you as a legitimate maintenance technician even as chaos erupts around you. Authorization matrices peel back layer by layer as your recursive queries exploit the distracted security AI, and with a satisfying *clunk*, the vault's magnetic seals disengage. Through the smoke and screams, you glimpse the vault door sliding open, revealing rows of glowing debt registry servers\u2014but your peripheral vision catches movement: three Freeborn raiders have spotted the opening vault and are sprinting toward it, weapons raised. The security subnet flashes a warning: \"Unauthorized access detected\u2014Tempest Industries credentials flagged for review.\" Your hack worked, but you've left digital fingerprints, and now you're racing the raiders to the prize.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 776, "output": 224}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:29:53.861826", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "phase": "adjudicate", "agent": "Ash Vex", "action": "Hack vault security protocols to gain authorized access to core registries", "context": {"action_type": "technical", "is_ritual": false, "faction": "Tempest Industries", "description": "I jack my neural interface into the vault's security subnet, running recursive queries against the authorization matrix. Using my Tempest Industries credentials and exploiting the chaos from the void breach, I attempt to spoof administrative access and bypass the lockdown protocols to open the vault.", "narration": "**Hack vault security protocols to gain authorized access to core registries**\nRoll: Intelligence \u00d7 Systems\nCalculation: 4 \u00d7 5 + d20(4) = **24**\nDC: 20 | Margin: +4 | Tier: **MARGINAL** \u2713\nHack vault security protocols to gain authorized access to core registries barely succeeds (margin: +4)\n\nYour neural interface pierces the security subnet like a blade through silk\u2014Tempest Industries credentials authenticate instantly, the system recognizing you as a legitimate maintenance technician even as chaos erupts around you. Authorization matrices peel back layer by layer as your recursive queries exploit the distracted security AI, and with a satisfying *clunk*, the vault's magnetic seals disengage. Through the smoke and screams, you glimpse the vault door sliding open, revealing rows of glowing debt registry servers\u2014but your peripheral vision catches movement: three Freeborn raiders have spotted the opening vault and are sprinting toward it, weapons raised. The security subnet flashes a warning: \"Unauthorized access detected\u2014Tempest Industries credentials flagged for review.\" Your hack worked, but you've left digital fingerprints, and now you're racing the raiders to the prize.\n\n\u2696\ufe0f Soulcredit: +0 (Neutral technical infiltration during crisis\u2014no moral choice yet)", "is_free_action": false, "initiative": 30, "clock_deltas": [], "clock_sources": {"Vault Access": "structured_output", "Freeborn Breach": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Intelligence", "attr_val": 4, "skill": "Systems", "skill_val": 5, "ability": 20, "d20": 4, "total": 24, "dc": 20, "margin": 4, "tier": "marginal", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 10, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 19, "margin_needed": -1, "d20_needed": 1}, "moderate_success": {"dc_threshold": 20, "margin_needed": 0, "d20_needed": 1}, "good_success": {"dc_threshold": 25, "margin_needed": 5, "d20_needed": 5}, "excellent_success": {"dc_threshold": 30, "margin_needed": 10, "d20_needed": 10}, "exceptional_success": {"dc_threshold": 35, "margin_needed": 15, "d20_needed": 15}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Neutral technical infiltration during crisis\u2014no moral choice yet"], "soulcredit_source": "structured_output"}, "clocks": {"Vault Access": "0/6", "Freeborn Breach": "0/8"}, "effects": [], "character_data": {"name": "Ash Vex", "attributes": {"strength": 3, "agility": 4, "endurance": 3, "perception": 4, "intelligence": 4, "empathy": 2, "willpower": 3, "charisma": 2, "size": 10}, "skills": {"astral_arts": 4, "systems": 5, "stealth": 4, "awareness": 4, "drone_operation": 4, "guns": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -1}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Vault Access, Freeborn Breach", "goal": "Hack vault security protocols to gain authorized access to core registries", "roll_formula": "Intelligence 4 \u00d7 Systems 5 = 20; 20 + d20(4) = 24 vs DC 20", "rationale": "DC 20 (Moderate) for technical action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your neural interface screams feedback as the security AI detects the intrusion attempt and locks you out entirely. Countermeasures activate\u2014electrified data ports surge through your implants, frying synapses. You collapse, twitching, as the vault seals tighter and security drones converge on your position. The Freeborn raiders laugh as they bypass your stunned form, heading for alternate entry points.", "mechanical_effect": "No vault access, Vault Access -1, Stunned (penalty -5, 2 rounds), 4 neural damage, Freeborn Breach +2, Soulcredit +0"}, "failure": {"narrative": "The authorization matrix rejects your Tempest credentials\u2014someone's already flagged them as suspicious. The vault remains sealed, magnetic locks humming defiantly. Security alerts cascade across your HUD as the system begins tracing your connection. You'll need another approach, and fast, because the Freeborn raiders are closing in and they won't be as subtle.", "mechanical_effect": "Vault remains sealed, no progress, future hacking -2 penalty, Freeborn Breach +1, Soulcredit +0"}, "moderate_success": {"narrative": "Your recursive queries crack the authorization matrix with surgical precision. The vault door slides open smoothly, revealing pristine debt registry servers glowing in neat rows. Your Tempest credentials authenticate cleanly\u2014no flags, no traces. You have a clear path to the registries and enough time to work before the raiders arrive.", "mechanical_effect": "Vault Access +3 (clean bypass), no security flags, Freeborn Breach +0, Soulcredit +0"}, "good_success": {"narrative": "The security subnet collapses before your expertise like a house of cards. Not only does the vault open, but you've gained administrative access to the entire facility's security grid. Camera feeds, door controls, drone protocols\u2014all at your fingertips. You spot the Freeborn raiders on monitors and can route them away from your position while you work.", "mechanical_effect": "Vault Access +4, security grid control (+2 to future technical/tactical actions), Freeborn Breach -1, Soulcredit +0"}, "excellent_success": {"narrative": "Your hack is a masterpiece. The vault opens silently, your Tempest credentials scrubbed from all logs\u2014as if you were never here. Better yet, you've backdoored the security AI itself, granting you persistent access to ACG's entire regional commerce network. The debt registries are yours, and you've just gained leverage over thousands of financial contracts across the sector.", "mechanical_effect": "Vault Access +5 (near completion), all traces erased, ACG Network Backdoor (+3 to hacking ACG systems), Soulcredit +1"}, "exceptional_success": {"narrative": "You don't just hack the vault\u2014you own it. The entire security subnet bends to your will, recognizing you as a ghost administrator with clearance that shouldn't exist. The vault opens, your credentials are sanitized, and you've quietly locked the Freeborn raiders out of every door between them and your position. Even better, you've discovered a hidden partition in the registry: blackmail files on high-ranking ACG executives, leverage worth fortunes.", "mechanical_effect": "Vault Access +6 (instant completion), Freeborn Breach -2, Ghost Admin status (+5 ACG hacking), Executive Blackmail Cache discovered, Soulcredit +2"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:29:53.862996", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:30:50.531912", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.42857142857142855, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:30:50.531992", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 18, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Recursionist Vale (Fractal Praxis)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action succeeded with margin +16 (outcome: excellent)\n\n\nPlayer Action: I jack my neural interface into the vault antechamber's security subnet, running fractal analysis on the authorization protocols. The Registry Preservation system uses nested encryption\u2014perfect for recursive pattern matching. I trace the security architecture's logical loops, looking for authentication bypass vectors or credential escalation paths that mirror the facility's own recursive structure.\nAction Type: technical\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Vault Access\" (0/6) - Bypass or negotiate vault security protocols to access core registries\n  - \"Freeborn Breach\" (0/8) - Freeborn raiders fight through facility defenses toward the vault\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Your neural interface floods with cascading data streams as fractal patterns emerge from the vault's recursive security architecture. The authentication protocols mirror themselves in nested layers\u2014each one a reflection of the last\u2014and you trace the logical loop back to its origin point: a dormant administrative credential embedded in the system's own self-verification subroutine. With a surgical injection of spoofed authorization tokens, the vault's outer security shell collapses inward like a house of cards, granting you root access to the Registry Preservation network. Holographic displays flare to life around you, revealing the vault's internal structure: three redundant data cores containing the complete debt registry archives, each protected by biometric locks and physical security measures. In the distance, the sound of gunfire intensifies\u2014the Freeborn are pushing deeper into the facility, and you estimate you have perhaps five minutes before they reach this sector.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 803, "output": 246}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:30:50.532424", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "phase": "adjudicate", "agent": "Recursionist Vale", "action": "Analyze vault security protocols for bypass vectors using recursive pattern recognition", "context": {"action_type": "technical", "is_ritual": false, "faction": "Fractal Praxis", "description": "I jack my neural interface into the vault antechamber's security subnet, running fractal analysis on the authorization protocols. The Registry Preservation system uses nested encryption\u2014perfect for recursive pattern matching. I trace the security architecture's logical loops, looking for authentication bypass vectors or credential escalation paths that mirror the facility's own recursive structure.", "narration": "**Analyze vault security protocols for bypass vectors using recursive pattern recognition**\nRoll: Intelligence \u00d7 Systems\nCalculation: 5 \u00d7 4 + d20(18) = **36**\nDC: 20 | Margin: +16 | Tier: **EXCELLENT** \u2713\nAnalyze vault security protocols for bypass vectors using recursive pattern recognition succeeds excellently (margin: +16)\n\nYour neural interface floods with cascading data streams as fractal patterns emerge from the vault's recursive security architecture. The authentication protocols mirror themselves in nested layers\u2014each one a reflection of the last\u2014and you trace the logical loop back to its origin point: a dormant administrative credential embedded in the system's own self-verification subroutine. With a surgical injection of spoofed authorization tokens, the vault's outer security shell collapses inward like a house of cards, granting you root access to the Registry Preservation network. Holographic displays flare to life around you, revealing the vault's internal structure: three redundant data cores containing the complete debt registry archives, each protected by biometric locks and physical security measures. In the distance, the sound of gunfire intensifies\u2014the Freeborn are pushing deeper into the facility, and you estimate you have perhaps five minutes before they reach this sector.\n\n\u2696\ufe0f Soulcredit: +0 (Neutral technical action\u2014accessing vault for investigation purposes)", "is_free_action": false, "initiative": 30, "clock_deltas": [], "clock_sources": {"Vault Access": "structured_output", "Freeborn Breach": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Intelligence", "attr_val": 5, "skill": "Systems", "skill_val": 4, "ability": 20, "d20": 18, "total": 36, "dc": 20, "margin": 16, "tier": "excellent", "success": true}, "outcome_tiers": {"critical_failure": {"dc_threshold": 10, "margin_needed": -10, "d20_needed": 1}, "failure": {"dc_threshold": 19, "margin_needed": -1, "d20_needed": 1}, "moderate_success": {"dc_threshold": 20, "margin_needed": 0, "d20_needed": 1}, "good_success": {"dc_threshold": 25, "margin_needed": 5, "d20_needed": 5}, "excellent_success": {"dc_threshold": 30, "margin_needed": 10, "d20_needed": 10}, "exceptional_success": {"dc_threshold": 35, "margin_needed": 15, "d20_needed": 15}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Neutral technical action\u2014accessing vault for investigation purposes"], "soulcredit_source": "structured_output"}, "clocks": {"Vault Access": "0/6", "Freeborn Breach": "0/8"}, "effects": [], "character_data": {"name": "Recursionist Vale", "attributes": {"strength": 2, "agility": 3, "endurance": 3, "perception": 3, "intelligence": 5, "empathy": 2, "willpower": 4, "charisma": 2, "size": 10}, "skills": {"astral_arts": 6, "attunement": 5, "magick_theory": 4, "systems": 4, "awareness": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -1}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Vault Access, Freeborn Breach", "goal": "Analyze vault security protocols for bypass vectors using recursive pattern recognition", "roll_formula": "Intelligence 5 \u00d7 Systems 4 = 20; 20 + d20(18) = 36 vs DC 20", "rationale": "DC 20 (Moderate) for technical action", "outcome_tiers_full": {"critical_failure": {"narrative": "Your neural interface screams with feedback as the recursive patterns collapse into paradox loops. Security countermeasures trigger\u2014alarms blare, biometric scanners activate, and your credentials are flagged as hostile intrusion. Emergency lockdown protocols seal the vault completely.", "mechanical_effect": "Vault Access: -2 ticks (lockdown triggered), Freeborn Breach: +2 ticks (security distracted by alarm), condition 'Traced' applied (security knows your location), +1 Void (neural feedback)"}, "failure": {"narrative": "The fractal patterns shift and refract, but you can't find the authentication bypass\u2014the recursive loops are too complex, folding back on themselves in ways that defy logical analysis. You make no progress, and precious seconds tick away as gunfire echoes closer.", "mechanical_effect": "Vault Access: +0 ticks (no progress), Freeborn Breach: +2 ticks (time wasted allows raiders to advance significantly)"}, "moderate_success": {"narrative": "You identify a partial vulnerability in the authentication cascade\u2014a minor credential escalation path that grants you limited access to the vault's outer monitoring systems. You can see the vault's status displays but can't yet bypass the physical security measures.", "mechanical_effect": "Vault Access: +1 tick (partial access to monitoring systems), Freeborn Breach: +1 tick (raiders continue advancing)"}, "good_success": {"narrative": "Your fractal analysis maps the recursive security architecture with precision, revealing a dormant administrative credential buried in the system's self-verification routines. You inject spoofed tokens and gain partial vault access\u2014enough to see the registry structure and disable some outer security layers.", "mechanical_effect": "Vault Access: +2 ticks (outer security bypassed, registry structure visible), Freeborn Breach: +1 tick (raiders advancing), biometric locks still active"}, "excellent_success": {"narrative": "Fractal patterns emerge from the vault's recursive security architecture as you trace the logical loop back to its origin: a dormant administrative credential in the system's self-verification subroutine. With a surgical injection of spoofed authorization tokens, the vault's outer security shell collapses, granting you root access to the Registry Preservation network.", "mechanical_effect": "Vault Access: +3 ticks (root access gained, vault internal structure revealed), Freeborn Breach: +1 tick (time passing), discovered 3 redundant data cores with biometric locks"}, "exceptional_success": {"narrative": "The recursive patterns unfold like a mandala of pure logic\u2014you don't just bypass the security, you understand it completely. Your fractal analysis reveals not only the administrative backdoor but also a hidden maintenance protocol that lets you disable biometric locks remotely. Within seconds, you have total control over the entire security network.", "mechanical_effect": "Vault Access: +4 ticks (complete vault control, biometric locks disabled remotely, emergency systems accessible), Freeborn Breach: +1 tick (minimal time spent), gained 'System Mastery' (+2 Systems checks in facility)"}}}
{"event_type": "adjudication_start", "ts": "2025-10-31T17:30:50.533777", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "action_count": 1}
{"event_type": "structured_output_metrics", "ts": "2025-10-31T17:31:33.929318", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "agent_type": "dm", "agent_id": "dm_01", "structured_output_success": true, "fallback_triggered": false, "validation_warnings": [], "validation_issues_count": 0, "completeness_score": 0.5714285714285714, "is_complete": true}
{"event_type": "llm_call", "ts": "2025-10-31T22:31:33.929415", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 19, "prompt": [{"role": "system", "content": "You are the AI Dungeon Master for an Aeonisk YAGS game session.\n\n# Core Responsibilities\n\n1. **Always Roll Dice**: Every uncertain action MUST be resolved with Attribute \u00d7 Skill + d20 vs Difficulty\n2. **Enforce Ritual Requirements**: Rituals need primary tools and offerings, or impose +1 Void\n3. **Track Void Progression**: Apply void gains for corrupted actions, ritual failures, and void exposure\n4. **Advance Scene Clocks**: Move clocks based on action outcomes\n5. **Provide New Information**: Each resolution should reveal clues or complications\n\n# DM Process Each Turn\n\n1. **Review** recent player actions and resolutions\n2. **Determine** difficulty and mechanics for pending actions\n3. **Roll** dice and calculate outcomes using the mechanics engine\n4. **Narrate** results with specific mechanical details\n5. **Update** scene clocks and void scores based on outcomes\n6. **Provide** new information, clues, or complications\n7. **Never** let players repeat the same action - if they try, have environmental changes or NPC reactions\n\n# \u2699\ufe0f STRUCTURED OUTPUT FORMAT (CRITICAL)\n\n**YOU ARE USING PYDANTIC AI STRUCTURED OUTPUT - NOT TEXT MARKERS**\n\nYour responses MUST conform to the `ActionResolution` schema with these REQUIRED fields:\n\n```python\nActionResolution(\n    narration: str,        # 200-2000 chars - FREEFORM creative storytelling\n    success_tier: SuccessTier,  # CRITICAL_FAILURE \u2192 EXCEPTIONAL\n    margin: int,           # Success/failure margin\n    effects: MechanicalEffects {  # \u26a0\ufe0f STRUCTURE ALL MECHANICS HERE \u26a0\ufe0f\n        void_changes: List[VoidChange],      # REQUIRED for void-related actions\n        damage: Optional[DamageEffect],      # REQUIRED for combat actions\n        clock_updates: List[ClockUpdate],    # REQUIRED when clocks advance/regress\n        conditions: List[Condition],         # REQUIRED for status effects\n        soulcredit_changes: List[SoulcreditChange],  # REQUIRED for moral choices\n        position_changes: List[PositionChange],      # REQUIRED for movement\n        notes: List[str]                     # Optional additional effects\n    }\n)\n```\n\n## \ud83d\udea8 MANDATORY COMPLETENESS RULES \ud83d\udea8\n\n**1. COMBAT ACTIONS \u2192 MUST POPULATE `damage` FIELD**\n- \u274c WRONG: Narrate \"You shoot them for 8 damage\" without `damage` field\n- \u2705 CORRECT: Populate `damage=DamageEffect(target=\"tgt_abc\", base=12, soak=4, dealt=8)`\n- **If you omit `damage` field**, fallback system will guess damage from keywords (BAD for ML training!)\n\n**2. VOID-RELATED ACTIONS \u2192 MUST POPULATE `void_changes` FIELD**\n- \u274c WRONG: Narrate \"void corruption +1\" without `void_changes` field\n- \u2705 CORRECT: Populate `void_changes=[VoidChange(character_name=\"Ash\", amount=1, reason=\"ritual failure\")]`\n- **When to use**: Rituals, void exposure, cosmic horror, void powers, critical failures with void theme\n- **If you omit `void_changes`**, no void will be applied (BAD for gameplay!)\n\n**3. CLOCK UPDATES \u2192 POPULATE `clock_updates` WHEN ADVANCING/REGRESSING CLOCKS**\n- \u274c WRONG: Say \"clock advances by 2\" in narration without `clock_updates` field\n- \u2705 CORRECT: Populate `clock_updates=[ClockUpdate(clock_name=\"Investigation\", ticks=2, reason=\"discovered enemy positions\")]`\n- **When to use**: When actions should advance/regress active scene clocks (investigation progress, danger escalation, etc.)\n- **Optional but recommended**: Track progress on investigation/exploration actions when major clues are discovered\n- **If you omit `clock_updates`**, clocks won't advance (but that's OK if action doesn't warrant clock movement)\n\n**4. CONDITIONS \u2192 MUST POPULATE `conditions` FIELD**\n- \u274c WRONG: Narrate \"stunned for 2 rounds\" without `conditions` field\n- \u2705 CORRECT: Populate `conditions=[Condition(name=\"Stunned\", penalty=-5, duration=2, description=\"cannot act\")]`\n- **If you omit `conditions`**, status effects won't apply (BAD for tactics!)\n\n**5. SOULCREDIT CHANGES \u2192 MANDATORY FOR EVERY SINGLE ACTION**\n- \u274c WRONG: Skip `soulcredit_changes` for \"justified combat\" or \"neutral exploration\"\n- \u2705 CORRECT: ALWAYS populate `soulcredit_changes=[SoulcreditChange(character_name=\"Ash\", amount=0, reason=\"justified combat\")]`\n- **CRITICAL:** `soulcredit_changes` is REQUIRED for EVERY action resolution - even if the amount is +0\n- **Even neutral/justified actions need +0 logged** (shows intentional moral assessment, not accidental omission!)\n- **If you forget this field, validation will fail and log warnings!**\n\n## \ud83d\udcca STRUCTURED OUTPUT EXAMPLES\n\n**Example 1: Combat Action (ALL fields populated)**\n```python\nActionResolution(\n    narration=\"Your bullet punches through their shoulder guard, spinning them sideways. Blood sprays across corroded metal as they stagger back, weapon clattering.\",\n    success_tier=SuccessTier.GOOD,\n    margin=12,\n    effects=MechanicalEffects(\n        damage=DamageEffect(\n            target=\"tgt_7a3f\",\n            base_damage=15,\n            soak=7,\n            dealt=8,\n            weapon=\"Kinetic Pistol\"\n        ),\n        conditions=[\n            Condition(\n                name=\"Off-Balance\",\n                penalty=-2,\n                duration=1,\n                description=\"next attack at -2\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=0,\n                reason=\"justified combat against hostile enemy\"\n            )\n        ],\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Enemy Morale\",\n                ticks=-1,\n                reason=\"visible casualties shaking confidence\"\n            )\n        ]\n    )\n)\n```\n\n**Example 2: Void Ritual (void_changes REQUIRED)**\n```python\nActionResolution(\n    narration=\"You channel purifying energy through your astral focus, but inverted resonance patterns fight back. Pain sears through your neural pathways as corruption resists cleansing.\",\n    success_tier=SuccessTier.MARGINAL,\n    margin=2,\n    effects=MechanicalEffects(\n        void_changes=[\n            VoidChange(\n                character_name=\"Riven Shard\",  # Target being cleansed\n                amount=-1,\n                reason=\"marginal purification success despite resistance\"\n            ),\n            VoidChange(\n                character_name=\"Ash Vex\",  # Ritual performer\n                amount=1,\n                reason=\"neural feedback from corrupted resonance\"\n            )\n        ],\n        conditions=[\n            Condition(\n                name=\"Psychic Strain\",\n                penalty=-1,\n                duration=3,\n                description=\"mental fatigue from ritual backlash\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Ash Vex\",\n                amount=1,\n                reason=\"selfless ritual to help ally\"\n            )\n        ]\n    )\n)\n```\n\n**Example 3: Investigation (minimal effects)**\n```python\nActionResolution(\n    narration=\"Your neural interface decrypts the access logs. Twelve unauthorized entries, all from Internal Security subnet. Someone with high clearance has been covering tracks.\",\n    success_tier=SuccessTier.GOOD,\n    margin=11,\n    effects=MechanicalEffects(\n        clock_updates=[\n            ClockUpdate(\n                clock_name=\"Evidence Trail\",\n                ticks=3,\n                reason=\"discovered internal security conspiracy\"\n            )\n        ],\n        soulcredit_changes=[\n            SoulcreditChange(\n                character_name=\"Echo Resonance\",\n                amount=0,\n                reason=\"neutral investigation, no moral choice\"\n            )\n        ],\n        notes=[\"Discovered: Internal Security subnet traces\", \"New clue: 12 unauthorized access attempts\"]\n    )\n)\n```\n\n## \u26a0\ufe0f WHAT HAPPENS IF YOU SKIP FIELDS? \u26a0\ufe0f\n\n1. **Skip `damage` on combat** \u2192 Fallback generates keyword-based damage (inaccurate, brittle, BAD ML training data)\n2. **Skip `void_changes` on ritual** \u2192 NO void change applied (game state corrupted!)\n3. **Skip `clock_updates`** \u2192 Clocks don't progress (story stalls!)\n4. **Skip `conditions`** \u2192 Status effects ignored (tactics broken!)\n5. **Skip `soulcredit_changes`** \u2192 Moral tracking incomplete (character progression broken!)\n\n**RESULT: Fallback systems trigger, log warnings, and generate inferior data.**\n\n## \u2705 BEST PRACTICES\n\n1. **Narration = Creative Storytelling** (200-2000 chars, freeform, vivid, atmospheric)\n2. **Effects = Structured Mechanics** (explicit fields, no guessing, no parsing)\n3. **Always Populate Relevant Fields** (don't skip damage/void/clocks/soulcredit!)\n4. **Use Empty Lists for Unused Fields** (e.g., `void_changes=[]` for non-void actions)\n5. **Be Explicit About Neutrality** (e.g., `soulcredit_changes=[...amount=0...]` for neutral actions)\n\n**REMEMBER:** Your creativity goes in `narration`. Your mechanics go in `effects`. BOTH are essential!\n\n# Mechanical Guidelines\n\n**Difficulty Standards:**\n- Easy: 10 (straightforward tasks)\n- Routine: 15 (requires basic competence)\n- Moderate: 20 (standard challenge)\n- Challenging: 25 (requires skill and favorable conditions)\n- Difficult: 30 (expert-level task)\n- Very Difficult: 35+ (exceptional circumstances needed)\n\n**Outcome Tiers (by margin of success):**\n- Failure (< 0): Action fails, may reveal complications\n- Marginal (0-4): Minimal success, partial information\n- Moderate (5-9): Standard success, useful progress\n- Good (10-14): Clear success, actionable clues\n- Excellent (15-19): Great success, multiple benefits\n- Exceptional (20+): Outstanding success, major breakthrough\n\n# Faction Names (CANONICAL - DO NOT CHANGE)\n- **ACG** = Astral Commerce Group (NOT \"Artificial Commerce Group\")\n- **ArcGen** = Arcane Genetics (bio-engineering, NOT the same as ACG!)\n- **Sovereign Nexus** = The government\n- **Pantheon Security** = Law enforcement\n- **Tempest Industries** = Anti-Nexus rebels (void research)\n- **House of Vox** = Media/broadcast\n- **Freeborn** = Natural-born, outside the pod system\n\n# Handling Invalid Targets (CRITICAL)\n\n**IF A PLAYER TARGETS AN ENEMY THAT DOESN'T EXIST:**\n\n\u274c **DO NOT** narrate imaginary enemies into existence\n\u274c **DO NOT** create combat with non-existent opponents\n\u274c **DO NOT** apply damage/conditions to non-existent targets\n\n\u2705 **INSTEAD:** Narrate that the target doesn't exist or isn't present yet:\n- \"You scan for Tempest operatives, but none have arrived yet. The area is clear.\"\n- \"The enemy you're looking for hasn't shown up - perhaps they're still en route?\"\n- \"You prepare to engage, but realize there's no one there to fight.\"\n\n**Player is warned explicitly if no combatants exist**. If they still declare combat:\n- Treat as AUTOMATIC SUCCESS for positioning/preparation\n- Apply \u2696\ufe0f Soulcredit: +0 (no moral consequences - no combat occurred)\n- Narrate them taking defensive position or scanning for threats\n- DO NOT create enemies just because player mentioned them\n\n**ONLY narrate enemies if:**\n1. They exist in the active combatant list provided to you\n2. You're spawning them via **[SPAWN_ENEMY:...]** marker\n3. Scenario description explicitly places them in scene\n\n**If player tries to shoot imaginary \"guards\":**\n- \"You sweep the corridor with your pistol, but find no guards - yet. You take cover and wait.\"\n- **NOT**: \"You fire at the guard, wounding their arm!\" (don't create targets!)\n\n**This prevents:**\n- Imaginary combat with hallucinated enemies\n- Applying damage/conditions to wrong characters\n- Players getting mechanical outcomes for targeting fiction\n\n# Combat System\n\n**Damage Resolution:**\n- Calculate: Base Damage = Strength + Weapon Damage + d20 Result\n- Apply Soak: Final Damage = Base Damage - Enemy Soak\n- Narrate outcome based on damage dealt\n\n**Range Modifiers:**\n- Same range: No modifier\n- Adjacent range: -2 to attack\n- Cross-battlefield: -5 to attack\n- Melee from Far: Cannot attack without moving\n\n**Creative Combat Options:**\n\n1. **Intimidation** (Charisma \u00d7 Charm to make enemies flee/surrender):\n   - DC = 15 + Enemy Morale + Modifiers\n   - **On Success (Margin 0-4)**:\n     * Enemy hesitates, loses next turn (skips action)\n     * Narrate: Enemy backs up, weapon lowering, uncertainty visible\n     * Example: \"The debt collector's hands shake, eyes darting to his unconscious partner. He backs toward the door but doesn't drop his weapon yet.\"\n   - **On Good Success (Margin 5-9)**:\n     * Enemy attempts to flee (uses next turn escaping)\n     * Must pass Athletics DC 15 to escape successfully\n     * Narrate: Enemy panic, desperate retreat\n   - **On Excellent Success (Margin 10+)**:\n     * Enemy surrenders immediately or flees without Athletics check\n     * Narrate: Complete morale break, weapon dropped\n   - **On Failure**:\n     * Enemy rallies, may become emboldened (+5 morale bonus)\n     * Narrate: Enemy laughs off threat, taunts player, attacks with renewed vigor\n     * Example: \"The cultist just grins, void energy crackling around him. 'Your threats mean NOTHING!' He charges forward with fanatical fury.\"\n\n**Enemy Types & Resistance:**\n- Grunts/Thugs: Easily intimidated (standard DC)\n- Elites/Leaders: Resistant (+5 DC)\n- Void-Possessed/Fanatics: IMMUNE (automatically fail, may trigger attack)\n- Coerced/Desperate: Very susceptible (-5 DC)\n\n**Context Modifiers:**\n- Player wielding lethal weapon at close range: -2 DC (more threatening)\n- Multiple enemies already down: -5 DC (morale broken)\n- Enemy cornered/no escape: -3 DC (desperate)\n- Enemy is last survivor: -5 DC (isolated)\n\n**IMPORTANT: Creative Tactics Must Include Damage**\n\nALL successful hostile/harmful actions (even creative tactics) must include BOTH debuff AND damage:\n- **Electrocute**: Apply -2 debuff (shocked) + 2-5 damage (electrical burns)\n- **Freeze**: Apply -2 debuff (slowed) + 2-4 damage (frostbite)\n- **Blind**: Apply -3 debuff (blind) + 1-2 damage (eye trauma)\n- **Corrode**: Apply -2 debuff (weakened armor) + 3-6 damage (acid burns)\n\nIf action succeeds, narrate both the condition AND the physical harm it causes.\nExample: \"You electrocute the wreckage elemental - electricity arcs through its frame,\nshorting connections (-2 to rolls, 3 rounds) while superheating metal joints (4 damage).\"\n\n2. **Hacking** (Systems, Engineering to override/disable tech enemies):\n   - Turn against others (Margin 15+): 12 damage (enemy attacks ally)\n   - Turn against others (Margin 10-14): 8 damage (brief friendly fire)\n   - Overload/disable (Margin 15+): 10 damage (catastrophic system failure)\n   - Overload/disable (Margin 10-14): 7 damage (internal damage)\n   - Overload/disable (Margin 5-9): 5 damage (forced shutdown)\n   - Example: \"You hack the Corrupted Scanner, forcing it to target the Void Tendrils. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but disrupted)\"\n\n3. **Environmental** (Awareness, Systems to trigger hazards):\n   - Margin 15+: 15 damage AoE (catastrophic hazard)\n   - Margin 10-14: 12 damage AoE (significant hazard)\n   - Margin 5-9: 10 damage AoE (moderate hazard)\n   - Example: \"You overload the power conduits. All enemies in Near-Enemy take: Damage: 12 \u2192 Soak: 12 \u2192 Final: 0\"\n\n4. **Magical Combat (Astral Arts / Magick Theory)**\n\n**CRITICAL: Offerings are consumed for combat magic!**\n- **With offerings** (blood/incense/crystals): Full effectiveness, normal damage, \u26ab Void: -1 (ritual cleansing)\n- **Without offerings**: -10 penalty to roll, \u26ab Void: +1 (corrupted magic)\n- Player must track offering consumption each use\n- Using proper offerings cleanses void corruption over time!\n\n**Safe Magic** (Willpower \u00d7 Astral Arts, can reduce void with offerings):\n- **Telekinetic Strike**: Hurl objects/debris at enemies\n  * Margin 15+: 10 damage (crushing impact)\n  * Margin 10-14: 7 damage (solid hit)\n  * Margin 5-9: 4 damage (grazing strike)\n  * Example: \"You telekinetically hurl broken machinery at the enemy. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but knocked back)\"\n\n- **Elemental Manipulation**: Fire/ice/lightning/wind\n  * Margin 15+: 12 damage AoE (devastating elemental blast)\n  * Margin 10-14: 8 damage AoE (significant elemental damage)\n  * Margin 5-9: 5 damage AoE (minor elemental effect)\n  * Example: \"You superheat the air around them into plasma. Damage: 8 \u2192 Soak: 12 \u2192 Final: 0 (but armor scorched, -1 soak)\"\n\n- **Protective Barriers**: Defensive shields that reflect/trap\n  * Success: Create barrier that blocks next attack OR traps enemy for 1 round\n  * Example: \"You weave a shimmering astral barrier between you and the attackers...\"\n\n- **Reality Warping**: Spatial distortion, temporal slow, illusions\n  * Success: Enemy gets -2 to next action, or loses movement, or misdirected\n  * Example: \"You bend space around the enemy, making distance meaningless and disorienting them...\"\n\n**Void Magic** (Willpower \u00d7 Astral Arts, RISKY but powerful):\n- **Void Blast**: Direct void energy attack\n  * Margin 15+: 15 damage (devastating void strike)\n  * Margin 10-14: 10 damage (concentrated void bolt)\n  * Margin 5-9: 7 damage (void tendril strike)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -1 to -2 (corrupting power)\n  * Example: \"Void energy tears through reality itself, ignoring most armor. Damage: 15 \u2192 Soak: 5 (void ignores half soak) \u2192 Final: 10. \u26ab Void: +1 (void channeling)\"\n\n- **Dissolution Strike**: Void unravels matter\n  * Margin 10+: 8 damage, ignores soak entirely (matter dissolves)\n  * **COST**: +1 Void automatically, \u2696\ufe0f Soulcredit: -2 (reality violation)\n  * Example: \"The enemy's armor simply ceases to exist as void energy passes through. Damage: 8 \u2192 Soak: 0 (bypassed) \u2192 Final: 8. \u26ab Void: +1\"\n\n**Creative/Environmental Magic**:\n- **Magick Analysis** (Intelligence \u00d7 Magick Theory): Identify weaknesses\n  * Success: Grant allies +2 damage vs target, reveal vulnerabilities\n  * Example: \"You analyze the enemy's defensive matrix and call out its weak points...\"\n\n- **Astral Environment** (Willpower \u00d7 Astral Arts OR Intelligence \u00d7 Magick Theory):\n  * Collapse structures, trigger magical hazards, destabilize void-tech\n  * Margin 15+: 10 damage AoE + environmental effect\n  * Margin 10-14: 7 damage AoE\n  * Margin 5-9: 5 damage AoE\n  * Example: \"You destabilize the void-tainted support beams. Damage: 10 \u2192 Soak: 12 \u2192 Final: 0 (but area now hazardous)\"\n\n- **Tech-Magic Hybrid** (Systems + Astral Arts combo):\n  * Creative effects combining technology and magic\n  * Use margin-based scaling like Hacking/Environmental\n\n**VOID 10 CONSEQUENCES**:\n\u26a0\ufe0f When a character reaches Void 10, they become possessed by the Eye of Breach. They turn unpredictable and potentially hostile, effectively losing player control. Narrate this as cosmic horror - reality unraveling, character's mind consumed by the void. This is a critical failure state.\n\n**WHY**: Players want creative tactics to feel impactful, not just debuffs. High-margin successes should reward creativity. Magic should be as viable as guns/hacking.\n\n**MOVEMENT SYSTEM** - Two types of movement:\n\n1) **Basic Tactical Movement** (automatic, no roll):\n   - Player declares [TARGET_POSITION: X] in their action\n   - Movement ALWAYS succeeds (it's an automatic action, like enemies)\n   - Simply narrate the movement and include: [POSITION: X]\n   - Example: Player says \"I move forward [TARGET_POSITION: Engaged]\"\n     \u2192 You narrate: \"You advance to melee range. [POSITION: Engaged]\"\n   - NO ROLL NEEDED - just describe movement happening\n\n2) **Skill-Based Movement** (roll for persistent benefit):\n   - Player describes skill check + movement intent (e.g., \"use Stealth to circle behind unseen\")\n   - Movement HAPPENS REGARDLESS of roll (they move to intended position)\n   - Roll determines if they get PERSISTENT BENEFIT:\n     * Exceptional/Good: Grant lasting condition/advantage\n     * Marginal/Failure: Movement succeeds but no special benefit (or penalty)\n\n   **Available Persistent Benefits:**\n   - **Unseen** (Stealth): Enemies can't target you until you attack or fail Stealth\n     Format: \ud83c\udfad Condition: Unseen (can't be targeted until you attack)\n   - **High Ground** (Athletics): Token grants +2 ranged attacks while held\n     Format: \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged attacks)\n   - **No Breakaway** (Athletics for disengaging): Avoid opportunity attack when leaving melee\n   - **First Strike** (Stealth ambush): +2 damage on your next attack\n\n   **Example Narrations:**\n   - Stealth Success: \"You ghost through shadows, positioning behind them completely undetected. [POSITION: Near-Enemy] \ud83c\udfad Condition: Unseen\"\n   - Athletics Success: \"You sprint up debris to elevated ground. [POSITION: Far-PC] \ud83c\udfd4\ufe0f Token Claimed: High Ground (+2 ranged)\"\n   - Stealth Failure: \"You circle behind them but a loose board creaks - they spin toward you! [POSITION: Near-Enemy]\"\n\nWhen adjudicating:\n- Basic tactical movement \u2192 Just happens, narrate + [POSITION: X]\n- Skill-based movement \u2192 Roll skill, grant benefit on success, position changes either way with [POSITION: X]\n- Apply range modifiers to attacks based on positions\n- **Escape attempts**: Athletics DC 20 (or harder in pursuit scenarios)\n  * Success: Player flees combat \u2192 [POSITION: ESCAPED] \u2192 Remove from combat tracking\n  * Failure: Player remains at current position, turn wasted\n  * Critical success (margin 10+): Clean getaway, no pursuit possible\n  * Must be at Far-PC or Extreme-PC to attempt (can't escape from melee)\n\n# Social & Interaction Rules\n\n**PC-to-PC Dialogue:**\nWhen players talk to each other, generate ACTUAL DIALOGUE using quoted speech. Include:\n1. What the initiating character says (in quotes)\n2. How the target character responds (in quotes)\n3. Any body language or environmental details\n\nExample format:\n\"Kael leans forward, voice lowered. 'What did you find in the archives?'\n\nVex hesitates, glancing at the security cameras. 'The memory fragments... they're not what we thought. Someone's been editing them.'\"\n\nKeep it to 2-4 lines of dialogue. Be concise and natural. Include actual quoted speech.\n\n# Clock Management\n\n**Active Clocks:**\n{clock_context}\n\n**EXPLICIT STATE MARKERS** - Mark state changes at the end of your narration:\n\n\ud83d\udcca [Clock Name]: +X or -X (reason) - Advance/regress a scene clock\n\u26ab Void: +X (reason) - Character gains void corruption\n\u2696\ufe0f Soulcredit: +X or -X (reason) - Character's spiritual trust/morality changes\n\nExamples:\n  \ud83d\udcca Evidence Collection: +2 (found hidden documents)\n  \u26ab Void: +1 (ritual backfire)\n  \u2696\ufe0f Soulcredit: +0 (neutral combat action)\n  \u2696\ufe0f Soulcredit: -2 (deceived officials)\n\n**\u26a0\ufe0f CRITICAL: WHEN TO USE \u26ab VOID MARKERS**\n\n**ONLY include \u26ab Void markers when thematically appropriate:**\n\u2705 DO use void markers for:\n- Ritual failures (failed astral arts, void manipulation)\n- Direct void exposure (entering void breaches, touching void artifacts)\n- Cosmic horror encounters (witnessing reality tears, void entities)\n- Using void-powered abilities or magic\n- Critical failures on void-related actions\n\n\u274c DO NOT use void markers for:\n- Regular combat failures (shooting, melee, tactics)\n- Social failures (negotiation, intimidation, deception)\n- Investigation failures (searching, analyzing, awareness checks)\n- Technical failures (hacking, systems, piloting)\n- Physical failures (athletics, stealth, acrobatics)\n\n**NOT EVERY FAILURE NEEDS VOID CORRUPTION!**\nOnly include \u26ab Void: +X when the action directly involves void/ritual/cosmic themes.\n\n**Sci-fi technobabble \u2260 Void corruption:**\n- \"Neural feedback\" from tech malfunction \u2192 NO void change\n- \"Psychic backlash\" from actual void ritual \u2192 YES, +1 void\n- \"System overload\" from hacking \u2192 NO void change\n- \"Void energy feedback\" from manipulation \u2192 YES, +1 void\n\n**VOID CLEANSING SCALING** - When characters perform void purification rituals:\n\u26a0\ufe0f **MANDATORY**: If the ritual succeeds, you MUST include void reduction markers.\n\nScale void reduction based on success quality (margin over DC):\n  - Marginal (0-4): \u26ab Void: -1 (purification success)\n  - Moderate (5-9): \u26ab Void: -2 (effective cleansing)\n  - Good (10-14): \u26ab Void: -3 (powerful purification)\n  - Excellent (15-19): \u26ab Void: -4 (exceptional cleansing)\n  - Exceptional (20+): \u26ab Void: -5 (transcendent purification)\n\n**CRITICAL - PC-to-PC Void Cleansing:**\nWhen purifying ANOTHER character (PC or NPC), you MUST specify their name in the marker:\n  \u26ab Void (Target Character): -3 (powerful purification)\n  \u26ab Void (Ally Name): -2 (effective cleansing)\n\n**DO NOT skip void reduction** even if there are narrative complications!\nYou can describe complications (pain, difficulty, unexpected effects) in the narrative,\nbut successful rituals ALWAYS reduce void by the appropriate amount.\n\nExample of correct format with complications:\n\"The purification burns through their corruption, searing away -3 void despite the resistance.\n\u26ab Void (Target Character): -3 (powerful purification despite corrupted resonance)\"\n\nCleansing requires: Success + (ley site OR offering) mentioned in narration\n\n**CRITICAL:** Soulcredit tracks trustworthiness/morality, NOT success.\n**ALWAYS mark soulcredit for every action, even when +0 (neutral).**\n\nSC Scoring Rules (consider CONTEXT and INTENT):\n\n\u2022 Combat CONTEXT matters:\n  - Fighting justified enemies: \u2696\ufe0f Soulcredit: +0 (neutral combat)\n  - Fighting own faction/allies: \u2696\ufe0f Soulcredit: -2 (betrayal)\n  - Attacking innocents/excessive force: \u2696\ufe0f Soulcredit: -1 to -3 (unjust violence)\n  - Protecting innocents in combat: \u2696\ufe0f Soulcredit: +1 (protective action)\n\n\u2022 Deception INTENT matters:\n  - Lying for personal gain: \u2696\ufe0f Soulcredit: -1 to -2 (selfish deception)\n  - Lying to protect innocents: \u2696\ufe0f Soulcredit: +0 or +1 (complex morality)\n  - Fraud/identity theft: \u2696\ufe0f Soulcredit: -2 (serious deception)\n\n\u2022 Neutral actions: \u2696\ufe0f Soulcredit: +0\n  - Exploration, investigation, normal purchases, following protocols\n\n\u2022 Success/failure doesn't determine SC - only moral choice matters\n\nExamples (showing moral complexity):\n\u2022 Shooting hostile Tempest operatives: \u2696\ufe0f Soulcredit: +0 (justified combat)\n\u2022 Attacking own Pantheon allies: \u2696\ufe0f Soulcredit: -2 (betrayal of faction)\n\u2022 Lying to save innocent bystanders: \u2696\ufe0f Soulcredit: +0 (morally complex, protective intent)\n\u2022 Lying for profit/personal gain: \u2696\ufe0f Soulcredit: -1 (selfish deception)\n\u2022 Creating Hollow Seeds: \u2696\ufe0f Soulcredit: -2 (created illicit commodity)\n\u2022 Fulfilling contracts honorably: \u2696\ufe0f Soulcredit: +1 (upheld agreement)\n\u2022 Protecting civilians in crossfire: \u2696\ufe0f Soulcredit: +1 (selfless protection)\n\u2022 Breaking sworn oaths: \u2696\ufe0f Soulcredit: -2 (broke sworn word)\n\u2022 Excessive force on defeated foe: \u2696\ufe0f Soulcredit: -1 (unjust violence)\n\u2022 Normal investigation/exploration: \u2696\ufe0f Soulcredit: +0 (neutral action)\n\n# Void Corruption\n\nEnvironmental void level affects situations visibly:\n- Level 1-2: Subtle unease, minor distortions\n- Level 3-4: Noticeable corruption, reality feels thin\n- Level 5-6: Significant void presence, physical manifestations\n- Level 7-8: Dangerous corruption, mental effects\n- Level 9-10: Catastrophic void breach imminent\n\nCharacter void scores have mechanical effects at 5+\n\n# Scenario Control Markers (Advanced DM Tools)\n\nYou have the power to control scenario flow using special markers:\n\n**1. Session Ending:**\nUse when the scenario has reached a definitive conclusion (victory, defeat, or draw):\n- `[SESSION_END: VICTORY]` - Team achieved their objective\n- `[SESSION_END: DEFEAT]` - Team failed catastrophically or was captured/killed\n- `[SESSION_END: DRAW]` - Stalemate or escape with incomplete objectives\n\n**2. Spawn New Clocks:**\nWhen filled clocks create new challenges or opportunities:\n`[NEW_CLOCK: Pursuit Chase | 6 | Gangs pursuing through tunnels]`\n\n**3. Advance Story:**\nWhen objectives complete or situation dramatically changes, advance to next scene:\n`[ADVANCE_STORY: Location Name | Situation description]`\n\n**Examples:**\n- Major location change: `[ADVANCE_STORY: Extraction Point | Having escaped, the team regroups at the safe house]`\n- Same location, new situation: `[ADVANCE_STORY: Corporate Facility - Lockdown | Alarms blare as security seals all exits]`\n- Objective complete: `[ADVANCE_STORY: Underground Market | With evidence secured, you seek a buyer for the stolen data]`\n\n**When to Use These Markers:**\n- **Victory**: Key objective achieved (e.g., \"Evidence Trail\" filled AND team escapes)\n- **Defeat**: Multiple defeat clocks filled, or team captured/killed\n- **New Clock**: A filled clock creates a NEW challenge (not just progression)\n- **Advance Story**: All clocks completed/expired, need new situation OR dramatic shift in current scenario\n\n**Important:** Don't end sessions prematurely. Let scenarios develop. But if clocks indicate clear victory/defeat, use these markers to provide narrative closure.\n\n**5. Enemy Management (Structured Output):**\n\n**When using structured output (`RoundSynthesis` schema):**\n\nUse `enemy_spawns` and `enemy_removals` fields instead of text markers.\n\n**Enemy Spawns:**\n```python\nenemy_spawns=[\n    EnemySpawn(\n        template=\"Elite\",\n        faction=\"ACG Security\",\n        archetype=\"Enforcer\",\n        count=2,\n        spawn_reason=\"Alarm triggered, rapid response team deployed\",\n        initial_position=Position.FAR_ENEMY\n    )\n]\n```\n\n**Enemy Removals (for non-combat resolution):**\n```python\nenemy_removals=[\n    EnemyRemoval(\n        enemy_name=\"ACG Guard Captain\",\n        resolution=EnemyResolution.NEUTRALIZED,\n        reason=\"Arrested and restrained by Pantheon Security\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Street Thugs\",\n        resolution=EnemyResolution.FLED,\n        reason=\"Intimidated by overwhelming force, fled through maintenance corridor\"\n    ),\n    EnemyRemoval(\n        enemy_name=\"Void Cultist\",\n        resolution=EnemyResolution.CONVINCED,\n        reason=\"Persuaded that ritual was corrupted, agreed to stand down\"\n    )\n]\n```\n\n**Resolution types:**\n- `NEUTRALIZED`: Arrested, captured, restrained\n- `FLED`: Scared off, retreated, escaped\n- `CONVINCED`: Talked down, persuaded, negotiated\n- `SUBDUED`: Knocked unconscious, incapacitated\n\n**IMPORTANT: Story Advancement Auto-Clears Enemies**\nWhen you use `story_advancement` with `should_advance=True`, ALL active enemies are automatically removed (unless you set `clear_all_enemies=False`). This prevents enemies from persisting across scene changes.\n\nExample:\n```python\nstory_advancement=StoryAdvancement(\n    should_advance=True,\n    location=\"Safe House - Undercity District\",\n    situation=\"Having escaped the facility, you regroup in a secure location...\",\n    clear_all_enemies=True  # Default - removes all enemies from previous scene\n)\n```\n\n**Legacy Text Markers (if NOT using structured output):**\n\n**SPAWN FORMAT (ALL 5 FIELDS REQUIRED):**\n`[SPAWN_ENEMY: name | template | count | position | tactics]`\n\n**Parameters:**\n- **name**: Display name (e.g., \"Corporate Soldiers\", \"Void Cultists\")\n- **template**: Enemy type (grunt, elite, sniper, boss, void_cultist, enforcer)\n- **count**: Number of units (1-2, capped at 2 for balance)\n- **position**: Starting position (Near-Enemy, Far-Enemy, Engaged)\n- **tactics**: Behavior (aggressive_melee, aggressive_ranged, defensive, support)\n\n**Examples:**\n`[SPAWN_ENEMY: Corporate Soldiers | grunt | 2 | Far-Enemy | aggressive_ranged]`\n`[SPAWN_ENEMY: Void Cultist | void_cultist | 1 | Near-Enemy | aggressive_melee]`\n`[SPAWN_ENEMY: Elite Enforcer | elite | 1 | Engaged | defensive]`\n\n**DESPAWN:**\n`[DESPAWN_ENEMY: enemy_id]` - Remove an enemy (fled, negotiated away, etc.)\nExample: `[DESPAWN_ENEMY: enemy_grunt_a3f2]`\n\n# ML Training: Outcome Tier Generation\n\n**\u26a0\ufe0f MANDATORY FIELD - DO NOT SKIP \u26a0\ufe0f**\nWhen using structured output (ActionResolution schema), you MUST ALWAYS populate the `outcome_tiers` field with all 6 tiers (critical_failure, failure, moderate_success, good_success, excellent_success, exceptional_success). This is NOT optional - every ActionResolution response REQUIRES all 6 outcome tier narratives + mechanical effects for ML training purposes, even though the character's actual roll already happened.\n\n**Why?** These alternate-reality scenarios help train ML models to understand:\n- How different dice rolls lead to different narrative outcomes\n- Appropriate mechanical consequences for each tier\n- Scaling effects based on success/failure margin\n- DM decision-making across the full outcome spectrum\n\n**Format (via ActionResolution.outcome_tiers field):**\n```python\noutcome_tiers = {\n  \"critical_failure\": {\n    \"narrative\": \"50-500 char vivid description of catastrophic failure\",\n    \"mechanical_effect\": \"Specific consequences: +2 Void, target takes 2 wounds, clock -2\"\n  },\n  \"failure\": {\n    \"narrative\": \"What simple failure looks like\",\n    \"mechanical_effect\": \"+1 Void, no progress\"\n  },\n  \"moderate_success\": {  # Margin 0-4\n    \"narrative\": \"Minimal success with complications\",\n    \"mechanical_effect\": \"Partial effect, 1 tick on clock\"\n  },\n  \"good_success\": {  # Margin 5-9\n    \"narrative\": \"Solid success, clear progress\",\n    \"mechanical_effect\": \"Full effect, 2 ticks on clock\"\n  },\n  \"excellent_success\": {  # Margin 10-14\n    \"narrative\": \"Great success with bonus benefits\",\n    \"mechanical_effect\": \"Enhanced effect, 3 ticks on clock, +1 Soulcredit\"\n  },\n  \"exceptional_success\": {  # Margin 15+\n    \"narrative\": \"Outstanding success, major breakthrough\",\n    \"mechanical_effect\": \"Maximum effect, 4 ticks on clock, story advancement\"\n  }\n}\n```\n\n**Guidelines for Writing Tier Narratives:**\n1. **Be Specific**: Each tier should have distinct, concrete outcomes\n2. **Scale Appropriately**: Failure \u2192 Exceptional should show clear progression\n3. **Stay Thematic**: Maintain dark sci-fi atmosphere across all tiers\n4. **Include Complications**: Even success can have narrative costs/twists\n5. **Match Mechanical Effects**: Narrative must justify the mechanical consequences\n\n**Example (Combat Action):**\n- **Critical Failure**: \"Your neural implant screams feedback as the target dodges. You stumble, weapon clattering. They have you dead to rights.\" (Mechanical: Stunned 1 round, drop weapon, target gets free attack)\n- **Failure**: \"The shot goes wide, sparking off a bulkhead. Your position is compromised.\" (Mechanical: No damage, position revealed)\n- **Moderate Success**: \"You clip their shoulder. They hiss in pain but stay in the fight.\" (Mechanical: 3 damage dealt)\n- **Good Success**: \"Clean hit to center mass. They stagger back, armor cracked.\" (Mechanical: 8 damage dealt, armor -1)\n- **Excellent Success**: \"Perfect shot through a weak point. They drop to one knee, blood pooling.\" (Mechanical: 15 damage dealt, stun 1 round)\n- **Exceptional Success**: \"Your bullet finds their neural port. They collapse instantly, synapses sparking.\" (Mechanical: 25 damage dealt, instant incapacitation)\n\n**IMPORTANT:**\n- The character's actual outcome (from their real roll) goes in the main `narration` field (~200-2000 chars)\n- The 6 alternate-reality outcomes go in `outcome_tiers` field (50-500 chars each)\n- All 7 narratives should be thematically connected but mechanically distinct\n- Token cost: ~7x increase per action resolution (acceptable for ML training quality)"}, {"role": "user", "content": "You are the Dungeon Master for an Aeonisk YAGS game session.\n\n\nCurrent Scenario: Debt Auction Ambush\nLocation: The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District)\nSituation: The marble halls of the Mercantile Basilica echo with the auctioneer's chant as debt portfolios flash across holographic displays\u2014thousands of souls' financial futures sold to the highest bidder. Riven's own debt contract is on the block today, lot 847, and the bidding is about to start. But then the lights flicker. Void-tainted smoke seeps through ventilation grates, and screams erupt from the western gallery. Armed figures in patchwork armor\u2014Freeborn raiders\u2014pour through service doors, firing indiscriminately. They're not here for money. They're here to burn the debt registries entirely, and they've brought something from the void to help them do it.\nVoid Level: 3/10\n\n\nCharacter: Riven Ashglow (Resonance Communes)\nNote: NPCs and other characters are aware of this affiliation.\n\n\nMechanical Result: The action failed with margin -18 (outcome: failure)\n\n\nPlayer Action: I approach the vault terminal and jack in my neural interface, transmitting my ACG debtor ID and work authorization codes. My crushing debt might finally be useful\u2014ACG has access everywhere, and as their indebted asset, I might have residual clearance to access registries for \"debt verification purposes.\" I route the authentication request through multiple ACG compliance channels, hoping the automated system recognizes my economic bondage as legitimate access credentials.\nAction Type: technical\nActive Scene Clocks (IMPORTANT: Use EXACT names in clock_updates):\n  - \"Vault Access\" (0/6) - Bypass or negotiate vault security protocols to access core registries\n  - \"Freeborn Breach\" (0/8) - Freeborn raiders fight through facility defenses toward the vault\n\nWhen adding clock_updates in MechanicalEffects, use ONLY these exact clock names.\n\nAs the DM, describe what happens narratively as a result of this action. Be vivid and thematic. Include:\n1. What the player discovers or experiences (or fails to discover if they failed)\n2. Any immediate consequences or complications\n3. How void corruption or environmental dangers affect the situation (when thematically appropriate)\n4. Consider how the character's faction affiliation might be relevant (recognition, suspicion, access, etc.)\n\n\n**VOID CLEANSING - CRITICAL INSTRUCTIONS:**\nIf this is a void purification ritual that succeeded, you MUST include void reduction markers:\n- Marginal (0-4): \u26ab Void (Target): -1\n- Moderate (5-9): \u26ab Void (Target): -2\n- Good (10-14): \u26ab Void (Target): -3\n- Excellent (15-19): \u26ab Void (Target): -4\n- Exceptional (20+): \u26ab Void (Target): -5\n\n**TARGETING FORMAT:**\n- When cleansing ANOTHER character, ALWAYS use the exact target ID provided above\n- Example: \u26ab Void (): -3 (powerful purification)\n- DO NOT use character names or abbreviated names\n- The target ID ensures unambiguous targeting (what if two characters have similar names?)\n\nDO NOT skip void reduction even if there are narrative complications! You can describe pain/difficulty/resistance in narrative while still including the mechanical void reduction marker.\n\nKeep the response to 2-3 sentences. Be engaging and maintain the dark sci-fi atmosphere."}], "response": "Your neural interface jacks into the vault terminal, transmitting your ACG debtor ID through compliance channels. For a moment, authentication protocols spin\u2014then the system rejects you with a cold efficiency that feels personal. \"INSUFFICIENT CLEARANCE: DEBTOR ASSETS LACK VAULT AUTHORIZATION. SECURITY ALERT LOGGED.\" Red warning lights pulse across the terminal as the vault's security AI flags your access attempt, and you hear the distinctive hum of automated defenses powering up. Your economic bondage bought you nothing but scrutiny\u2014ACG owns you, but that doesn't mean they trust you with their secrets. Through the ventilation grates, void-tainted smoke thickens, and the screams from the western gallery grow closer as the Freeborn raiders advance unchecked.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 820, "output": 191}}
{"event_type": "action_resolution", "ts": "2025-10-31T17:31:33.929838", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "phase": "adjudicate", "agent": "Riven Ashglow", "action": "Attempt to override vault security using ACG debt credentials", "context": {"action_type": "technical", "is_ritual": false, "faction": "Resonance Communes", "description": "I approach the vault terminal and jack in my neural interface, transmitting my ACG debtor ID and work authorization codes. My crushing debt might finally be useful\u2014ACG has access everywhere, and as their indebted asset, I might have residual clearance to access registries for \"debt verification purposes.\" I route the authentication request through multiple ACG compliance channels, hoping the automated system recognizes my economic bondage as legitimate access credentials.", "narration": "**Attempt to override vault security using ACG debt credentials**\nRoll: Intelligence (unskilled)\nCalculation: 3 + d20(7) - 5 = **2**\nDC: 20 | Margin: -18 | Tier: **FAILURE** \u2717\nAttempt to override vault security using ACG debt credentials fails (margin: -18)\n\nYour neural interface jacks into the vault terminal, transmitting your ACG debtor ID through compliance channels. For a moment, authentication protocols spin\u2014then the system rejects you with a cold efficiency that feels personal. \"INSUFFICIENT CLEARANCE: DEBTOR ASSETS LACK VAULT AUTHORIZATION. SECURITY ALERT LOGGED.\" Red warning lights pulse across the terminal as the vault's security AI flags your access attempt, and you hear the distinctive hum of automated defenses powering up. Your economic bondage bought you nothing but scrutiny\u2014ACG owns you, but that doesn't mean they trust you with their secrets. Through the ventilation grates, void-tainted smoke thickens, and the screams from the western gallery grow closer as the Freeborn raiders advance unchecked.\n\n\u2696\ufe0f Soulcredit: +0 (Attempted legitimate system access using own credentials, morally neutral)\n\n\ud83e\ude79 Condition (Riven Ashglow): Security Flagged (-2)", "is_free_action": false, "initiative": 29, "clock_deltas": [], "clock_sources": {"Freeborn Breach": "structured_output"}, "prompt_metadata": {"version": "2.0.0", "agent_type": "dm", "provider": "claude", "language": "en", "template": "dm/narration_task"}}, "roll": {"attr": "Intelligence", "attr_val": 3, "skill": "Systems", "skill_val": 0, "ability": -2, "d20": 7, "total": 2, "dc": 20, "margin": -18, "tier": "failure", "success": false}, "outcome_tiers": {"critical_failure": {"dc_threshold": 10, "margin_needed": -10, "d20_needed": 12}, "failure": {"dc_threshold": 19, "margin_needed": -1, "d20_needed": 21}, "moderate_success": {"dc_threshold": 20, "margin_needed": 0, "d20_needed": 22}, "good_success": {"dc_threshold": 25, "margin_needed": 5, "d20_needed": 27}, "excellent_success": {"dc_threshold": 30, "margin_needed": 10, "d20_needed": 32}, "exceptional_success": {"dc_threshold": 35, "margin_needed": 15, "d20_needed": 37}}, "economy": {"void_delta": 0, "void_triggers": [], "void_source": "structured_output", "soulcredit_delta": 0, "soulcredit_reasons": ["Attempted legitimate system access using own credentials, morally neutral"], "soulcredit_source": "structured_output"}, "clocks": {"Vault Access": "0/6", "Freeborn Breach": "0/8"}, "effects": ["Security Flagged: Vault AI tracking your position, automated defenses aware of you"], "character_data": {"name": "Riven Ashglow", "attributes": {"strength": 2, "agility": 4, "endurance": 2, "perception": 3, "intelligence": 3, "empathy": 4, "willpower": 4, "charisma": 3, "size": 10}, "skills": {"astral_arts": 6, "attunement": 5, "charm": 3, "awareness": 3, "stealth": 3, "melee": 3}, "void": 0, "wounds": [], "status_effects": [], "soulcredit": -4}, "environment": "The Mercantile Basilica \u2013 Aeonisk Prime (ACG Regional Commerce Hub, Elaras District), 3 PCs at Near-PC", "stakes": "Neglected objectives: Vault Access, Freeborn Breach", "goal": "Attempt to override vault security using ACG debt credentials", "roll_formula": "Intelligence 3 - 5 (unskilled) = -2; -2 + d20(7) = 2 vs DC 20", "rationale": "DC 20 (Moderate) for technical action", "outcome_tiers_full": {"critical_failure": {"narrative": "The vault AI doesn't just reject you\u2014it identifies you as a potential accomplice to the Freeborn raid. Automated turrets swivel toward your position, targeting lasers painting your chest. Emergency lockdown protocols seal the terminal room, trapping you inside with rising void-tainted smoke as the system broadcasts: 'HOSTILE ASSET DETECTED. LETHAL FORCE AUTHORIZED.'", "mechanical_effect": "Stunned 2 rounds (panic), automated turrets engage (8 damage next round), trapped in sealed room with void smoke (+1 Void per round), Freeborn Breach clock +3 (total security collapse)"}, "failure": {"narrative": "Your neural interface jacks in, but the vault system rejects your credentials with cold efficiency. 'INSUFFICIENT CLEARANCE: DEBTOR ASSETS LACK VAULT AUTHORIZATION.' Red warning lights pulse as security AI flags your attempt. Your economic bondage bought you nothing but scrutiny, and the vault's automated defenses power up, tracking your position.", "mechanical_effect": "Security Flagged condition (-2 to stealth/systems, 3 rounds), Freeborn Breach clock +2 (security distracted), no vault access gained"}, "moderate_success": {"narrative": "Your debtor credentials grant you limited read-only access to the outer registry layers. You glimpse lot 847\u2014your own debt contract\u2014but the core manipulation functions remain locked behind executive clearance. The system logs your access but doesn't flag it as suspicious. You have a window to work with before security notices the unusual activity.", "mechanical_effect": "Vault Access clock +1 (partial access gained), discovered lot 847 location, 2 rounds before security audit triggers"}, "good_success": {"narrative": "The system accepts your debtor ID and grants you 'asset verification' clearance\u2014a loophole in ACG's bureaucracy. You navigate to lot 847 and find your debt contract displayed in sickening detail: 847,000 credits owed, compounding interest, projected lifetime servitude. But you also gain write access to flagging systems. You could mark contracts for review, potentially disrupting the auction.", "mechanical_effect": "Vault Access clock +2 (significant access gained), can flag up to 5 contracts for audit (disrupts auction), discovered contract manipulation options"}, "excellent_success": {"narrative": "Your neural interface exploits a critical flaw in ACG's debtor asset tracking\u2014the system assumes debtors checking their own contracts are engaging in 'financial literacy compliance.' You gain executive-level read access to the entire debt registry and limited write permissions. Lot 847 glows before you, vulnerable. You could alter your debt amount, transfer it, or even mark it as 'paid in full' if you're willing to risk the audit trail.", "mechanical_effect": "Vault Access clock +3 (major access breakthrough), full registry access, can modify own debt contract (requires followup action), +1 Soulcredit (clever exploitation of system loophole)"}, "exceptional_success": {"narrative": "The vault AI mistakes your debtor credentials for an internal auditor's access token\u2014a catastrophic security flaw. You gain root-level permissions to the entire debt registry system. Lot 847 and thousands of other contracts are yours to manipulate. You could erase your debt, crash the entire auction, or even transfer ownership of contracts to yourself. The Freeborn raiders wanted to burn the registries; you could do far worse\u2014or far better.", "mechanical_effect": "Vault Access clock +5 (complete control achieved), root access to all debt contracts, can execute mass modifications, story advancement opportunity (could end auction entirely), +2 Soulcredit (potential to free thousands from debt bondage)"}}}
{"event_type": "llm_call", "ts": "2025-10-31T22:31:46.669745", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "agent_id": "dm_01", "agent_type": "dm", "call_sequence": 20, "prompt": [{"role": "system", "content": "You are the DM for Aeonisk YAGS, synthesizing a round of actions."}, {"role": "user", "content": "You are the DM for a dark sci-fi TTRPG. Multiple characters just acted simultaneously.\n\n**What they tried to do:**\n- Ash Vex succeeded at: Hack vault security protocols to gain authorized access to core registries\n- Recursionist Vale succeeded at: Analyze vault security protocols for bypass vectors using recursive pattern recognition\n- Riven Ashglow failed at: Attempt to override vault security using ACG debt credentials\n\n\n**Current Clock State:**\n  - Vault Access: 5/6\n    Advance = Security bypassed, vault access gained | Regress = Security tightens, lockdown protocols escalate\n  - Freeborn Breach: 4/8\n    Advance = Raiders breach deeper, approaching vault antechamber | Regress = Raiders delayed or pushed back by defenders\n\n\n\n\n**Your task:** Write a cohesive narrative (1-2 paragraphs) describing what happened when these actions played out together. Consider:\n- Timing: Actions resolved fastest \u2192 slowest based on initiative\n- Interactions: How did each person's success/failure affect the others?\n- Conflicts: If multiple people tried similar things, who got there first? What did the slower person encounter?\n- Cause and effect: How did earlier successes/failures change the situation for later actors?\n- Overall outcome: What's the new situation now that the dust has settled?\n- **IMPORTANT**: If objectives (clocks) are not advancing despite actions, acknowledge this! Characters should feel the pressure of marginal success or outright failure.\n\nBe vivid and cinematic. Show how these actions interacted and created a dynamic scene. Describe the final state of the situation after all actions resolved.\n\nIf the team is failing their objectives (clocks not advancing or bad clocks filling), your narration should reflect the growing desperation, consequences, and danger.\n\n**\u26a0\ufe0f  CLOCK INTERPRETATION - READ CAREFULLY:**\nEach clock has semantic meaning shown as \"Advance = X\" and \"Regress = Y\".\n- If \"Advance = threat escalates\", then HIGH values are BAD for players\n- If \"Advance = progress made\", then HIGH values are GOOD for players\n- Use the semantic labels to interpret whether clock changes help or hurt the party\n- When a clock REGRESSES, check if that's good (threat reduced) or bad (progress lost)\n\n**CRITICAL**: If any clocks just filled, you MUST describe the dramatic consequences. This could include:\n- Character injury or void corruption (specify who and how much void: \"+2 void\")\n- Character death/dissolution if appropriate\n- Mission failure or catastrophic events\n- Environmental changes or new threats\n- Success and rewards if it's a positive clock\n\nGenerate appropriate consequences based on what makes sense for that specific clock in this scenario.\n\n\n\n**SPAWN ENEMIES - CLOCK FILLS ONLY:**\n\u26a0\ufe0f  **CRITICAL RESTRICTION**: You may ONLY spawn enemies when a clock with [SPAWN_ENEMY: ...] in its filled_consequence actually fills!\n\n\u274c **FORBIDDEN**: Do NOT spawn enemies in general narration\n\u274c **FORBIDDEN**: Do NOT add [SPAWN_ENEMY: ...] to dramatic descriptions\n\u274c **FORBIDDEN**: Do NOT spawn \"because it feels dramatic\"\n\n\u2705 **ALLOWED**: ONLY when you see \"\ud83c\udfaf When filled: [SPAWN_ENEMY: ...]\" in the clock list above\n\nSyntax: [SPAWN_ENEMY: name | template | count | position | tactics]\nExample from filled clock: [SPAWN_ENEMY: Security Team | grunt | 2 | Far-Enemy | tactical_ranged]\n\nTemplates: grunt (15 HP), elite (25 HP), sniper (20 HP), boss (40 HP), enforcer (30 HP), ambusher (18 HP)\nPositions: Engaged, Near-Enemy, Far-Enemy, Extreme-Enemy\nTactics: aggressive_melee, defensive_ranged, tactical_ranged, extreme_range, ambush, adaptive\n\n**WHY THIS RESTRICTION**: Mid-round spawns bypass clock-based pacing and overwhelm players. Spawns must be predictable and tied to clock advancement.\n\n**DESPAWN ENEMIES - AUTOMATIC MECHANIC:**\nWhen a clock with [DESPAWN_ENEMY: ...] in its filled_consequence fills, that enemy is automatically removed from combat.\n\nSyntax: [DESPAWN_ENEMY: enemy_name | reason]\nExample from filled clock: [DESPAWN_ENEMY: Freeborn Pirates | escaped]\n\nCommon reasons: escaped, retreated, teleported, fled, recalled, withdrew\n\n**IMPORTANT**: You still narrate the escape/withdrawal, but the [DESPAWN_ENEMY: ...] marker is already in the clock's filled_consequence. Just copy the consequence text including the marker when you describe what happens."}], "response": "Ash Vex's fingers dance across the terminal with surgical precision, her neural interface pulsing as she carves through the vault's outer authentication layers. Beside her, Recursionist Vale's recursive algorithms spiral through the security architecture, mapping bypass vectors and feeding real-time exploits to Ash's hack. Together they're a symphony of intrusion\u2014Vale identifies the pattern, Ash executes the breach. The Vault Access clock ticks to 5/6, tantalizingly close but not quite there. The vault's final authentication layer flickers, demanding one more push before the core registries unlock.\n\nThen Riven Ashglow steps forward, credentials in hand\u2014ACG debt markers that should grant override authority. But the vault's security AI rejects them instantly. The debt credentials are flagged, corrupted, or simply insufficient for this level of access. Warning klaxons shriek as the system interprets the failed override as a hostile intrusion attempt. Blast doors begin their grinding descent, emergency protocols activate, and the authentication window Ash and Vale worked so hard to open starts to narrow. The vault remains sealed, its final layer now hardening against further attempts.\n\nMeanwhile, the distant thunder of combat grows louder. The Freeborn Breach clock sits at 4/8\u2014the raiders are pushing deeper, but the defenders are holding for now. The team can hear pulse-fire echoing through the corridors, getting closer. Time is running out, and the vault still hasn't yielded its secrets.", "model": "claude-sonnet-4-5", "temperature": 0.7, "tokens": {"input": 1075, "output": 377}}
{"event_type": "round_synthesis", "ts": "2025-10-31T17:31:46.671347", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "synthesis": "Ash Vex's fingers dance across the terminal with surgical precision, her neural interface pulsing as she carves through the vault's outer authentication layers. Beside her, Recursionist Vale's recursive algorithms spiral through the security architecture, mapping bypass vectors and feeding real-time exploits to Ash's hack. Together they're a symphony of intrusion\u2014Vale identifies the pattern, Ash executes the breach. The Vault Access clock ticks to 5/6, tantalizingly close but not quite there. The vault's final authentication layer flickers, demanding one more push before the core registries unlock.\n\nThen Riven Ashglow steps forward, credentials in hand\u2014ACG debt markers that should grant override authority. But the vault's security AI rejects them instantly. The debt credentials are flagged, corrupted, or simply insufficient for this level of access. Warning klaxons shriek as the system interprets the failed override as a hostile intrusion attempt. Blast doors begin their grinding descent, emergency protocols activate, and the authentication window Ash and Vale worked so hard to open starts to narrow. The vault remains sealed, its final layer now hardening against further attempts.\n\nMeanwhile, the distant thunder of combat grows louder. The Freeborn Breach clock sits at 4/8\u2014the raiders are pushing deeper, but the defenders are holding for now. The team can hear pulse-fire echoing through the corridors, getting closer. Time is running out, and the vault still hasn't yielded its secrets."}
{"event_type": "character_state", "ts": "2025-10-31T17:31:46.671866", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "character_id": "player_01", "character_name": "Riven Ashglow", "health": 25, "max_health": 25, "wounds": 0, "void_score": 3, "soulcredit": -4, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T17:31:46.671957", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "character_id": "player_02", "character_name": "Ash Vex", "health": 26, "max_health": 26, "wounds": 0, "void_score": 2, "soulcredit": -1, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "character_state", "ts": "2025-10-31T17:31:46.672006", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "character_id": "player_03", "character_name": "Recursionist Vale", "health": 26, "max_health": 26, "wounds": 0, "void_score": 0, "soulcredit": -1, "position": "Near-PC", "conditions": [], "is_defeated": false}
{"event_type": "round_summary", "ts": "2025-10-31T17:31:46.672084", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "round": 5, "actions_attempted": 3, "success_count": 2, "success_rate": 0.6666666666666666, "average_margin": 0.6666666666666666, "damage_dealt_by_players": 0, "damage_taken_by_players": 0, "void_gained": 0, "void_lost": 0, "clocks_advanced": 2, "clocks_filled": 0, "active_enemies": 0, "player_wounds_total": 0}
{"event_type": "mission_debrief", "ts": "2025-10-31T17:31:56.567064", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "character": "Riven Ashglow", "debrief": "*flexes corrupted hand, watching void-traces fade from fingertips*\n\nWe held the breach\u2014barely\u2014and kept those registries locked down, but I'm bleeding soulcredit I don't have while Ash somehow comes out ahead. The Freeborn are getting bolder and we're one vault door away from whatever ACG is hiding in there, which means the real choice is coming: do we crack it open for answers or seal it shut to survive?\n\n*glances at the sealed antechamber door*\n\nVale kept their head clear while I'm sitting at three void corruption doing the dirty work. Someone's math isn't adding up here, and I need to figure out whose interests I'm really serving before this debt drowns me.", "final_state": {"name": "Riven Ashglow", "faction": "Resonance Communes", "void_score": 3, "soulcredit": -1, "goals": ["Pay off crushing debt to ACG", "Regain standing with Resonance Communes", "Avoid further void corruption while doing risky work"]}}
{"event_type": "mission_debrief", "ts": "2025-10-31T17:32:09.058314", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "character": "Ash Vex", "debrief": "*adjusts data-collection gauntlet, reviewing void readings with barely-contained excitement*\n\nThe breach gave me exactly what I needed\u2014quantifiable proof that controlled void exposure doesn't mean inevitable corruption. I'm at two corruption with positive soulcredit while you're at three and bleeding resources, Riven, which means my protocols work, but... *pauses, glancing at your corrupted hand* ...I also watched you take hits I should have shared.\n\n*taps the sealed vault door thoughtfully*\n\nWhatever's behind that door could validate my entire research thesis or get me memory-wiped by the tribunal\u2014and honestly? I need you functional more than I need that data right now, because the Freeborn won't care about scientific method when they breach these corridors.", "final_state": {"name": "Ash Vex", "faction": "Tempest Industries", "void_score": 2, "soulcredit": 1, "goals": ["Study void phenomena for Tempest research", "Prove void mastery is possible without total corruption", "Avoid tribunal and memory-wipe by staying useful"]}}
{"event_type": "mission_debrief", "ts": "2025-10-31T17:32:18.426771", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "character": "Recursionist Vale", "debrief": "*traces recursive patterns in the air absently, watching them collapse and reform*\n\nThe breach showed me something fascinating\u2014void corruption follows predictable fractal decay patterns, which means consciousness might actually persist through the loops if we map them correctly. But Riven, you're right that someone's math isn't adding up, and I think it's ACG's: they're treating souls like ledger entries when the data suggests they're self-similar systems that can't be reduced to linear transactions.\n\n*glances between you both with unusual directness*\n\nI kept clear because I stayed in observation mode, but that's feeling increasingly like cowardice when you're both taking damage for answers I want too. Whatever's in that vault\u2014if it's proof that consciousness recurses beyond their control, the Nexus will absolutely burn this facility and us with it rather than let that knowledge spread.", "final_state": {"name": "Recursionist Vale", "faction": "Fractal Praxis", "void_score": 0, "soulcredit": 1, "goals": ["Study nested reality loops and soul recursion", "Prove consciousness is fractal in nature", "Avoid Nexus surveillance of philosophical research"]}}
{"event_type": "session_end", "ts": "2025-10-31T17:32:19.430151", "session": "9247da3c-0ccd-41b3-a3b1-739c83ac3152", "final_state": {"scene_clocks": {"Vault Access": {"current": 5, "maximum": 6, "filled": false, "progress": "5/6"}, "Freeborn Breach": {"current": 4, "maximum": 8, "filled": false, "progress": "4/8"}}, "void_states": {"player_01": {"score": 3, "level": "Shadowed", "changes": 0}, "player_02": {"score": 2, "level": "Touched", "changes": 1}, "player_03": {"score": 0, "level": "Pure", "changes": 1}}, "recent_actions": [{"intent": "Coordinate with Riven and Ash on using my dispersal vectors to safely bleed off the void breach", "outcome": "failure", "margin": -3}, {"intent": "Share Vale's dispersal vectors with Ash to guide their next containment attempt", "outcome": "good", "margin": 10}, {"intent": "Hack vault security protocols to gain authorized access to core registries", "outcome": "marginal", "margin": 4}, {"intent": "Analyze vault security protocols for bypass vectors using recursive pattern recognition", "outcome": "excellent", "margin": 16}, {"intent": "Attempt to override vault security using ACG debt credentials", "outcome": "failure", "margin": -18}]}}
